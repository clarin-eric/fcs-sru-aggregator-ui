{"version":3,"mappings":"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","names":["m","require$$0","client","REQ_PARAM_CONSORTIA","getURLForDownload","axios$1","searchID","resourceID","format","language","languageFilter","params","relURL","getURLForWeblicht","languageForWeblicht","getInitData","urlParams","url","response","getResources","getLanguages","postSearch","searchParams","postSearchMoreResults","getSearchResultsMetaOnly","getSearchResultsMetaOnlyForResource","results","result","getSearchResultDetails","getStatisticsData","KEEP_PARAMS","makeSearchQuery","useKeepSearchParamsRaw","urlSearchParams","useSearchParams","useMemo","name","getNewSearchParams","useCallback","extraParams","newParams","createSearchParams","value","key","useKeepSearchParams","searchLink","getNewSearchLink","Footer","t","useTranslation","i18nKeyTerms","urlTerms","hasTerms","i18nKeyContact","urlContact","hasContact","i18nKeyServiceInfo","hasServiceInfo","linkSearch","jsx","Container","Row","jsxs","Col","Link","Trans","appStore","createStore","set","path","state","show","title","enabled","user","newUsername","localeStore","define_import_meta_env_LOCALES_default","nextLocale","nextLocales","useLocaleStore","selector","useBoundStore","useStore","appLogoUrl","logoUrl","personIcon","translateIcon","Header","locale","locales","setLocale","authEnabled","AppStore","authName","isAuthenticated","deployPath","loginPath","i18nKeyTranslationHelpUrl","urlHelpWithTranslations","hasHelpWithTranslationsUrl","handleLocaleChangeClick","eventKey","renderAuth","Navbar","Nav","renderLocales","langNames","currentSelectedLanguage","Fragment","NavDropdown","localeOption","langNamesLocalized","e","renderAppLogo","currentTarget","NavLink","getPreferredTheme","setTheme","theme","useColorMode","useEffect","updateTheme","resources","resourcesEnApp","resourcesEnCommon","I18N_NS_CONTEXT_PREFIX","LANGUAGE","LANGUAGES","resolveNs","ns","defaultNSs","nsParam","I18N_NS_ALL_BASE","I18N_NS_ALL","toArray","val","postProcessTryPrefixedNamespacesFirst","options","translator","keys","namespaces","resolved","namespacesPrefixed","i18n","initReactI18next","resourcesToBackend","namespace","__variableDynamicImportRuntimeHelper","__vitePreload","n","addScriptActions","script","container","addScript","removeScript","useScript","delay","timeoutId","cyrb53","str","seed","h1","h2","ch","setup","siteId","trackerUrl","enableLinkTracking","domains","userId","installScript","srcUrl","scripts","getConfig","configString","error","indexUrl","setupAndInstallFromConfigString","setupParams","installParams","trackPageView","referrerUrl","trackSiteSearch","query","category","count","people","technologiesFrontEnd","About","userLocale","hasMatomo","matomoIndexUrl","matomoOptOutScript","appTitleHead","showBackendInfos","renderTechnologiesList","technologies","technology","renderDateTime","datetime","date","Helmet","person","Card","eyeIcon$1","magicIcon","arrowClockwiseIcon","balloonIcon","bankIcon","bracesIcon","downloadIcon","envelopeArrowUpIcon","exclamationTriangleIcon","eyeIcon","gearIcon","highlightsIcon","houseDoorIcon","infoCircleIcon","link45degIcon","plusCircleIcon","repeatIcon","searchIcon","shieldCheckIcon","shieldLockIcon","threeDotsIcon","xCircleIcon","iconMap","eyeFillIcon","Help","renderIconsLegend","icons","iconKeys","iconKey","b","idA","idB","context","c","Badge","AggregatorDataContext","createContext","AggregatorDataProvider","languages","weblichtLanguages","children","data","useAggregatorData","useContext","AxiosContext","useAxios","axios","AxiosProvider","SearchParamsContext","SearchParamsProvider","queryType","resourceIDs","numberOfResults","DEFAULT_SEARCH_LANGUAGE_FILTER","DEFAULT_RESOURCE_VIEW_VISIBILITY","DEFAULT_RESOURCE_VIEW_GROUPING","DEFAULT_RESOURCE_VIEW_SORTING","MULTIPLE_LANGUAGE_CODE","languageCodeToName","code","codeToLanguageMapping","fromApi","LocaleStore","prepareFn","resource","rootResource","subResource","convertedResources","sortFn","x","y","xInstitution","getBestFromMultilingualValuesTryByLanguage","yInstitution","r","xTitle","yTitle","recurseResources","evaluateAggregationContext","endpoints2handles","selectedResourceIDs","handlesNotFound","resourcesToSelect","endpoint","handles","handle","found","fn","recfn","index","findResourceByFilter","filter","findRecFn","getResourceIDs","getResourceIDsBySplit","resourceIDsMap","getAvailableResourceIDs","queryTypeId","languageCode","checkFn","isResourceAvailableDueToSubResource","isResourceAvailable","getInstitutions","institutions","institution","flattenResources","flattenFn","MULTILINGUAL_VALUE_CHECK_LANGUAGES","getBestFromMultilingualValues","values","ownLanguages","getFromMultilingualValuesByLanguage","valueByLanguage","getBestLanguageFromMultilingualValuesTryByLanguage","getLanguagesFromResourceInfo","defaultLanguage","languagesForTitle","languagesForDescription","languagesForInstitution","languageForResource","isResourceAvailableForQueryType","isResourceAvailableForLanguage","shouldBeAvailable","recursivelyCheck","SORT_FNS","a","aTitle","bTitle","aInstitution","bInstitution","ret","useDebounce","debounceValue","setDebounceValue","useState","handler","getTextCursorOffset","node","offset","selectionNode","parent","lengthBefore","i","child","getRangeContainerWithOffsetFromTextOffset","containerLength","childLength","newOffset","getAbsoluteTextCursorOffsets","range","start","end","setCursorPosition","selection","startRange","getCursorPosition","idxRange","queryTypeToPrismLanguage","highlightSyntax","pluginClasses","prismValue","Prism","sanitizeValue","ContentEditable","React","onChange","onCursorChange","disabled","placeholder","props","ref","inputRef","useRef","mRef","useImperativeHandle","sanitizedValue","setSanitizedValue","cursorPos","setCursorPos","deboundedSanitizedValue","htmlValue","setHtmlValue","valueWithStyle","pos","newValue","useLayoutEffect","handleInput","event","handlePaste","pastedData","handleInsert","handleKeyDown","handleBackspace","handleDelete","handlePossibleCursorChange","isClick","selectionIndices","doRemove","mode","numDeleted","acc","cur","oldValue","newValueSpansRemoved","text","lastPos","firstPos","valueToInsertSanitized","insertPos","newValueWithInsert","newCursorPos","LanguageModal","searchLanguage","searchLanguageFilter","paramShowResourceCounts","showLanguageFilterOptions","onModalClose","selectedLanguage","setSelectedLanguage","selectedFilterOption","setSelectedFilterOption","setLanguageFilter","showResourceCounts","setShowResourceCounts","languageToNumberOfResources","counts","filteredLanguages","useFuzzySearchList","item","score","matches","oneThird","handleClose","action","handleReset","handleToggleShowResourceCountsChange","renderLanguageOption","highlights","isSelected","className","Button","Highlight","Modal","Form","type","QUERY_TYPES","QUERY_TYPE_MAP","id","qt","QUERY_TYPES_WITH_BUILDER_SUPPORT","DOWNLOAD_FORMATS","DEFAULT_QUERY_TYPE","NUMBER_OF_RESULTS","NO_MORE_RECORDS_DIAGNOSTIC_URI","exampleQueries","QuerySuggestionsModal","queryTypesProp","queryTypes","requestedExamples","example","handleUseQueryClose","renderExample","description","nr","examples","DebouncedFuzzySearchInput","setFilter","deboundedFilter","useFuzzySearchListWithHierarchy","fields","flattenedResources","filteredResources","strings","matchesByField","fieldIdx","filteredResourcesHighlights","map","filteredResourcesScores","resourceIDsOfParentsToAdd","rootScore","filteredResourcesParents","aScore","bScore","ResourceSelector","highlighting","highlightings","shouldBeShown","localeForInfos","onSelectClick","expanded","setExpanded","showSubResources","setShowSubResources","shouldExpandToggleBeShown","subresource","handleToggleExpansionClick","isExpanded","handleToggleSelectionClick","handleToggleShowSubResourcesClick","doShow","renderResourceAvailabilityRestriction","ToggleButtonGroup","ToggleButton","GroupedResources","titleId","resourceScores","expandedProp","onExpandToggleClick","onSelectAllClick","onDeselectAllClick","flatResourceIds","flatResourcesSelected","resourceId","isAllSelected","isNoneSelected","isSomeSelected","visibleResources","handleToggleExpandButton","renderResourceCounts","rootResources","numResources","numResourcesRoot","numResourcesSelected","rid","slugify","Collapse","ResourceSelectionModal","showGrouping","availableResources","selectedResources","setSelectedResourceIDs","viewResourcesVisibility","setViewResourcesVisibility","viewResourcesGrouping","setViewResourcesGrouping","viewResourcesSorting","setViewResourcesSorting","resourcesGroupedByInstitute","setResourcesGroupedByInstitute","resourcesGroupedByLanguage","setResourcesGroupedByLanguage","sortedResources","resourceInfoLanguagesGrouped","filteredResourceScores","groupScore","institute","rScore","instituteToResourcesMap","instituteToLanguagesMap","resourcesInfo","languageCodeToNameHelper","changeSelectedResourceIDs","nextResourceIDs","handleViewOptionsVisibilityChange","handleViewOptionsGroupingChange","handleViewOptionsSortingChange","handleSelectAllClick","handleDeselectAllClick","handleSelectVisibleClick","handleResourceOnSelectClick","selected","handleGroupedResourcesOnSelectAllClick","resourcesInGroup","handleGroupedResourcesOnDeselectAllClick","shouldResourceBeShown","renderResources","FloatingLabel","amount","useFlipOnceTrue","setState","useSearchParamsFromHash","routerNavigate","useNavigate","hash","useLocation","setSearchParams","nextInit","newSearchParams","newHash","QueryBuilderModal","lazy","getQueryFromSearchParams","fallback","newQuery","getQueryTypeFromSearchParams","newQueryType","SearchInput","onSearch","onShowToast","availableResourcesProps","selectedResourcesProps","hasSearch","hashSearchParams","setHashSearchParams","showResourceSelectionModal","setShowResourceSelectionModal","showResourceSelectionModalGrouping","setShowResourceSelectionModalGrouping","showLanguageSelectionModal","setShowLanguageSelectionModal","showQuerySuggestionsModal","setShowQuerySuggestionsModal","showQueryBuilderModal","setShowQueryBuilderModal","isLoadQueryBuilderModalTriggered","triggerLoadQueryBuilderModal","setLanguage","setQueryType","validResourceIDs","setValidResourceIDs","setNumberOfResults","setQuery","queryError","queryInputEnhanced","setQueryInputEnhanced","resetResourceSelection","getAvailableResourceIDsCallback","availableResourceIDs","doSearch","numberOfSelectedInstitutions","hasResourcesForQueryFCS","hasResourcesForQueryLex","showQueryBuilderButton","handleChangeQueryType","handleChangeNumberOfResults","handleChangeLanguageSelection","newLanguage","newLanguageFilter","handleChangeResourceSelection","handleChangeQuerySuggestion","newResourceIDs","hasNewResourceSelection","hasValidNewResourceSelection","newSelectedResourceIDs","handleChangeQueryBuilderQuery","validResources","handleQueryChange","handleSearchSubmit","renderSelectedResourcesMsg","InputGroup","isChecked","Dropdown","info","Suspense","LoadMoreResultsButton","searchId","pollDelay","queryClient","useQueryClient","isPolling","setIsPolling","isPendingRequesting","mutate","reset","useMutation","dataPolling","isLoadingPolling","isFetchingPolling","useQuery","isLoading","isFinished","showSpinner","handleLoadMoreClick","Spinner","computeShortLayerIds","layerIds","collapePlaceholder","layerIdTokens","l","maxTokens","layerIdTokenPattern","idx","_","plh","lId","lParts","v","idShort","filterMainLayerIds","layers","resourceLayers","layersWithMatchingSpanRanges","layer","span","layerInfo","layerA","layerB","layerAInfo","layerBInfo","layerAType","layerBType","ViewAdvancedTabular","availLayer","renderAdvancedLayers","layerIdShort","numSpans","mainLayerId","showLayerInfoColumns","Table","record","OverlayTrigger","Tooltip","ViewKwic","ViewLex","field","ListGroup","ViewLexPlain","fragment","ViewPlain","ResourceResultsModal","viewModeProps","showDiagnosticsProps","showDiagnostics","setShowDiagnostics","viewMode","setViewMode","hasDiagnostics","diagnostic","hasMoreResults","disableWeblicht","languagesFromKwic","handleViewModeChange","renderResults","label","Alert","ResourceSearchResult","resultInfo","showResourceDetails","htmlId","useId","showModal","setShowModal","inProgress","hasResults","isError","handleViewClick","handleModalClose","renderResultsCounter","DEFAULT_VIEW_MODE","DEFAULT_VIEW_MODE_WHEN_LEX","DEFAULT_VIEW_MODE_WHEN_FCS","DEFAULT_SORTING","lookup","titleA","titleB","countA","countB","DEFAULT_POLL_DELAY","SearchResults","sorting","setSorting","setShowResourceDetails","sortedResults","isAllLexHITS","numRequested","numInProgress","numWithResults","numWithResultsWithWarnings","numNoResults","numNoResultsWithIssues","numNoResultsWithExceptions","numNoResultsWithWarnings","numResultsTotalAvailable","numResultsTotalLoaded","sent","setSent","handleSortingChange","Popover","ProgressBar","fcsLogoDarkModeUrl","fcsLogoUrl","Search","setUrlSearchParams","setResources","setLanguages","setWeblichtLanguages","searchResourceIDs","setSearchResourceIDs","setHasSearch","toasts","setToasts","newResources","resourcesByAuth","numberOfAuthOnlyRessources","authFreeResources","aggregationContext","unavailable","isInputDisabled","mutateSearch","isSearchPending","handleSearch","searchData","handleShowToast","toast","ToastContainer","Toast","oldToast","useReactRouterNavigate","search","originalPath","newPath","generatePath","useRouteMatch","routeContext","UNSAFE_RouteContext","location","routes","routeMatch","matchRoutes","usePrevious","REQ_PARAM_RESOURCE_ID","DEFAULT_RESOURCE_INSTITUTION_VARIANT","DEFAULT_URL_VARIANT","extractTLD","domain","parts","lastTLDPart","preLastTLDPart","extractMainDomain","tld","parsed","shortDomain","getSURT","domainSURT","restOfURL","sortBySURT","urlA","urlB","surtA","surtB","len","fragmentA","fragmentB","res","searchCapabilityPriority","compareSearchCapability","capabilityA","capabilityB","priorityA","priorityB","FCSStatistics","getLinkSearch","resourcesAll","setResourcesAll","selectedResourceInstitutionVariantOption","setSelectedResourceInstitutionVariantOption","selectedEndpointURLVariantOption","setSelectedEndpointURLVariantOption","consortia","dataResources","isPendingResources","isErrorResources","errorResources","dataLanguages","isPendingLanguages","isErrorLanguages","errorLanguages","dataResourcesAll","isPendingResourcesAll","isErrorResourcesAll","errorResourcesAll","prevConsortia","newConsortia","flatResources","endpointURLsWithResources","endpointDomainsWithURLs","endpointTLDsWithURLs","endpointURLsWithSearchCapabilities","searchCapabilities","capability","institutionsWithResources","endpointInstitutionsWithResources","searchCapabilitiesWithResources","capabilities","availabilityRestrictionsWithResources","restriction","consortiaWithResources","consortium","consortiumData","hasResources","hasLanguages","enableResourceLanguageSelectionModal","hasResourcesWithAvailabilityRestriction","toggleConsortium","shortCapabilitiesForUrls","urls","caps","cap","renderInstitutionsTable","renderEndpointURLTable","tldA","tldB","list","endpoints","ResourcesDetails","validatorUrl","selectedResourceId","setSelectedResourceId","resourceFoundById","resourceFoundByHandle","newResourceId","selectedResource","isPending","languagesNames","handleChangeResource","renderResourceDropdownItem","nestLevel","renderResourceMetadataField","fieldType","fieldValues","fallbackEmptyValue","renderResourceHierarchy","renderRecursiveResourceHierarchy","resourceInHierarchy","showLexDVInfo","dv","showAdvDVInfo","EndpointStatistics","statistics","isScan","secondsFormatter","renderResourceWithInfos","resInfo","resourceInner","linkToResourceInfo","note","nameOrResInfo","reason","SectionStatistics","filterFields","setFilterFields","showIssuesOnly","setShowIssuesOnly","idSuffix","flatData","institutionName","institutionEndpoints","endpointUrl","endpointInfo","endpointsWithIssues","institutionData","strOrObj","handleFilterOptionToggleChange","f","institutionMatch","CATEGORY_LABELS","CATEGORY_LABELS_MAP","OTHER_TABS","Statistics","categoryId","useParams","navigate","setValidatorUrl","categoryKeys","defaultCategoryTab","refreshData","handleTabChange","Tab","section","contents","App","pathname","setPathname","newPathname","Routes","Route","CONFIG_NAMES_ONLY_ON_INITIALIZATION","configure","target","prop","updateLocale","userLanguages","foundLocale","userLanguage","basename","apiURL","QueryClient","axiosClient","matomoParams","rootId","domRoot","root","createRoot","StrictMode","QueryClientProvider","HelmetProvider","BrowserRouter"],"ignoreList":[0,1,8,9,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],"sources":["../../node_modules/react-dom/client.js","../../node_modules/@clarin-eric/fcs-sru-aggregator-api-adapter-typescript/dist/index.mjs","../../src/hooks/useKeepSearchParams.ts","../../src/components/Footer/Footer.tsx","../../src/stores/app.ts","../../src/stores/locale.ts","../../src/assets/images/clarin-logo-wide.png","../../src/assets/images/icon-services-fcs.png","../../node_modules/bootstrap-icons/icons/person.svg?raw","../../node_modules/bootstrap-icons/icons/translate.svg?raw","../../src/components/Header/Header.tsx","../../src/hooks/useColorMode.ts","../../src/i18n/i18next.ts","../../src/hooks/useScript.ts","../../src/utils/cyrb53.ts","../../src/utils/matomo.ts","../../src/pages/About/data.ts","../../src/pages/About/About.tsx","../../node_modules/bootstrap-icons/icons/eye-fill.svg?raw","../../node_modules/bootstrap-icons/icons/magic.svg?raw","../../node_modules/bootstrap-icons/icons/arrow-clockwise.svg?raw","../../node_modules/bootstrap-icons/icons/balloon.svg?raw","../../node_modules/bootstrap-icons/icons/bank.svg?raw","../../node_modules/bootstrap-icons/icons/braces.svg?raw","../../node_modules/bootstrap-icons/icons/download.svg?raw","../../node_modules/bootstrap-icons/icons/envelope-arrow-up.svg?raw","../../node_modules/bootstrap-icons/icons/exclamation-triangle.svg?raw","../../node_modules/bootstrap-icons/icons/eye.svg?raw","../../node_modules/bootstrap-icons/icons/gear-fill.svg?raw","../../node_modules/bootstrap-icons/icons/highlights.svg?raw","../../node_modules/bootstrap-icons/icons/house-door.svg?raw","../../node_modules/bootstrap-icons/icons/info-circle.svg?raw","../../node_modules/bootstrap-icons/icons/link-45deg.svg?raw","../../node_modules/bootstrap-icons/icons/plus-circle.svg?raw","../../node_modules/bootstrap-icons/icons/repeat.svg?raw","../../node_modules/bootstrap-icons/icons/search.svg?raw","../../node_modules/bootstrap-icons/icons/shield-check.svg?raw","../../node_modules/bootstrap-icons/icons/shield-lock.svg?raw","../../node_modules/bootstrap-icons/icons/three-dots.svg?raw","../../node_modules/bootstrap-icons/icons/x-circle.svg?raw","../../src/pages/Help/Help.tsx","../../src/providers/AggregatorDataContext.tsx","../../src/providers/AxiosContext.tsx","../../src/providers/SearchParamsContext.tsx","../../src/utils/search.ts","../../src/utils/resources.ts","../../src/hooks/useDebounce.ts","../../src/utils/cursor.ts","../../src/utils/prism.ts","../../src/components/ContentEditable/ContentEditable.tsx","../../src/components/LanguageModal.tsx","../../src/utils/constants.ts","../../src/components/QuerySuggestionsModal/examples.ts","../../src/components/QuerySuggestionsModal/QuerySuggestionsModal.tsx","../../src/components/DebouncedFuzzySearchInput.tsx","../../src/hooks/useFuzzySearchListWithHierarchy.ts","../../src/components/ResourceSelectionModal/ResourceSelector.tsx","../../src/components/ResourceSelectionModal/GroupedResources.tsx","../../src/components/ResourceSelectionModal/ResourceSelectionModal.tsx","../../src/hooks/useFlipOnceTrue.ts","../../src/hooks/useSearchParamsFromHash.ts","../../src/pages/Search/SearchInput.tsx","../../src/components/ResourceSearchResult/LoadMoreResultsButton.tsx","../../src/components/ResourceSearchResult/ViewAdvancedTabular.tsx","../../src/components/ResourceSearchResult/ViewKwic.tsx","../../src/components/ResourceSearchResult/ViewLex.tsx","../../src/components/ResourceSearchResult/ViewLexPlain.tsx","../../src/components/ResourceSearchResult/ViewPlain.tsx","../../src/components/ResourceSearchResult/ResourceResultsModal.tsx","../../src/components/ResourceSearchResult/ResourceSearchResult.tsx","../../src/utils/results.ts","../../src/pages/Search/SearchResults.tsx","../../src/assets/images/logo-fcs-dark.png","../../src/assets/images/logo-fcs.png","../../src/pages/Search/Search.tsx","../../src/hooks/useNavigate.ts","../../src/hooks/useRouteMatch.ts","../../src/hooks/usePrevious.ts","../../src/pages/Statistics/utils.ts","../../src/pages/Statistics/FCSStatistics.tsx","../../src/pages/Statistics/ResourcesDetails.tsx","../../src/pages/Statistics/EndpointStatistics.tsx","../../src/pages/Statistics/SectionStatistics.tsx","../../src/pages/Statistics/Statistics.tsx","../../src/App.tsx","../../src/public.ts","../../src/index.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import axios, { AxiosError } from \"axios\";\n\n//#region src/consortia.ts\nconst REQ_PARAM_CONSORTIA = \"x-consortia\";\nasync function getConsortia(axios$1) {\n\tconst response = await axios$1.get(\"consortia\");\n\tconsole.debug(\"[getConsortia]\", response);\n\treturn response.data.filter((consortium) => consortium !== null);\n}\n\n//#endregion\n//#region src/download.ts\nfunction getURLForDownload(axios$1, searchID, resourceID, format, language, languageFilter) {\n\tconst params = new URLSearchParams({\n\t\tresourceId: resourceID,\n\t\tformat\n\t});\n\tif (languageFilter === \"byGuess\" || languageFilter === \"byMetaAndGuess\") params.set(\"filterLanguage\", language);\n\tconst relURL = `search/${searchID}/download?${params.toString()}`;\n\treturn axios$1.getUri({ url: relURL });\n}\nfunction getURLForWeblicht(axios$1, searchID, resourceID, languageForWeblicht, language, languageFilter) {\n\tconst params = new URLSearchParams({ resourceId: resourceID });\n\tif (languageForWeblicht) params.set(\"filterLanguage\", languageForWeblicht);\n\telse if (languageFilter === \"byGuess\" || languageFilter === \"byMetaAndGuess\") params.set(\"filterLanguage\", language);\n\tconst relURL = `search/${searchID}/toWeblicht?${params.toString()}`;\n\treturn axios$1.getUri({ url: relURL });\n}\n\n//#endregion\n//#region src/resources.ts\nasync function getInitData(axios$1, params) {\n\tconst urlParams = new URLSearchParams();\n\tif (params?.consortia !== void 0 && params?.consortia !== null) urlParams.set(REQ_PARAM_CONSORTIA, params.consortia);\n\tconst url = \"init\" + (urlParams.entries().next().done ? \"\" : `?${urlParams}`);\n\tconst response = await axios$1.get(url);\n\tconsole.debug(\"[getInitData]\", response);\n\treturn response.data;\n}\nasync function getResources(axios$1, params) {\n\tconst urlParams = new URLSearchParams();\n\tif (params?.consortia !== void 0 && params?.consortia !== null) urlParams.set(REQ_PARAM_CONSORTIA, params.consortia);\n\tconst url = \"resources\" + (urlParams.entries().next().done ? \"\" : `?${urlParams}`);\n\tconst response = await axios$1.get(url);\n\tconsole.debug(\"[getResources]\", response);\n\treturn response.data;\n}\nasync function getLanguages(axios$1, params) {\n\tconst urlParams = new URLSearchParams();\n\tif (params?.consortia !== void 0 && params?.consortia !== null) urlParams.set(REQ_PARAM_CONSORTIA, params.consortia);\n\tconst url = \"languages\" + (urlParams.entries().next().done ? \"\" : `?${urlParams}`);\n\tconst response = await axios$1.get(url);\n\tconsole.debug(\"[getLanguages]\", response);\n\treturn response.data;\n}\n\n//#endregion\n//#region src/results.ts\nasync function postSearch(axios$1, searchParams) {\n\tconst response = await axios$1.post(\"search\", searchParams, { headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" } });\n\tconsole.debug(\"[postSearch]\", searchParams, response);\n\treturn response.data;\n}\nasync function postSearchMoreResults(axios$1, searchID, searchParams) {\n\tconst response = await axios$1.post(`search/${searchID}`, searchParams, { headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" } });\n\tconsole.debug(\"[postSearchMoreResults]\", {\n\t\tsearchID,\n\t\tsearchParams\n\t}, response);\n\treturn response.data;\n}\nasync function postSearchStop(axios$1, searchID) {\n\ttry {\n\t\tconst response = await axios$1.post(`search/${searchID}/stop`, {}, { headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" } });\n\t\tconsole.debug(\"[postStopSearch]\", { searchID }, response);\n\t\treturn response.status === 202 || response.status !== 204;\n\t} catch (err) {\n\t\tif (err instanceof AxiosError) {\n\t\t\tif (err.status === 404 && err.response?.data.message === \"HTTP 404 Not Found\") {\n\t\t\t\tconsole.warn(\"Search stopping is not supported at this API!\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tthrow err;\n\t}\n}\nfunction getSearchResultsURL(axios$1, searchID, resourceID = void 0, metaOnly = false) {\n\tif (!searchID) throw new Error(\"Invalid \\\"searchID\\\" parameter!\");\n\tlet url = `search/${searchID}`;\n\tif (metaOnly) url = `${url}/metaonly`;\n\tif (resourceID !== void 0) url = `${url}?resourceId=${encodeURIComponent(resourceID)}`;\n\treturn axios$1.getUri({ url });\n}\nasync function getSearchResults(axios$1, searchID) {\n\tif (!searchID) throw new Error(\"Invalid \\\"searchID\\\" parameter!\");\n\tconst response = await axios$1.get(`search/${searchID}`);\n\tconsole.debug(\"[getSearchResults]\", { searchID }, response);\n\tif (response.data?.results?.length > 0 && response.data.results[0].records === void 0) console.warn(\"Using legacy FCS SRU Aggregator API with Search Results not in '.records'!\", { searchID }, response.data);\n\treturn response.data;\n}\nasync function getSearchResultsMetaOnly(axios$1, searchID) {\n\tif (!searchID) throw new Error(\"Invalid \\\"searchID\\\" parameter!\");\n\tconst response = await axios$1.get(`search/${searchID}/metaonly`);\n\tconsole.debug(\"[getSearchResultsMetaOnly]\", { searchID }, response);\n\treturn response.data;\n}\nasync function getSearchResultsMetaOnlyForResource(axios$1, searchID, resourceID) {\n\tif (!searchID) throw new Error(\"Invalid \\\"searchID\\\" parameter!\");\n\tif (!resourceID) throw new Error(\"Invalid \\\"resourceID\\\" parameter!\");\n\tconst response = await axios$1.get(`search/${searchID}/metaonly?resourceId=${encodeURIComponent(resourceID)}`);\n\tconsole.debug(\"[getSearchResultsMetaOnlyForResource]\", {\n\t\tsearchID,\n\t\tresourceID\n\t}, response);\n\tconst results = response.data.results.filter((result) => result.id === resourceID);\n\tif (results.length === 0) throw new Error(`Results (meta) for resource not found! (searchId: ${searchID}, resourceId: ${resourceID})`);\n\treturn results[0];\n}\nasync function getSearchResultDetails(axios$1, searchID, resourceID) {\n\tif (!searchID) throw new Error(\"Invalid \\\"searchID\\\" parameter!\");\n\tif (!resourceID) throw new Error(\"Invalid \\\"resourceID\\\" parameter!\");\n\tconst response = await axios$1.get(`search/${searchID}?resourceId=${encodeURIComponent(resourceID)}`);\n\tconsole.debug(\"[getSearchResultDetails]\", {\n\t\tsearchID,\n\t\tresourceID\n\t}, response);\n\tconst results = response.data.results.filter((result) => result.resource.id === resourceID);\n\tif (results.length === 0) throw new Error(`Results for resource not found! (searchId: ${searchID}, resourceId: ${resourceID})`);\n\tif (results[0].records === void 0) console.warn(\"Using legacy FCS SRU Aggregator API with Search Results not in '.records'!\", { searchID }, results);\n\treturn results[0];\n}\n\n//#endregion\n//#region src/statistics.ts\nasync function getStatisticsData(axios$1, params) {\n\tconst urlParams = new URLSearchParams();\n\tif (params?.consortia !== void 0 && params?.consortia !== null) urlParams.set(REQ_PARAM_CONSORTIA, params.consortia);\n\tconst url = \"statistics\" + (urlParams.entries().next().done ? \"\" : `?${urlParams}`);\n\tconst response = await axios$1.get(url);\n\tconsole.debug(\"[getStatisticsData]\", response);\n\treturn response.data;\n}\n\n//#endregion\n//#region src/index.ts\nfunction makeAxiosClient({ baseURL, timeout = 5e3, ...options }) {\n\tif (!baseURL) throw new Error(\"Invalid \\\"baseURL\\\" parameter!\");\n\treturn axios.create({\n\t\tbaseURL,\n\t\ttimeout,\n\t\tresponseType: \"json\",\n\t\ttransitional: { silentJSONParsing: false },\n\t\t...options\n\t});\n}\n\n//#endregion\nexport { REQ_PARAM_CONSORTIA, getConsortia, getInitData, getLanguages, getResources, getSearchResultDetails, getSearchResults, getSearchResultsMetaOnly, getSearchResultsMetaOnlyForResource, getSearchResultsURL, getStatisticsData, getURLForDownload, getURLForWeblicht, makeAxiosClient, postSearch, postSearchMoreResults, postSearchStop };","import { useCallback, useMemo } from 'react'\nimport type { URLSearchParamsInit } from 'react-router'\nimport { createSearchParams, useSearchParams } from 'react-router'\n\nimport { REQ_PARAM_CONSORTIA } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\n// --------------------------------------------------------------------------\n\nexport const KEEP_PARAMS = [REQ_PARAM_CONSORTIA]\n\nexport function makeSearchQuery(params: URLSearchParams) {\n  return !params.entries().next().done ? `?${params}` : undefined\n}\n\nexport function useKeepSearchParamsRaw(): [\n  URLSearchParams,\n  (extraParams: URLSearchParamsInit) => URLSearchParams\n] {\n  const [urlSearchParams] = useSearchParams()\n\n  // filter search parameters to those we want to persist\n  const params = useMemo(\n    () =>\n      new URLSearchParams(\n        Array.from(urlSearchParams.entries()).filter(([name]) => KEEP_PARAMS.includes(name))\n      ),\n    [urlSearchParams]\n  )\n\n  // getter/compute method to create search query with user supplied extra parameters\n  const getNewSearchParams = useCallback(\n    (extraParams: URLSearchParamsInit) => {\n      const newParams = new URLSearchParams(params)\n      createSearchParams(extraParams).forEach((value, key) => newParams.append(key, value))\n      return newParams\n    },\n    [params]\n  )\n\n  return [params, getNewSearchParams]\n}\n\nexport default function useKeepSearchParams(): [\n  string | undefined,\n  (extraParams: URLSearchParamsInit) => string | undefined\n] {\n  const [params, getNewSearchParams] = useKeepSearchParamsRaw()\n\n  // most compact search query that uses the persistent parameters\n  const searchLink = makeSearchQuery(params)\n\n  // getter/compute method to create search query with user supplied extra parameters\n  const getNewSearchLink = useCallback(\n    (extraParams: URLSearchParamsInit) => makeSearchQuery(getNewSearchParams(extraParams)),\n    [getNewSearchParams]\n  )\n\n  return [searchLink, getNewSearchLink]\n}\n","import Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { Link } from 'react-router'\n\nimport useKeepSearchParams from '@/hooks/useKeepSearchParams'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n\nfunction Footer() {\n  const { t } = useTranslation()\n\n  const i18nKeyTerms = 'urls.termsUseAndDisclaimer'\n  const urlTerms = t(i18nKeyTerms, { ns: 'common' })\n  const hasTerms = urlTerms !== i18nKeyTerms\n  const i18nKeyContact = 'urls.contact'\n  const urlContact = t(i18nKeyContact, { ns: 'common' })\n  const hasContact = urlContact !== i18nKeyContact\n  const i18nKeyServiceInfo = 'footer.serviceInfo.text'\n  const transServiceInfo = t(i18nKeyServiceInfo)\n  const hasServiceInfo = transServiceInfo !== i18nKeyServiceInfo\n\n  const [linkSearch] = useKeepSearchParams()\n\n  // ------------------------------------------------------------------------\n\n  return (\n    <footer className=\"text-muted\">\n      <Container>\n        <Row>\n          <Col className=\"text-start d-flex flex-sm-row flex-column column-gap-3 row-gap-2\">\n            {/* On smaller screen, show about link with contact link */}\n            <div>\n              <Link to={{ pathname: '/about', search: linkSearch }} className=\"hidden-xs\">\n                {t('footer.links.about')}\n              </Link>\n              {/* Center version on mobile */}\n              <div className=\"version-info text-muted text-center-xs\">\n                v{import.meta.env.APPLICATION_VERSION}\n              </div>\n            </div>\n            <Link to={{ pathname: '/stats', search: linkSearch }}>\n              {t('footer.links.statistics')}\n            </Link>\n          </Col>\n          <Col className=\"text-center\">\n            {/* CLARIN logo and copyright (center column on larger screens) */}\n            {hasServiceInfo && (\n              <Trans\n                i18nKey={i18nKeyServiceInfo}\n                components={{\n                  serviceBy: <a href={t('footer.serviceInfo.urlServiceBy')} />,\n                  hostedBy: <a href={t('footer.serviceInfo.urlHostedBy')} />,\n                }}\n              />\n            )}\n          </Col>\n          <Col className=\"hidden-xs text-end d-flex flex-sm-row flex-column justify-content-sm-end column-gap-3 row-gap-2\">\n            {/* Contact link in right column on larger screens */}\n            {hasTerms && <a href={urlTerms}>{t('footer.links.termsUseAndDisclaimer')}</a>}\n            {hasContact && <a href={urlContact}>{t('footer.links.contact')}</a>}\n          </Col>\n        </Row>\n      </Container>\n    </footer>\n  )\n}\n\nexport default Footer\n","import { createStore } from 'zustand/vanilla'\n\nimport { SetupAndInstallScriptParams as MatomoSetupParams } from '@/utils/matomo'\n\n// see: https://zustand.docs.pmnd.rs/apis/create-store#updating-state-based-on-previous-state\n\n// --------------------------------------------------------------------------\n\ntype AppStoreState = {\n  deployPath: string\n  apiURL: string\n  validatorURL: string | null\n\n  showSearchResultLink: boolean\n\n  appTitle: string\n  appTitleHead: string\n\n  matomoTrackingEnabled: boolean\n  matomoTrackingParams: string | MatomoSetupParams | null\n\n  authEnabled: boolean\n  authUsername: string | null\n  isAuthenticated: boolean\n}\ntype AppStoreActions = {\n  setDeployPath: (\n    path:\n      | AppStoreState['deployPath']\n      | ((currentPath: AppStoreState['deployPath']) => AppStoreState['deployPath'])\n  ) => void\n  setApiURL: (\n    url:\n      | AppStoreState['apiURL']\n      | ((currentURL: AppStoreState['apiURL']) => AppStoreState['apiURL'])\n  ) => void\n  setValidatorURL: (\n    url:\n      | AppStoreState['validatorURL']\n      | ((currentURL: AppStoreState['validatorURL']) => AppStoreState['validatorURL'])\n  ) => void\n\n  setShowSearchResultLink: (\n    show:\n      | AppStoreState['showSearchResultLink']\n      | ((oldShow: AppStoreState['showSearchResultLink']) => AppStoreState['showSearchResultLink'])\n  ) => void\n\n  setAppTitle: (\n    title:\n      | AppStoreState['appTitle']\n      | ((currentTitle: AppStoreState['appTitle']) => AppStoreState['appTitle'])\n  ) => void\n  setAppTitleHead: (\n    title:\n      | AppStoreState['appTitleHead']\n      | ((currentTitle: AppStoreState['appTitleHead']) => AppStoreState['appTitleHead'])\n  ) => void\n\n  setMatomoTrackingParams: (\n    params:\n      | AppStoreState['matomoTrackingParams']\n      | ((\n          oldParams: AppStoreState['matomoTrackingParams']\n        ) => AppStoreState['matomoTrackingParams'])\n  ) => void\n\n  setAuthEnabled: (\n    enabled:\n      | AppStoreState['authEnabled']\n      | ((isEnabled: AppStoreState['authEnabled']) => AppStoreState['authEnabled'])\n  ) => void\n  setAuthUsername: (\n    user:\n      | AppStoreState['authUsername']\n      | ((oldUser: AppStoreState['authUsername']) => AppStoreState['authUsername'])\n  ) => void\n}\ntype AppStore = AppStoreState & AppStoreActions\n\n// --------------------------------------------------------------------------\n\nconst appStore = createStore<AppStore>((set) => ({\n  // state\n  deployPath: import.meta.env.DEPLOY_PATH,\n  apiURL: import.meta.env.API_URL,\n  validatorURL: import.meta.env.VALIDATOR_URL,\n  showSearchResultLink: import.meta.env.SHOW_SEARCH_RESULT_LINK,\n  appTitle: import.meta.env.APP_TITLE,\n  appTitleHead: import.meta.env.APP_TITLE_HEAD,\n  matomoTrackingEnabled: import.meta.env.FEATURE_TRACKING_MATOMO, // read-only\n  matomoTrackingParams: import.meta.env.FEATURE_TRACKING_MATOMO\n    ? import.meta.env.FEATURE_TRACKING_MATOMO_PARAMS\n    : null,\n  authEnabled:\n    import.meta.env.FEATURE_AUTHENTICATION && import.meta.env.FEATURE_AUTHENTICATION_ENABLED,\n  authUsername: null,\n  isAuthenticated: false,\n\n  // actions\n  setDeployPath: (path) =>\n    set((state) => ({ deployPath: typeof path === 'function' ? path(state.deployPath) : path })),\n  setApiURL: (url) =>\n    set((state) => ({ apiURL: typeof url === 'function' ? url(state.apiURL) : url })),\n  setValidatorURL: (url) =>\n    set((state) => ({ validatorURL: typeof url === 'function' ? url(state.validatorURL) : url })),\n  setShowSearchResultLink: (show) =>\n    set((state) => ({\n      showSearchResultLink: typeof show === 'function' ? show(state.showSearchResultLink) : show,\n    })),\n  setAppTitle: (title) =>\n    set((state) => ({ appTitle: typeof title === 'function' ? title(state.appTitle) : title })),\n  setAppTitleHead: (title) =>\n    set((state) => ({\n      appTitleHead: typeof title === 'function' ? title(state.appTitleHead) : title,\n    })),\n  setMatomoTrackingParams: (params) =>\n    set((state) => ({\n      matomoTrackingParams:\n        typeof params === 'function' ? params(state.matomoTrackingParams) : params,\n    })),\n  setAuthEnabled: (enabled) =>\n    import.meta.env.FEATURE_AUTHENTICATION\n      ? set((state) => ({\n          authEnabled: typeof enabled === 'function' ? enabled(state.authEnabled) : enabled,\n        }))\n      : null,\n  setAuthUsername: (user) =>\n    set((state) => {\n      const newUsername = typeof user === 'function' ? user(state.authUsername) : user\n      return {\n        authUsername: newUsername,\n        isAuthenticated: newUsername !== null && newUsername !== 'anonymous', // anonymous\n      }\n    }),\n}))\n\nexport default appStore\n","import { createStore } from 'zustand/vanilla'\nimport { useStore } from 'zustand/react'\n\n// --------------------------------------------------------------------------\n\ntype LocaleStoreState = {\n  locale: string\n  locales: string[]\n}\ntype LocaleStoreActions = {\n  setLocale: (\n    locale:\n      | LocaleStoreState['locale']\n      | ((currentLocale: LocaleStoreState['locale']) => LocaleStoreState['locale'])\n  ) => void\n  setLocales: (\n    locales:\n      | LocaleStoreState['locales']\n      | ((currentLocales: LocaleStoreState['locales']) => LocaleStoreState['locales'])\n  ) => void\n}\nexport type LocaleStore = LocaleStoreState & LocaleStoreActions\n\n// --------------------------------------------------------------------------\n\nconst localeStore = createStore<LocaleStore>((set) => ({\n  // state\n  locale: import.meta.env.LOCALE ?? 'en',\n  locales: import.meta.env.LOCALES ?? (import.meta.env.LOCALE ? [import.meta.env.LOCALE] : ['en']),\n\n  // actions\n  setLocale: (nextLocale) =>\n    // TODO: we could add validation here to not call set() if locale is unknown...\n    set((state) => ({\n      locale: typeof nextLocale === 'function' ? nextLocale(state.locale) : nextLocale,\n    })),\n  setLocales: (nextLocales) =>\n    set((state) => ({\n      locales: typeof nextLocales === 'function' ? nextLocales(state.locales) : nextLocales,\n    })),\n}))\n\nexport default localeStore\n\n// --------------------------------------------------------------------------\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const useLocaleStore = (selector?: (state: LocaleStore) => any) => {\n  const useBoundStore = useStore(localeStore, selector!)\n  Object.assign(useBoundStore, localeStore)\n  return useBoundStore\n}\n\n// --------------------------------------------------------------------------\n","export default \"__VITE_ASSET__CA6LwmRy__\"","export default \"__VITE_ASSET__ne7X2bFD__\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-person\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-translate\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286zm1.634-.736L5.5 3.956h-.049l-.679 2.022z\\\"/>\\n  <path d=\\\"M0 2a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v3h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zm7.138 9.995q.289.451.63.846c-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6 6 0 0 1-.415-.492 2 2 0 0 1-.94.31\\\"/>\\n</svg>\"","import Container from 'react-bootstrap/Container'\nimport Nav from 'react-bootstrap/Nav'\nimport Navbar from 'react-bootstrap/Navbar'\nimport NavDropdown from 'react-bootstrap/NavDropdown'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { Link, NavLink } from 'react-router'\n// import { useStore } from 'zustand'\n\nimport useKeepSearchParams from '@/hooks/useKeepSearchParams'\nimport AppStore from '@/stores/app'\nimport { useLocaleStore } from '@/stores/locale'\n\nimport appLogoUrl from '@images/app-logo.png' // NOTE: placeholder will be resolved with plugin\nimport logoUrl from '@images/icon-services-fcs.png'\n\nimport personIcon from 'bootstrap-icons/icons/person.svg?raw'\nimport translateIcon from 'bootstrap-icons/icons/translate.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n\nfunction Header() {\n  const { t } = useTranslation()\n\n  const locale: string = useLocaleStore((state) => state.locale)\n  const locales: string[] = useLocaleStore((state) => state.locales)\n  const setLocale: (locale: string) => void = useLocaleStore((state) => state.setLocale)\n\n  // const AppStoreReactive = useStore(AppStore)\n  // const authName = AppStoreReactive.authUsername\n  const authEnabled = AppStore.getState().authEnabled\n  const authName = AppStore.getState().authUsername\n  const isAuthenticated = AppStore.getState().isAuthenticated\n\n  const deployPath = AppStore.getState().deployPath ?? ''\n  const loginPath = deployPath + (deployPath.endsWith('/') ? '' : '/') + 'login'\n\n  const [linkSearch] = useKeepSearchParams()\n\n  const i18nKeyTranslationHelpUrl = 'urls.helpWithTranslations'\n  const urlHelpWithTranslations = t(i18nKeyTranslationHelpUrl, { ns: 'common' })\n  const hasHelpWithTranslationsUrl = urlHelpWithTranslations !== i18nKeyTranslationHelpUrl\n\n  // ------------------------------------------------------------------------\n  // event handlers\n\n  function handleLocaleChangeClick(eventKey: string | null) {\n    if (eventKey === null) return\n\n    console.debug('Change locale to:', eventKey, ', from:', locale)\n    setLocale(eventKey)\n  }\n\n  // ------------------------------------------------------------------------\n  // rendering\n\n  function renderAuth() {\n    if (!import.meta.env.FEATURE_AUTHENTICATION) return null\n    if (!authEnabled) return null\n\n    if (isAuthenticated) {\n      return (\n        <Navbar.Text>\n          <i dangerouslySetInnerHTML={{ __html: personIcon }} className=\"d-md-inline d-none\" />{' '}\n          <Trans\n            i18nKey=\"header.login.signedInAs\"\n            components={[<span className=\"fw-bold\">{authName}</span>]}\n          />\n        </Navbar.Text>\n      )\n    }\n\n    // unauthorized\n    return (\n      <Nav.Link href={`${loginPath}${linkSearch ?? ''}`} disabled={!authEnabled}>\n        <i dangerouslySetInnerHTML={{ __html: personIcon }} className=\"d-md-inline d-none\" />{' '}\n        {t('header.login.login')}\n      </Nav.Link>\n    )\n  }\n\n  function renderLocales() {\n    // if only one locale available, then do not show anything...\n    if (!locales || locales.length === 1) return null\n\n    const langNames = new Intl.DisplayNames([locale, 'en'], { type: 'language' })\n\n    const currentSelectedLanguage = (\n      <>\n        <i dangerouslySetInnerHTML={{ __html: translateIcon }} className=\"d-md-inline d-none\" />\n        <span className=\"d-inline d-md-none\">{t('header.localeLabelOnMobile')}</span>{' '}\n        {locale.toUpperCase()}{' '}\n      </>\n    )\n\n    // TODO: update min-width of .dropdown-menu or add language names?\n    return (\n      <NavDropdown\n        title={currentSelectedLanguage}\n        align=\"end\"\n        className=\"ms-md-2\"\n        onSelect={handleLocaleChangeClick}\n      >\n        {locales.map((localeOption) => {\n          const langNamesLocalized = new Intl.DisplayNames([localeOption, 'en'], {\n            type: 'language',\n          })\n          return (\n            <NavDropdown.Item\n              key={localeOption}\n              disabled={localeOption === locale}\n              aria-disabled={localeOption === locale}\n              eventKey={localeOption}\n              title={t('header.localeOptionTitle', {\n                code: localeOption,\n                name: langNamesLocalized.of(localeOption),\n                // show translated language name in current active language\n                context: localeOption !== locale ? 'translated' : null,\n                translated: langNames.of(localeOption),\n              })}\n            >\n              {localeOption.toUpperCase()}  {langNamesLocalized.of(localeOption)}\n            </NavDropdown.Item>\n          )\n        })}\n        {hasHelpWithTranslationsUrl && (\n          <>\n            <NavDropdown.Divider />\n            <NavDropdown.Item\n              className=\"matomo_link text-wrap\"\n              target=\"_blank\"\n              href={urlHelpWithTranslations}\n              onClick={(e) => e.stopPropagation()}\n            >\n              {t('header.localeHelpWithTranslations')}\n            </NavDropdown.Item>\n          </>\n        )}\n      </NavDropdown>\n    )\n  }\n\n  function renderAppLogo() {\n    if (!appLogoUrl) return null\n\n    return (\n      <Navbar.Brand className=\"ms-md-4\">\n        <img\n          src={appLogoUrl}\n          alt={t('header.appLogoAlt')}\n          height={30}\n          className=\"d-inline-block align-top\"\n          onError={({ currentTarget }) => {\n            // on error, simply disable the logo element\n            console.warn('Logo not found!')\n            currentTarget.onerror = null // prevents looping\n            currentTarget.parentElement!.style.display = 'none'\n          }}\n        />\n      </Navbar.Brand>\n    )\n  }\n\n  // ------------------------------------------------------------------------\n  // UI\n\n  return (\n    <header>\n      <Navbar expand=\"md\" className=\"bg-body-tertiary\">\n        <Container>\n          <Navbar.Brand as={Link} to={{ pathname: '/', search: linkSearch }}>\n            <img\n              src={logoUrl}\n              width=\"30\"\n              height=\"30\"\n              className=\"d-inline-block align-top\"\n              alt={`${t('header.title')} logo`}\n            />{' '}\n            {t('header.title')}\n          </Navbar.Brand>\n          <Navbar.Toggle aria-controls=\"header-navbar-nav\" />\n          <Navbar.Collapse id=\"header-navbar-nav\">\n            <Nav className=\"w-100 d-flex\">\n              <Nav.Link as={NavLink} to={{ pathname: '/', search: linkSearch }}>\n                {t('header.menu.home')}\n              </Nav.Link>\n              <Nav.Link as={NavLink} to={{ pathname: '/help', search: linkSearch }}>\n                {t('header.menu.help')}\n              </Nav.Link>\n              <Navbar.Text className=\"ms-auto d-md-block d-none\" />\n              {renderAuth()}\n              {renderLocales()}\n              {renderAppLogo()}\n            </Nav>\n          </Navbar.Collapse>\n        </Container>\n      </Navbar>\n    </header>\n  )\n}\n\nexport default Header\n","/*!\n * Color mode switcher based on example from Bootstrap 5 docs.\n * @see https://getbootstrap.com/docs/5.3/customize/color-modes/#javascript\n */\n\nimport { useEffect } from 'react'\n\n// --------------------------------------------------------------------------\n\nfunction getPreferredTheme() {\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'\n}\n\nfunction setTheme(theme: string) {\n  if (theme === 'auto') {\n    document.documentElement.setAttribute(\n      'data-bs-theme',\n      window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'\n    )\n  } else {\n    document.documentElement.setAttribute('data-bs-theme', theme)\n  }\n}\n\n// --------------------------------------------------------------------------\n\n/**\n * Sets the theme for the document, adds event listener for color-scheme changes.\n * Should run once, and will stop the event listener at the lifecycle end.\n */\nexport default function useColorMode() {\n  // run once, set theme, add event listener; stop event listener on dispose\n  useEffect(() => {\n    function updateTheme() {\n      setTheme(getPreferredTheme())\n    }\n\n    console.debug('Set color mode and watch for changes ...')\n\n    // run initial update\n    updateTheme()\n\n    // start event listener\n    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme)\n    // stop event listener on dispose\n    return () =>\n      window.matchMedia('(prefers-color-scheme: dark)').removeEventListener('change', updateTheme)\n  }, [])\n}\n","import type { TOptions } from 'i18next'\nimport i18n from 'i18next'\nimport resourcesToBackend from 'i18next-resources-to-backend'\nimport { initReactI18next } from 'react-i18next'\n\nimport localeStore from '@/stores/locale'\n\nimport resourcesEnApp from '@/locales/en/app.json'\nimport resourcesEnCommon from '@/locales/en/common.json'\n\n// pre-loaded resources\nconst resources = {\n  en: {\n    app: resourcesEnApp,\n    common: resourcesEnCommon,\n  },\n}\n\n// i18n namespace prefix to allow for overriding global defaults\nexport const I18N_NS_CONTEXT_PREFIX = import.meta.env.I18N_NS_CONTEXT_PREFIX as string | undefined\n// default language\nexport const LANGUAGE = localeStore.getInitialState().locale\nexport const LANGUAGES = localeStore.getInitialState().locales\n\n// --------------------------------------------------------------------------\n\nexport function resolveNs(ns?: string[] | string, defaultNSs?: string[]) {\n  if (!ns) return defaultNSs\n  const nsParam = typeof ns === 'string' ? [ns] : ns\n  const nsAndPrefiex = I18N_NS_CONTEXT_PREFIX\n    ? [...nsParam.map((ns) => `${I18N_NS_CONTEXT_PREFIX}.${ns}`), ...nsParam]\n    : nsParam\n  return defaultNSs ? [...nsAndPrefiex, ...defaultNSs] : nsAndPrefiex\n}\n\n// --------------------------------------------------------------------------\n\n// list of all (pre-loaded namespaces)\nconst I18N_NS_ALL_BASE = ['app', 'common']\n// build list with prefixed variants with higher lookup priority\nconst I18N_NS_ALL = resolveNs(I18N_NS_ALL_BASE)\n\n// --------------------------------------------------------------------------\n\nfunction toArray(val: readonly string[] | string) {\n  return typeof val === 'string' || !Array.isArray(val) ? [String(val)] : val\n}\n\nfunction postProcessTryPrefixedNamespacesFirst(\n  value: string,\n  key: string | string[],\n  options: TOptions,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  translator: any\n): string {\n  // if no prefix defined, nothing to do here\n  if (I18N_NS_CONTEXT_PREFIX === undefined) return value\n\n  // console.debug('[postProcessor:try-prefixed-namespaces-first]', { value, key, options, translator })\n\n  // if we are recursing, then exit\n  if (options?.['postProcessTryPrefixedNamespacesFirst'] !== undefined) return value\n\n  // see: i18next/src/Translator.js\n\n  const keys = toArray(key)\n  const namespaces = toArray(options.ns || translator.options.defaultNS || [])\n  // NOTE: we do NOT do any namespaces check in keys\n\n  // check which namespaces to search for key\n  const resolved = translator.resolve(keys, options)\n\n  // we found a translation, only check namespace where key was found (and if options.ns argument)\n  // if no translation, check all namespaces\n  const namespacesToCheck =\n    resolved?.res !== undefined\n      ? [...toArray(options.ns || []), resolved.usedNS]\n      : [...toArray(options.ns || []), ...namespaces]\n  // TODO: or just namespaces?\n\n  // prefix namespaces\n  const namespacesPrefixed = namespacesToCheck.map((ns: string) =>\n    ns.startsWith(I18N_NS_CONTEXT_PREFIX) ? ns : `${I18N_NS_CONTEXT_PREFIX}.${ns}`\n  )\n\n  // use translator.translate() instead of translator.resolve() for all the fancy processing\n  const result = translator.translate(keys, {\n    ...options,\n    ns: namespacesPrefixed,\n    postProcessTryPrefixedNamespacesFirst: true, // marker to stop recursion\n  })\n\n  // const resolvedPrefixed = translator.resolve(keys, { ...options, ns: namespacesPrefixed })\n  // console.debug('[postProcessor:try-prefixed-namespaces-first]', { resolved, resolvedPrefixed, keys, namespaces, namespacesToCheck, namespacesPrefixed, result })\n\n  // return \"new\" result if not a key (not found) otherwise return default value\n  return !keys.includes(result) ? result : value\n}\n\n// NOTE: that translator.exists() will NOT work as it ignores namespaces\n\n// --------------------------------------------------------------------------\n\n// configure i18next\ni18n\n  // react integration\n  .use(initReactI18next)\n  // translation lookup with prefix\n  .use({\n    type: 'postProcessor',\n    name: 'try-prefixed-namespaces-first',\n    process: postProcessTryPrefixedNamespacesFirst,\n  })\n  // dynamic resource loading\n  .use(\n    resourcesToBackend((language: string, namespace: string) => {\n      // console.debug('[resourcesToBackend] Trying to load resources', { language, namespace })\n      const resources = import(`@/locales/${language}/${namespace}.json`)\n      // console.debug('[resourcesToBackend] Got resources', resources)\n      return resources\n    })\n  )\n  // initialization\n  .init({\n    lng: LANGUAGE,\n    fallbackLng: 'en', // TODO: this should always be \"en\" or a language with most translations!\n    supportedLngs: LANGUAGES,\n\n    // i18n all namespaces to load\n    ns: I18N_NS_ALL,\n    // i18n namespaces check for keys\n    defaultNS: I18N_NS_ALL_BASE,\n    fallbackNS: I18N_NS_ALL_BASE,\n\n    debug: import.meta.env.DEV,\n    // saveMissing: true,\n    // returnDetails: true,\n\n    interpolation: {\n      escapeValue: false,\n    },\n    // allow null to \"skip\" certain translations\n    // returnNull: true,\n\n    // TODO: for query suggestions?\n    // returnObjects: true,\n\n    postProcess: ['try-prefixed-namespaces-first'],\n\n    resources,\n    partialBundledLanguages: true,\n\n    react: {\n      // useTranslation() is able to to multiple namespaces!\n      nsMode: 'fallback',\n\n      transKeepBasicHtmlNodesFor: ['br', 'strong', 'i', 'p', 'em', 'kbd', 'code'],\n    },\n  })\n\n// DEBUG\nObject.assign(window, { i18n })\n\nexport default i18n\n","import { useEffect } from 'react'\n\n// from: https://stackoverflow.com/a/34425083/9360161\n\nfunction addScriptActions(url: string): [() => void, () => void] {\n  let script: HTMLScriptElement | null = null\n  const container = document.body\n\n  function addScript() {\n    script = document.createElement('script')\n\n    script.src = url\n    script.async = true\n\n    container.appendChild(script)\n  }\n\n  function removeScript() {\n    if (script === null) return\n\n    container.removeChild(script)\n  }\n\n  return [addScript, removeScript]\n}\n\nexport default function useScript(\n  url: string | null | undefined,\n  { delay = undefined }: { delay?: number } = {}\n) {\n  useEffect(() => {\n    if (!url) return\n\n    const [addScript, removeScript] = addScriptActions(url)\n\n    let timeoutId: NodeJS.Timeout | undefined = undefined\n    if (delay !== undefined && delay > 0) {\n      timeoutId = setTimeout(() => {\n        addScript()\n      }, delay)\n    } else {\n      addScript()\n    }\n\n    return () => {\n      if (timeoutId !== undefined) clearTimeout(timeoutId)\n      removeScript()\n    }\n  }, [url, delay])\n}\n","// https://github.com/bryc/code/blob/master/jshash/experimental/cyrb53.js\n\n/*\n    cyrb53 (c) 2018 bryc (github.com/bryc)\n    License: Public domain (or MIT if needed). Attribution appreciated.\n    A fast and simple 53-bit string hash function with decent collision resistance.\n    Largely inspired by MurmurHash2/3, but with a focus on speed/simplicity.\n*/\nexport default function cyrb53(str: string, seed = 0) {\n  let h1 = 0xdeadbeef ^ seed\n  let h2 = 0x41c6ce57 ^ seed\n  for (let i = 0, ch; i < str.length; i++) {\n    ch = str.charCodeAt(i)\n    h1 = Math.imul(h1 ^ ch, 2654435761)\n    h2 = Math.imul(h2 ^ ch, 1597334677)\n  }\n  h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507)\n  h1 ^= Math.imul(h2 ^ (h2 >>> 13), 3266489909)\n  h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507)\n  h2 ^= Math.imul(h1 ^ (h1 >>> 13), 3266489909)\n  return 4294967296 * (2097151 & h2) + (h1 >>> 0)\n}\n\n/*\n    cyrb53a beta (c) 2023 bryc (github.com/bryc)\n    License: Public domain (or MIT if needed). Attribution appreciated.\n    This is a work-in-progress, and changes to the algorithm are expected.\n    The original cyrb53 has a slight mixing bias in the low bits of h1.\n    This doesn't affect collision rate, but I want to try to improve it.\n    This new version has preliminary improvements in avalanche behavior.\n*/\nexport function cyrb53a_beta(str: string, seed = 0) {\n  let h1 = 0xdeadbeef ^ seed\n  let h2 = 0x41c6ce57 ^ seed\n  for (let i = 0, ch; i < str.length; i++) {\n    ch = str.charCodeAt(i)\n    h1 = Math.imul(h1 ^ ch, 0x85ebca77)\n    h2 = Math.imul(h2 ^ ch, 0xc2b2ae3d)\n  }\n  h1 ^= Math.imul(h1 ^ (h2 >>> 15), 0x735a2d97)\n  h2 ^= Math.imul(h2 ^ (h1 >>> 15), 0xcaf649a9)\n  h1 ^= h2 >>> 16\n  h2 ^= h1 >>> 16\n  return 2097152 * (h2 >>> 0) + (h1 >>> 11)\n}\n","import cyrb53 from '@/utils/cyrb53'\n\n// --------------------------------------------------------------------------\n\n// declare global {\n//   interface Window {\n//     _paq: { push: (params: unknown[]) => void }\n//   }\n// }\n\ndeclare const window: Window &\n  typeof globalThis & {\n    _paq: unknown[] | { push: (params: unknown[]) => void }\n  }\n\nexport interface SetupParams {\n  siteId: number\n  trackerUrl: string\n  enableLinkTracking?: boolean\n  domains?: string[]\n  userId?: string\n}\n\ninterface InstallScriptParams {\n  srcUrl: string\n}\n\ninterface OptOutScriptParams {\n  indexUrl?: string\n}\n\nexport type SetupAndInstallScriptParams = SetupParams & InstallScriptParams & OptOutScriptParams\n\n// --------------------------------------------------------------------------\n\nwindow._paq = window['_paq'] || []\n\n// --------------------------------------------------------------------------\n\nexport function setup({\n  siteId,\n  trackerUrl,\n  enableLinkTracking = true,\n  domains = [],\n  userId = undefined,\n}: SetupParams) {\n  window._paq.push(['setTrackerUrl', trackerUrl])\n  window._paq.push(['setSiteId', siteId])\n\n  if (userId) {\n    // should optimally a hashed ID\n    window._paq.push(['setUserId', userId])\n  }\n\n  if (Array.isArray(domains) && domains.length > 0) {\n    window._paq.push(['setDomains', domains])\n  }\n\n  if (enableLinkTracking) {\n    window._paq.push(['enableLinkTracking'])\n    // https://developer.matomo.org/guides/tracking-javascript-guide#changing-the-pause-timer\n    window._paq.push(['setLinkTrackingTimer', 250]) // 250 milliseconds\n  }\n}\n\nexport function installScript({ srcUrl }: InstallScriptParams) {\n  // https://developer.matomo.org/guides/tracking-javascript-guide\n  const script = document.createElement('script')\n  const scripts = document.getElementsByTagName('script')[0]\n\n  script.type = 'text/javascript'\n  script.async = true\n  script.defer = true\n  script.src = srcUrl\n\n  if (scripts && scripts.parentNode) {\n    scripts.parentNode.insertBefore(script, scripts)\n  }\n}\n\nexport function getConfig(configString: string | SetupAndInstallScriptParams | null | undefined) {\n  if (!configString) return null\n\n  let params: SetupAndInstallScriptParams | null = null\n  if (typeof configString === 'string') {\n    try {\n      params = JSON.parse(configString)\n      console.debug('tracking params', params)\n    } catch (error) {\n      console.error('Error trying to parse tracking params!', error)\n      return null\n    }\n  } else if (typeof configString === 'object') {\n    params = configString\n    console.debug('tracking params (object)', params)\n  }\n\n  if (params) {\n    if (!Object.hasOwn(params, 'indexUrl') && Object.hasOwn(params, 'srcUrl')) {\n      const srcUrl = params['srcUrl']\n      const baseUrl = srcUrl.split('/').slice(0, -1).join('/')\n      const indexUrl = `${baseUrl}/index.php`\n      console.debug('Computed matomo indexUrl=', indexUrl, ' from srcUrl=', srcUrl)\n      params['indexUrl'] = indexUrl\n    }\n  }\n\n  return params\n}\n\nexport function setupAndInstallFromConfigString(\n  configString?: string | SetupAndInstallScriptParams | null\n) {\n  const params = getConfig(configString)\n  if (params === null) return false\n\n  const siteId = params['siteId']\n  const trackerUrl = params['trackerUrl']\n  const srcUrl = params['srcUrl']\n  const domains = params['domains'] // can be undefined or empty array\n  const userId = params['userId']?.toString()\n\n  if (srcUrl === undefined) {\n    console.warn('No \"srcUrl\" configuration set for tracking!')\n    return false\n  }\n  if (trackerUrl === undefined) {\n    console.warn('No \"trackerUrl\" configuration set for tracking!')\n    return false\n  }\n  if (siteId === undefined || !Number.isInteger(siteId)) {\n    console.warn('No \"siteId\" configuration set for tracking!')\n    return false\n  }\n\n  const setupParams = { siteId, trackerUrl, domains } as SetupParams\n  if (userId) setupParams['userId'] = cyrb53(userId).toString()\n  const installParams = { srcUrl }\n\n  setup(setupParams)\n  trackPageView(document.location.href || window.location.href, document.title)\n  installScript(installParams)\n\n  return true // should be successful\n}\n\n// --------------------------------------------------------------------------\n\nexport function trackPageView(url: string, title?: string, referrerUrl?: string) {\n  window._paq.push(['setDocumentTitle', title ?? document.title])\n  window._paq.push(['setCustomUrl', url])\n  if (referrerUrl !== undefined) window._paq.push(['setReferrerUrl', referrerUrl])\n  window._paq.push(['trackPageView'])\n}\n\nexport function trackSiteSearch(\n  query: string,\n  category: string | boolean = false,\n  count: number | boolean = false\n) {\n  // TODO: category for \"search\"/\"search-more\" vs. cql/fcs/lex/...?\n  // TODO: custom dimension for search params (queryType, numberOfResults, resourceIDs)\n  window._paq.push(['trackSiteSearch', query, category, count])\n}\n\nexport function trackSiteSearchWithDimensions(\n  query: string,\n  category: string | boolean = false,\n  count: number | boolean = false,\n  dimensions: { [key: string]: unknown }\n) {\n  window._paq.push(['trackSiteSearch', query, category, count, dimensions])\n}\n\n// --------------------------------------------------------------------------\n","export interface Technology {\n  id: string\n  name: string\n  url?: string\n  license?: string\n  licenseUrl?: string\n  usage?: string\n  hide?: boolean\n}\n\n// --------------------------------------------------------------------------\n\n// TODO: add affiliations?\nexport const people = [\n  'Emanuel Dima',\n  'Erik Krner',\n  'Leif-Jran Olsson',\n  'Yana Panchenko',\n  'Oliver Schonefeld',\n  'Dieter Van Uytvanck',\n]\n\nexport const technologiesBackend: readonly Technology[] = [\n  {\n    id: 'dropwizard',\n    name: 'Dropwizard',\n    url: 'https://www.dropwizard.io/',\n    license: 'Apache License 2.0',\n    licenseUrl: 'https://github.com/dropwizard/dropwizard/blob/release/3.0.x/LICENSE',\n    usage: 'web server',\n  },\n  {\n    id: 'de.mpg.mpgaai:mpgaai-shhaa',\n    name: 'MPG-AAI - simple http header authn/z',\n    url: 'https://github.com/clarin-eric/mpgaai', // TODO: ...\n    license: 'Apache License 2.0',\n    licenseUrl: 'http://www.apache.org/licenses/LICENSE-2.0.txt',\n    usage: 'AAI / Shibboleth support',\n  },\n  {\n    id: 'io.swagger.core.v3',\n    name: 'Swagger Core',\n    url: 'https://github.com/swagger-api/swagger-core',\n    license: 'Apache License 2.0',\n    licenseUrl: 'https://github.com/swagger-api/swagger-core/blob/master/LICENSE',\n    usage: 'REST API documentation',\n  },\n  {\n    id: 'org.glassfish.jersey',\n    name: 'Eclipse Jersey',\n    url: 'https://eclipse-ee4j.github.io/jersey/',\n    license: 'Eclipse Public License 2.0',\n    licenseUrl: 'https://github.com/eclipse-ee4j/jersey/blob/2.x/LICENSE.md',\n    usage: 'RESTful web services',\n  },\n  {\n    id: 'org.slf4j',\n    name: 'Simple Logging Facade for Java (SLF4J)',\n    url: 'https://www.slf4j.org/',\n    license: 'MIT License',\n    licenseUrl: 'https://www.slf4j.org/license.html',\n    usage: 'logging',\n  },\n  {\n    id: 'org.junit',\n    name: 'JUnit 5',\n    url: 'https://junit.org/',\n    license: 'Eclipse Public License 2.0',\n    licenseUrl: 'https://github.com/junit-team/junit-framework/blob/main/LICENSE.md',\n    usage: 'testing',\n  },\n  {\n    id: 'optimaize/language-detector',\n    name: 'Optimaize Language Detector',\n    url: 'https://github.com/optimaize/language-detector',\n    license: 'Apache License 2.0',\n    licenseUrl: 'https://github.com/optimaize/language-detector/blob/master/LICENSE',\n    usage: 'language detection of results',\n  },\n  {\n    id: 'org.apache.commons:commons-text',\n    name: 'Apache Commons Text',\n    url: 'https://commons.apache.org/proper/commons-text/',\n    license: 'Apache License 2.0',\n    licenseUrl: 'https://github.com/apache/commons-text/blob/master/LICENSE.txt',\n    usage: 'export format',\n  },\n  {\n    id: 'com.sun.xml.bind',\n    name: 'JAXB Reference Implementation',\n    url: 'https://eclipse-ee4j.github.io/jaxb-ri/',\n    license: 'Common Development and Distribution License (CCDL) 1.1',\n    licenseUrl: 'https://github.com/javaee/jaxb-v2/blob/2.3.0.1/jaxb-ri/License.txt',\n    usage: 'XML support',\n    hide: true,\n  },\n  {\n    id: 'eu.clarin.weblicht:wlfxb',\n    name: 'Weblicht wlfxb',\n    url: 'https://weblicht.sfs.uni-tuebingen.de',\n    license: 'GNU Lesser General Public License v3.0',\n    licenseUrl: 'https://github.com/weblicht/wlfxb/blob/master/LICENSE.txt',\n    usage: 'export format',\n  },\n  {\n    id: 'org.apache.poi:poi-ooxml',\n    name: 'Apache POI', // API Based On OPC and OOXML Schemas\n    url: 'https://poi.apache.org/',\n    license: 'Apache License 2.0',\n    licenseUrl: 'https://github.com/apache/poi/blob/trunk/legal/LICENSE',\n    usage: 'export format',\n  },\n  {\n    id: 'org.jopendocument:jOpenDocument',\n    name: 'jOpenDocument',\n    url: 'https://www.jopendocument.org/',\n    license: 'GNU Lesser General Public License v3.0',\n    licenseUrl: 'https://www.jopendocument.org/support.html',\n    usage: 'export format',\n  },\n  {\n    id: 'eu.clarin.sru:sru-client',\n    name: 'CLARIN SRU/CQL Client',\n    license: 'GNU General Public License v3.0',\n    licenseUrl: 'https://github.com/clarin-eric/fcs-sru-client/blob/main/LICENSE.txt',\n    usage: 'SRU / CQL client framework',\n    hide: true,\n  },\n  {\n    id: 'eu.clarin.sru.fcs:fcs-simple-client',\n    name: 'CLARIN-FCS Client',\n    license: 'GNU General Public License v3.0',\n    licenseUrl: 'https://github.com/clarin-eric/fcs-simple-client/blob/main/LICENSE.txt',\n    usage: 'FCS client framework',\n    hide: true,\n  },\n]\n\nexport const technologiesFrontEnd: readonly Technology[] = [\n  {\n    id: 'react',\n    name: 'React',\n    url: 'https://react.dev/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/facebook/react/blob/main/LICENSE',\n  },\n  {\n    id: 'react-dom',\n    name: 'ReactDOM',\n    url: 'https://react.dev/reference/react-dom',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/facebook/react/blob/main/LICENSE',\n    hide: true,\n  },\n  {\n    id: 'react-router',\n    name: 'React Router',\n    url: 'https://reactrouter.com/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/remix-run/react-router/blob/main/LICENSE.md',\n    usage: 'single page application routing',\n  },\n  {\n    id: 'react-bootstrap',\n    name: 'React Bootstrap',\n    url: 'https://react-bootstrap.netlify.app/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/react-bootstrap/react-bootstrap/blob/master/LICENSE',\n    usage: 'react bindings for bootstrap',\n  },\n  {\n    id: 'bootstrap',\n    name: 'Bootstrap',\n    url: 'https://getbootstrap.com/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/twbs/bootstrap/blob/main/LICENSE',\n    usage: 'UI framework',\n  },\n  {\n    id: 'bootstrap-icons',\n    name: 'Bootstrap Icons',\n    url: 'https://icons.getbootstrap.com/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/twbs/icons/blob/main/LICENSE',\n  },\n  {\n    id: '@tanstack/react-query',\n    name: 'TanStack Query',\n    url: 'https://tanstack.com/query',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/TanStack/query/blob/main/LICENSE',\n    usage: 'data loading via REST APIs',\n  },\n  {\n    id: 'axios',\n    name: 'Axios',\n    url: 'https://axios-http.com/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/axios/axios/blob/v1.x/LICENSE',\n    usage: 'cross-browser support for REST API requests',\n  },\n  {\n    id: 'antlr4ng',\n    name: 'Next Generation TypeScript runtime for ANTLR4',\n    url: 'https://github.com/mike-lischke/antlr4ng',\n    license: 'The \"BSD license\"',\n    licenseUrl: 'https://github.com/mike-lischke/antlr4ng/blob/main/LICENSE.txt',\n    usage: 'query parser',\n  },\n  {\n    id: 'i18next',\n    name: 'i18next',\n    url: 'https://www.i18next.com/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/i18next/i18next/blob/master/LICENSE',\n    usage: 'translations',\n  },\n  {\n    id: 'react-i18next',\n    name: 'react-i18next',\n    url: 'https://react.i18next.com/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/i18next/react-i18next/blob/master/LICENSE',\n    usage: 'translations',\n    hide: true,\n  },\n  {\n    id: 'i18next-resources-to-backend',\n    name: 'i18next-resources-to-backend',\n    url: 'https://github.com/i18next/i18next-resources-to-backend',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/i18next/i18next-resources-to-backend/blob/main/licence',\n    usage: 'translation resource loading',\n    hide: true,\n  },\n  {\n    id: 'zustand',\n    name: 'Zustand',\n    url: 'https://zustand-demo.pmnd.rs/',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/pmndrs/zustand/blob/main/LICENSE',\n    usage: 'state management',\n  },\n  {\n    id: '@nozbe/microfuzz',\n    name: 'microfuzz',\n    url: 'https://github.com/Nozbe/microfuzz',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/Nozbe/microfuzz/blob/main/LICENSE',\n    usage: 'fuzzy search',\n  },\n  {\n    id: 'react-helmet-async',\n    name: 'React Helmet (async fork)',\n    url: 'https://github.com/staylor/react-helmet-async',\n    license: 'Apache License 2.0',\n    licenseUrl: 'https://github.com/staylor/react-helmet-async/blob/main/LICENSE',\n    usage: 'HTML head modifications',\n  },\n  {\n    id: 'react-slugify',\n    name: 'react-slugify',\n    url: 'https://github.com/martpie/react-slugify',\n    license: 'MIT License',\n    licenseUrl: 'https://github.com/martpie/react-slugify/blob/master/LICENSE',\n    usage: 'jump id fragment generation',\n  },\n]\n","import Card from 'react-bootstrap/Card'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport { Helmet } from 'react-helmet-async'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { Link } from 'react-router'\n\nimport useKeepSearchParams from '@/hooks/useKeepSearchParams'\nimport useScript from '@/hooks/useScript'\nimport AppStore from '@/stores/app'\nimport { useLocaleStore } from '@/stores/locale'\nimport { getConfig } from '@/utils/matomo'\nimport { people, technologiesBackend, technologiesFrontEnd, type Technology } from './data'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n\nfunction About() {\n  const { t } = useTranslation()\n\n  const userLocale = useLocaleStore((state) => state.locale)\n\n  const i18nKeyTerms = 'urls.termsUseAndDisclaimer'\n  const urlTerms = t(i18nKeyTerms, { ns: 'common' })\n\n  const hasTerms = urlTerms !== i18nKeyTerms\n  const hasMatomo = AppStore.getState().matomoTrackingEnabled\n  const matomoIndexUrl = getConfig(AppStore.getState().matomoTrackingParams)?.['indexUrl']\n  const matomoOptOutScript = matomoIndexUrl\n    ? `${matomoIndexUrl}?module=CoreAdminHome&action=optOutJS&language=auto&div=matomo-opt-out`\n    : null\n\n  // need to add script like this to work (add a bit of delay in case rending might take a bit)\n  useScript(matomoOptOutScript, { delay: 300 })\n\n  const appTitleHead = AppStore.getState().appTitleHead\n\n  const [linkSearch] = useKeepSearchParams()\n\n  const hasApplicationVersionInfo =\n    import.meta.env.VITE_GIT_APP_INFO_TAG ||\n    import.meta.env.VITE_GIT_APP_INFO_TAG ||\n    import.meta.env.VITE_GIT_APP_INFO_REF ||\n    import.meta.env.GIT_APP_INFO_DATE\n\n  // whether to show two column info with backend and frontend (or just the frontend)\n  const showBackendInfos = hasApplicationVersionInfo\n\n  // ------------------------------------------------------------------------\n\n  function renderTechnologiesList(technologies: readonly Technology[]) {\n    return (\n      <ul>\n        {technologies\n          .filter((technology) => technology.hide !== true)\n          .map((technology) => (\n            <li key={technology.id}>\n              {technology.url ? (\n                <a href={technology.url}>{technology.name}</a>\n              ) : (\n                <span>{technology.name}</span>\n              )}\n              {technology.license && (\n                <>\n                  {' '}\n                  (\n                  {technology.licenseUrl ? (\n                    <a href={technology.licenseUrl}>{technology.license}</a>\n                  ) : (\n                    <span>{technology.license}</span>\n                  )}\n                  )\n                </>\n              )}\n            </li>\n          ))}\n      </ul>\n    )\n  }\n\n  function renderDateTime(datetime: string) {\n    const date = Date.parse(datetime)\n    return Intl.DateTimeFormat(userLocale, { dateStyle: 'medium', timeStyle: 'long' }).format(date)\n  }\n\n  // ------------------------------------------------------------------------\n\n  return (\n    <>\n      <Helmet>\n        <title>{appTitleHead}  About</title>\n      </Helmet>\n      <Container className=\"py-4\">\n        <h1 className=\"h1 mb-4\">{t('about.title')}</h1>\n\n        {/* TODO: short intro describing the FCS Aggregator */}\n\n        <div>\n          <h2 className=\"h2\">{t('about.people.title')}</h2>\n          <p>{t('about.people.developedBy')}</p>\n          <ul>\n            {people.map((person) => (\n              <li key={person}>{person}</li>\n            ))}\n          </ul>\n        </div>\n\n        <div>\n          <h2 className=\"h2\">{t('about.statistics.title')}</h2>\n          <p>\n            <Trans\n              i18nKey=\"about.statistics.text\"\n              components={[\n                <Link to={{ pathname: '/stats', search: linkSearch }}>endpoint statistics</Link>,\n              ]}\n            />\n          </p>\n        </div>\n\n        {(hasTerms || hasMatomo) && (\n          <div>\n            <h2 className=\"h2\">{t('about.privacyPolicy.title')}</h2>\n            {hasTerms && (\n              <p>\n                <Trans\n                  i18nKey=\"about.privacyPolicy.termsInfo\"\n                  components={[<a href={urlTerms}>clarin.eu</a>]}\n                />\n              </p>\n            )}\n            {hasMatomo && (\n              <>\n                <p>\n                  <Trans\n                    i18nKey=\"about.privacyPolicy.matomoInfo\"\n                    components={[<a href=\"https://matomo.org/\">Matomo</a>]}\n                  />\n                  {/* TODO: [text] You can explicitely opt-out by using the following form ... */}\n                </p>\n\n                {matomoOptOutScript && (\n                  <Card className=\"mb-3\" id=\"matomo-opt-out-container\">\n                    <Card.Body id=\"matomo-opt-out\" />\n                  </Card>\n                )}\n              </>\n            )}\n          </div>\n        )}\n\n        <div>\n          <h2 className=\"h2\">{t('about.sourceCode.title')}</h2>\n          <p>\n            <Trans\n              i18nKey=\"about.sourceCode.sourceInfo.text\"\n              components={[\n                <a href={t('about.sourceCode.sourceInfo.repoUrl')}>GitHub</a>,\n                <a href={t('about.sourceCode.sourceInfo.licenseUrl')}>GPL 3.0 license</a>,\n              ]}\n            />\n          </p>\n          <p>{t('about.sourceCode.licenseInfo')}</p>\n        </div>\n\n        <div>\n          <h2 className=\"h2\">{t('about.versions.title')}</h2>\n          <Row>\n            {showBackendInfos && hasApplicationVersionInfo && (\n              <Col md={12} lg={6}>\n                <p>{t('about.versions.backend.text')}</p>\n                <dl className=\"ms-4\">\n                  <dt>{t('about.versions.backend.lblVersion')}</dt>\n                  <dd>\n                    <code>{import.meta.env.APPLICATION_VERSION}</code>\n                  </dd>\n                  {import.meta.env.GIT_APP_INFO_SHA && (\n                    <>\n                      <dt>{t('about.versions.backend.lblSHA')}</dt>\n                      <dd>\n                        <code>{import.meta.env.GIT_APP_INFO_SHA}</code>\n                      </dd>\n                    </>\n                  )}\n                  {import.meta.env.VITE_GIT_APP_INFO_TAG && (\n                    <>\n                      <dt>{t('about.versions.backend.lblTag')}</dt>\n                      <dd>\n                        <code>{import.meta.env.VITE_GIT_APP_INFO_TAG}</code>\n                      </dd>\n                    </>\n                  )}\n                  {import.meta.env.VITE_GIT_APP_INFO_REF && (\n                    <>\n                      <dt>{t('about.versions.backend.lblRef')}</dt>\n                      <dd>\n                        <code>{import.meta.env.VITE_GIT_APP_INFO_REF}</code>\n                      </dd>\n                    </>\n                  )}\n                  {import.meta.env.GIT_APP_INFO_DATE && (\n                    <>\n                      <dt>{t('about.versions.backend.lblDate')}</dt>\n                      <dd>{renderDateTime(import.meta.env.GIT_APP_INFO_DATE)}</dd>\n                    </>\n                  )}\n                </dl>\n              </Col>\n            )}\n            <Col md={12} lg={showBackendInfos && hasApplicationVersionInfo ? 6 : 12}>\n              {showBackendInfos && hasApplicationVersionInfo && (\n                <p>{t('about.versions.frontend.text')}</p>\n              )}\n              <dl className={hasApplicationVersionInfo ? 'ms-4' : ''}>\n                <dt>{t('about.versions.frontend.lblVersion')}</dt>\n                <dd>\n                  <code>{import.meta.env.UI_VERSION}</code>\n                </dd>\n                <dt>{t('about.versions.frontend.lblSHA')}</dt>\n                <dd>\n                  <code>{import.meta.env.GIT_UI_INFO_SHA}</code>\n                </dd>\n                {import.meta.env.GIT_UI_INFO_REF &&\n                  import.meta.env.GIT_UI_INFO_REF !== import.meta.env.GIT_UI_INFO_SHA && (\n                    <>\n                      <dt>{t('about.versions.frontend.lblRef')}</dt>\n                      <dd>\n                        <code>{import.meta.env.GIT_UI_INFO_REF}</code>\n                      </dd>\n                    </>\n                  )}\n                <dt>{t('about.versions.frontend.lblDate')}</dt>\n                <dd>{renderDateTime(import.meta.env.GIT_UI_INFO_DATE)}</dd>\n              </dl>\n            </Col>\n          </Row>\n        </div>\n\n        <div>\n          <h2 className=\"h2\">{t('about.technology.title')}</h2>\n          <Row>\n            {showBackendInfos && (\n              <Col md={12} lg={6}>\n                <p>{t('about.technology.backendUses')}</p>\n                {renderTechnologiesList(technologiesBackend)}\n              </Col>\n            )}\n            <Col md={12} lg={showBackendInfos ? 6 : 12}>\n              <p>{t('about.technology.frontendUses')}</p>\n              {renderTechnologiesList(technologiesFrontEnd)}\n            </Col>\n          </Row>\n          {/* TODO: [text] fancy FCS logo by ... */}\n          <p>\n            <Trans\n              i18nKey=\"about.technology.iconLicenseInfo\"\n              components={[\n                <a href=\"http://www.freepik.com/\">Freepik</a>,\n                <a href=\"www.flaticon.com\">www.flaticon.com</a>,\n                <a href=\"http://creativecommons.org/licenses/by/3.0/\">CC BY 3.0</a>,\n              ]}\n            />\n          </p>\n        </div>\n\n        {/* <div>\n          <h2 className=\"h2\">{t('about.funding.title')}</h2>\n        </div> */}\n      </Container>\n    </>\n  )\n}\n\nexport default About\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-eye-fill\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0\\\"/>\\n  <path d=\\\"M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-magic\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707zM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1zM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707zM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-arrow-clockwise\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path fill-rule=\\\"evenodd\\\" d=\\\"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z\\\"/>\\n  <path d=\\\"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-balloon\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path fill-rule=\\\"evenodd\\\" d=\\\"M8 9.984C10.403 9.506 12 7.48 12 5a4 4 0 0 0-8 0c0 2.48 1.597 4.506 4 4.984M13 5c0 2.837-1.789 5.227-4.52 5.901l.244.487a.25.25 0 1 1-.448.224l-.008-.017c.008.11.02.202.037.29.054.27.161.488.419 1.003.288.578.235 1.15.076 1.629-.157.469-.422.867-.588 1.115l-.004.007a.25.25 0 1 1-.416-.278c.168-.252.4-.6.533-1.003.133-.396.163-.824-.049-1.246l-.013-.028c-.24-.48-.38-.758-.448-1.102a3 3 0 0 1-.052-.45l-.04.08a.25.25 0 1 1-.447-.224l.244-.487C4.789 10.227 3 7.837 3 5a5 5 0 0 1 10 0m-6.938-.495a2 2 0 0 1 1.443-1.443C7.773 2.994 8 2.776 8 2.5s-.226-.504-.498-.459a3 3 0 0 0-2.46 2.461c-.046.272.182.498.458.498s.494-.227.562-.495\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-bank\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"m8 0 6.61 3h.89a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H15v7a.5.5 0 0 1 .485.38l.5 2a.498.498 0 0 1-.485.62H.5a.498.498 0 0 1-.485-.62l.5-2A.5.5 0 0 1 1 13V6H.5a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 .5 3h.89zM3.777 3h8.447L8 1zM2 6v7h1V6zm2 0v7h2.5V6zm3.5 0v7h1V6zm2 0v7H12V6zM13 6v7h1V6zm2-1V4H1v1zm-.39 9H1.39l-.25 1h13.72z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-braces\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M2.114 8.063V7.9c1.005-.102 1.497-.615 1.497-1.6V4.503c0-1.094.39-1.538 1.354-1.538h.273V2h-.376C3.25 2 2.49 2.759 2.49 4.352v1.524c0 1.094-.376 1.456-1.49 1.456v1.299c1.114 0 1.49.362 1.49 1.456v1.524c0 1.593.759 2.352 2.372 2.352h.376v-.964h-.273c-.964 0-1.354-.444-1.354-1.538V9.663c0-.984-.492-1.497-1.497-1.6M13.886 7.9v.163c-1.005.103-1.497.616-1.497 1.6v1.798c0 1.094-.39 1.538-1.354 1.538h-.273v.964h.376c1.613 0 2.372-.759 2.372-2.352v-1.524c0-1.094.376-1.456 1.49-1.456V7.332c-1.114 0-1.49-.362-1.49-1.456V4.352C13.51 2.759 12.75 2 11.138 2h-.376v.964h.273c.964 0 1.354.444 1.354 1.538V6.3c0 .984.492 1.497 1.497 1.6\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-download\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5\\\"/>\\n  <path d=\\\"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-envelope-arrow-up\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4.5a.5.5 0 0 1-1 0V5.383l-7 4.2-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h5.5a.5.5 0 0 1 0 1H2a2 2 0 0 1-2-1.99zm1 7.105 4.708-2.897L1 5.383zM1 4v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1\\\"/>\\n  <path d=\\\"M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.354-5.354 1.25 1.25a.5.5 0 0 1-.708.708L13 12.207V14a.5.5 0 0 1-1 0v-1.717l-.28.305a.5.5 0 0 1-.737-.676l1.149-1.25a.5.5 0 0 1 .722-.016\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-exclamation-triangle\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z\\\"/>\\n  <path d=\\\"M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-eye\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z\\\"/>\\n  <path d=\\\"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-gear-fill\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-highlights\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M16 8A8 8 0 1 0 0 8a8 8 0 0 0 16 0m-8 5v1H4.5a.5.5 0 0 0-.093.009A7 7 0 0 1 3.1 13zm0-1H2.255a7 7 0 0 1-.581-1H8zm-6.71-2a7 7 0 0 1-.22-1H8v1zM1 8q0-.51.07-1H8v1zm.29-2q.155-.519.384-1H8v1zm.965-2q.377-.54.846-1H8v1zm2.137-2A6.97 6.97 0 0 1 8 1v1z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-house-door\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-info-circle\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16\\\"/>\\n  <path d=\\\"m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-link-45deg\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z\\\"/>\\n  <path d=\\\"M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-plus-circle\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16\\\"/>\\n  <path d=\\\"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-repeat\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-search\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-shield-check\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.652.42.893.533q.18.085.293.118a1 1 0 0 0 .101.025 1 1 0 0 0 .1-.025q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7 7 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7 7 0 0 1-1.048-.625 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 63 63 0 0 1 5.072.56\\\"/>\\n  <path d=\\\"M10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-shield-lock\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.652.42.893.533q.18.085.293.118a1 1 0 0 0 .101.025 1 1 0 0 0 .1-.025q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7 7 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7 7 0 0 1-1.048-.625 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 63 63 0 0 1 5.072.56\\\"/>\\n  <path d=\\\"M9.5 6.5a1.5 1.5 0 0 1-1 1.415l.385 1.99a.5.5 0 0 1-.491.595h-.788a.5.5 0 0 1-.49-.595l.384-1.99a1.5 1.5 0 1 1 2-1.415\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-three-dots\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3\\\"/>\\n</svg>\"","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-x-circle\\\" viewBox=\\\"0 0 16 16\\\">\\n  <path d=\\\"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16\\\"/>\\n  <path d=\\\"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708\\\"/>\\n</svg>\"","import Badge from 'react-bootstrap/Badge'\nimport Card from 'react-bootstrap/Card'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport { Helmet } from 'react-helmet-async'\nimport { Trans, useTranslation } from 'react-i18next'\n\nimport AppStore from '@/stores/app'\n\nimport eyeFillIcon from 'bootstrap-icons/icons/eye-fill.svg?raw'\nimport magicIcon from 'bootstrap-icons/icons/magic.svg?raw'\n\nimport arrowClockwiseIcon from 'bootstrap-icons/icons/arrow-clockwise.svg?raw'\nimport balloonIcon from 'bootstrap-icons/icons/balloon.svg?raw'\nimport bankIcon from 'bootstrap-icons/icons/bank.svg?raw'\nimport bracesIcon from 'bootstrap-icons/icons/braces.svg?raw'\nimport downloadIcon from 'bootstrap-icons/icons/download.svg?raw'\nimport envelopeArrowUpIcon from 'bootstrap-icons/icons/envelope-arrow-up.svg?raw'\nimport exclamationTriangleIcon from 'bootstrap-icons/icons/exclamation-triangle.svg?raw'\nimport eyeIcon from 'bootstrap-icons/icons/eye.svg?raw'\nimport fileEarmarkCodeIcon from 'bootstrap-icons/icons/file-earmark-code.svg?raw'\nimport gearIcon from 'bootstrap-icons/icons/gear-fill.svg?raw'\nimport highlightsIcon from 'bootstrap-icons/icons/highlights.svg?raw'\nimport houseDoorIcon from 'bootstrap-icons/icons/house-door.svg?raw'\nimport infoCircleIcon from 'bootstrap-icons/icons/info-circle.svg?raw'\nimport link45degIcon from 'bootstrap-icons/icons/link-45deg.svg?raw'\nimport personIcon from 'bootstrap-icons/icons/person.svg?raw'\nimport plusCircleIcon from 'bootstrap-icons/icons/plus-circle.svg?raw'\nimport repeatIcon from 'bootstrap-icons/icons/repeat.svg?raw'\nimport searchIcon from 'bootstrap-icons/icons/search.svg?raw'\nimport shieldCheckIcon from 'bootstrap-icons/icons/shield-check.svg?raw'\nimport shieldLockIcon from 'bootstrap-icons/icons/shield-lock.svg?raw'\nimport threeDotsIcon from 'bootstrap-icons/icons/three-dots.svg?raw'\nimport translateIcon from 'bootstrap-icons/icons/translate.svg?raw'\nimport xCircleIcon from 'bootstrap-icons/icons/x-circle.svg?raw'\n\n// a mapping of all icons used\nconst iconMap: { [iconKey: string]: string } = {\n  'arrow-clockwise': arrowClockwiseIcon,\n  'envelope-arrow-up': envelopeArrowUpIcon,\n  'exclamation-triangle': exclamationTriangleIcon,\n  'eye-fill': eyeFillIcon,\n  'gear-fill': gearIcon,\n  'house-door': houseDoorIcon,\n  'info-circle': infoCircleIcon,\n  'link-45deg': link45degIcon,\n  'three-dots': threeDotsIcon,\n  balloon: balloonIcon,\n  bank: bankIcon,\n  download: downloadIcon,\n  eye: eyeIcon,\n  highlights: highlightsIcon,\n  // TODO: adjust help texts to support no-querybuilder distributions\n  magic: magicIcon,\n  search: searchIcon,\n  translate: translateIcon,\n}\n// optional icons based on build\nif (import.meta.env.FEATURE_QUERY_BUILDER) {\n  Object.assign(iconMap, {\n    'plus-circle': plusCircleIcon,\n    'x-circle': xCircleIcon,\n    braces: bracesIcon,\n    magic: magicIcon,\n    repeat: repeatIcon,\n  } as { [iconKey: string]: string })\n}\nif (import.meta.env.FEATURE_AUTHENTICATION) {\n  Object.assign(iconMap, {\n    'shield-check': shieldCheckIcon,\n    'shield-lock': shieldLockIcon,\n    person: personIcon,\n  } as { [iconKey: string]: string })\n}\nif (import.meta.env.SHOW_SEARCH_RESULT_DEV_URLS) {\n  Object.assign(iconMap, {\n    'file-earmark-code': fileEarmarkCodeIcon,\n  } as { [iconKey: string]: string })\n}\n\ninterface I18NIconsLegendInfo {\n  label: string\n  description: string\n  context?: string[]\n}\ninterface I18NIconsLegendInfoList {\n  [key: string]: I18NIconsLegendInfo\n}\n\nfunction Help() {\n  const { t } = useTranslation()\n  const appTitleHead = AppStore.getState().appTitleHead\n\n  function renderIconsLegend() {\n    const icons = t('icons', { ns: 'common', returnObjects: true }) as I18NIconsLegendInfoList\n    const iconKeys = Object.getOwnPropertyNames(icons)\n      .filter((iconKey) => Object.getOwnPropertyNames(iconMap).includes(iconKey))\n      .toSorted((a, b) => {\n        const idA = icons[a]\n        const idB = icons[b]\n        // no context at front\n        if (!idA.context || idA.context.length === 0) return -1\n        if (!idB.context || idB.context.length === 0) return +1\n        // developer at end\n        if (idA.context.includes('developer')) return +1\n        if (idB.context.includes('developer')) return -1\n        // statistics at end (before)\n        if (idA.context.includes('statistics')) return +1\n        if (idB.context.includes('statistics')) return -1\n        // querybuilder before\n        if (idA.context.includes('querybuilder')) return +1\n        if (idB.context.includes('querybuilder')) return -1\n        // authentication before\n        if (idA.context.includes('authentication')) return +1\n        if (idB.context.includes('authentication')) return -1\n        // otherwise alphabetical\n        return idA.context[0].localeCompare(idB.context[0])\n      })\n\n    return (\n      // <Container fluid>\n      <Row xs={1} md={2} xl={3}>\n        {iconKeys.map((iconKey) => {\n          const context = t(`icons.${iconKey}.context`, {\n            ns: 'common',\n            returnObjects: true,\n            defaultValue: [],\n          }) as string[] | string\n          return (\n            <Col key={iconKey}>\n              <Card className=\"border-0\">\n                <Card.Body>\n                  <Card.Title>\n                    <i\n                      dangerouslySetInnerHTML={{ __html: iconMap[iconKey] }}\n                      aria-hidden=\"true\"\n                      className=\"rounded border px-2 pb-1\"\n                    />{' '}\n                    {t(`icons.${iconKey}.label`, { ns: 'common' })}\n                  </Card.Title>\n                  <Card.Text className=\"mb-0\">\n                    {t(`icons.${iconKey}.description`, { ns: 'common' })}\n                  </Card.Text>\n                  {context.length > 0 && (\n                    <Card.Text className=\"mt-1\">\n                      {(context as string[]).map((c) => (\n                        <Badge key={c}>{c}</Badge>\n                      ))}\n                    </Card.Text>\n                  )}\n                </Card.Body>\n              </Card>\n            </Col>\n          )\n        })}\n      </Row>\n      // </Container>\n    )\n  }\n\n  return (\n    <>\n      <Helmet>\n        <title>{appTitleHead}  Help</title>\n      </Helmet>\n      <Container className=\"my-4\">\n        <h1 className=\"h1\">{t('help.title')}</h1>\n        <h2 className=\"h2\" id=\"performing-a-fcs-search-in-resources\">\n          {t('help.performSearch.title')}\n        </h2>\n        <p>\n          <Trans i18nKey=\"help.performSearch.textBasicSearch\" />\n        </p>\n        <p>\n          <Trans\n            i18nKey=\"help.performSearch.textAdvancedSearch\"\n            components={{\n              iconMagicWand: (\n                <i dangerouslySetInnerHTML={{ __html: magicIcon }} aria-hidden=\"true\" />\n              ),\n            }}\n          />\n        </p>\n        <p>\n          <Trans\n            i18nKey=\"help.performSearch.textLexicalSearch\"\n            components={{\n              iconMagicWand: (\n                <i dangerouslySetInnerHTML={{ __html: magicIcon }} aria-hidden=\"true\" />\n              ),\n            }}\n          />\n        </p>\n        <p>\n          <Trans i18nKey=\"help.performSearch.textSearchProgress\" />\n        </p>\n        <p>\n          <Trans\n            i18nKey=\"help.performSearch.textViewResource\"\n            components={{\n              iconEye: <i dangerouslySetInnerHTML={{ __html: eyeFillIcon }} aria-hidden=\"true\" />,\n            }}\n          />\n        </p>\n        <h2 className=\"h2\" id=\"adjusting-search-criteria\">\n          {t('help.adjustSearchCriteria.title')}\n        </h2>\n        <p>\n          <Trans i18nKey=\"help.adjustSearchCriteria.text\" />\n        </p>\n        <p>\n          <Trans i18nKey=\"help.adjustSearchCriteria.textOtherSearchTypes\" />\n        </p>\n        <h2 className=\"h2\" id=\"more-help\">\n          {t('help.moreHelp.title')}\n        </h2>\n        <p>\n          <Trans\n            i18nKey=\"help.moreHelp.text\"\n            components={[\n              <a href=\"https://www.clarin.eu/content/content-search-tutorial\">\n                Content Search: Tutorial at CLARIN.eu\n              </a>,\n              <a title={t('help.contactTitle')} href={t('urls.contact', { ns: 'common' })}>\n                CLARIN FCS Helpdesk\n              </a>,\n            ]}\n          />\n        </p>\n        <h2 className=\"h2\" id=\"more-help\">\n          {t('help.icons.title')}\n        </h2>\n        {renderIconsLegend()}\n      </Container>\n    </>\n  )\n}\n\nexport default Help\n","import type { ReactNode } from 'react'\nimport { createContext, useContext } from 'react'\n\nimport type { Resource } from '@/utils/api'\nimport type { LanguageCode2NameMap } from '@/utils/search'\n\n// --------------------------------------------------------------------------\n\ninterface AggregatorData {\n  resources: Resource[]\n  languages: LanguageCode2NameMap\n  weblichtLanguages: string[]\n}\n\ntype AggregatorDataProviderProps = AggregatorData & {\n  children: ReactNode\n}\n\n// --------------------------------------------------------------------------\n\nconst AggregatorDataContext = createContext<AggregatorData>({\n  resources: [],\n  languages: {},\n  weblichtLanguages: [],\n})\nAggregatorDataContext.displayName = 'AggregatorDataContext'\n\n// --------------------------------------------------------------------------\n\nfunction AggregatorDataProvider({\n  resources,\n  languages,\n  weblichtLanguages,\n  children,\n}: AggregatorDataProviderProps) {\n  const data = { resources, languages, weblichtLanguages }\n  return <AggregatorDataContext.Provider value={data}>{children}</AggregatorDataContext.Provider>\n}\n\n// --------------------------------------------------------------------------\n\nfunction useAggregatorData() {\n  return useContext(AggregatorDataContext)\n}\n\n// --------------------------------------------------------------------------\n\n// eslint-disable-next-line react-refresh/only-export-components\nexport { AggregatorDataContext, AggregatorDataProvider, useAggregatorData }\n","import type { AxiosInstance } from 'axios'\nimport type { ReactNode } from 'react'\nimport { createContext, useContext } from 'react'\n\n// --------------------------------------------------------------------------\n\nconst AxiosContext = createContext<AxiosInstance | undefined>(undefined)\nAxiosContext.displayName = 'AxiosContext'\n\n// --------------------------------------------------------------------------\n\nfunction useAxios() {\n  const axios = useContext(AxiosContext)\n\n  if (!axios) throw new Error('No \"axios\" instance set, use AxiosProvider to set one')\n\n  return axios\n}\n\n// --------------------------------------------------------------------------\n\ninterface AxiosProviderProps {\n  axios: AxiosInstance\n  children?: ReactNode\n}\n\nfunction AxiosProvider({ axios, children }: AxiosProviderProps) {\n  return <AxiosContext.Provider value={axios}>{children}</AxiosContext.Provider>\n}\n\n// --------------------------------------------------------------------------\n\n// eslint-disable-next-line react-refresh/only-export-components\nexport { AxiosContext, AxiosProvider, useAxios }\n","import type { ReactNode } from 'react'\nimport { createContext, useContext } from 'react'\n\nimport type { NumberOfResults, QueryTypeID } from '@/utils/constants'\nimport type { LanguageFilterOptions } from '@/utils/search'\n\n// --------------------------------------------------------------------------\n\ninterface SearchParams {\n  language: string\n  languageFilter: LanguageFilterOptions\n  queryType: QueryTypeID\n  query: string\n  resourceIDs: string[]\n  numberOfResults: NumberOfResults\n}\n\n// --------------------------------------------------------------------------\n\nconst SearchParamsContext = createContext<SearchParams | undefined>(undefined)\nSearchParamsContext.displayName = 'SearchParamsContext'\n\n// --------------------------------------------------------------------------\n\nfunction useSearchParams() {\n  const params = useContext(SearchParamsContext)\n\n  if (!params) throw new Error('No \"params\" data set, use SearchParamsProvider to set one')\n\n  return params\n}\n\n// --------------------------------------------------------------------------\n\ntype SearchParamsProviderProps = SearchParams & {\n  children?: ReactNode\n}\n\nfunction SearchParamsProvider({\n  language,\n  languageFilter,\n  queryType,\n  query,\n  resourceIDs,\n  numberOfResults,\n  children,\n}: SearchParamsProviderProps) {\n  const params = { language, languageFilter, queryType, query, resourceIDs, numberOfResults }\n\n  return <SearchParamsContext.Provider value={params}>{children}</SearchParamsContext.Provider>\n}\n\n// --------------------------------------------------------------------------\n\n// eslint-disable-next-line react-refresh/only-export-components\nexport { SearchParamsContext, SearchParamsProvider, useSearchParams }\n","import type { LanguageCode2NameMap } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nexport type { LanguageCode2NameMap }\n\n// --------------------------------------------------------------------------\n\nexport type LanguageFilterOptions = 'byMeta' | 'byGuess' | 'byMetaAndGuess'\nexport type ResourceSelectionModalViewOptionVisibility = 'all' | 'selected'\nexport type ResourceSelectionModalViewOptionGrouping = 'resource' | 'institution' | 'language'\nexport type ResourceSelectionModalViewOptionSorting =\n  | 'title-up'\n  | 'title-down'\n  | 'institution-up'\n  | 'institution-down'\n\n// --------------------------------------------------------------------------\n\nexport const DEFAULT_SEARCH_LANGUAGE_FILTER: LanguageFilterOptions = 'byMeta'\nexport const DEFAULT_RESOURCE_VIEW_VISIBILITY: ResourceSelectionModalViewOptionVisibility = 'all'\nexport const DEFAULT_RESOURCE_VIEW_GROUPING: ResourceSelectionModalViewOptionGrouping = 'resource'\nexport const DEFAULT_RESOURCE_VIEW_SORTING: ResourceSelectionModalViewOptionSorting = 'title-up'\n\nexport const MULTIPLE_LANGUAGE_CODE = 'mul' // see ISO-693-3\n\n// --------------------------------------------------------------------------\n\nexport function languageCodeToName(\n  code: string,\n  codeToLanguageMapping: LanguageCode2NameMap = undefined as unknown as LanguageCode2NameMap,\n  options: { defaultAnyLanguage?: string; defaultUnknownLanguage?: string } = {}\n) {\n  if (code === MULTIPLE_LANGUAGE_CODE) return options?.defaultAnyLanguage ?? 'Any Language'\n  return codeToLanguageMapping?.[code] || (options?.defaultUnknownLanguage ?? 'Unknown Language')\n}\n","import type { Resource as ResourceRaw } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport LocaleStore from '@/stores/locale'\nimport type { Resource } from '@/utils/api'\nimport { QueryTypeID } from '@/utils/constants'\nimport type { ResourceSelectionModalViewOptionSorting } from '@/utils/search'\nimport { MULTIPLE_LANGUAGE_CODE } from '@/utils/search'\n\n// --------------------------------------------------------------------------\n\nexport function fromApi(resources: ResourceRaw[]) {\n  const locale = LocaleStore.getState().locale\n\n  const prepareFn = (resource: ResourceRaw, rootResource: ResourceRaw | null = null): Resource => {\n    return {\n      // copy original\n      ...resource,\n      // override and apply to sub-resources\n      subResources: resource.subResources.map((subResource) =>\n        prepareFn(subResource, rootResource ?? resource)\n      ),\n      // apply a rootResourceId (pointing to the root element of any nested child)\n      rootResourceId: rootResource?.id ?? null,\n    } satisfies Resource\n  }\n  const convertedResources = resources.map((resource) => prepareFn(resource, null))\n\n  const sortFn = function (x: Resource, y: Resource) {\n    const xInstitution = getBestFromMultilingualValuesTryByLanguage(x.institution, locale) ?? ''\n    const yInstitution = getBestFromMultilingualValuesTryByLanguage(y.institution, locale) ?? ''\n    const r = xInstitution.localeCompare(yInstitution)\n    if (r !== 0) {\n      return r\n    }\n\n    const xTitle = getBestFromMultilingualValuesTryByLanguage(x.title, locale) ?? ''\n    const yTitle = getBestFromMultilingualValuesTryByLanguage(y.title, locale) ?? ''\n    return xTitle.toLowerCase().localeCompare(yTitle.toLowerCase())\n  }\n  recurseResources(convertedResources, (resource: Resource) => {\n    resource.subResources.sort(sortFn)\n  })\n  convertedResources.sort(sortFn)\n\n  return convertedResources\n}\n\nexport function evaluateAggregationContext(\n  resources: Resource[],\n  endpoints2handles: { [key: string]: string[] }\n) {\n  const selectedResourceIDs: string[] = []\n  const handlesNotFound: string[] = []\n  const resourcesToSelect: Resource[] = []\n\n  Object.entries(endpoints2handles).forEach(([endpoint, handles]) => {\n    console.debug('evaluateAggregationContext:', { endpoint, handles })\n    handles.forEach((handle: string) => {\n      let found = false\n      recurseResources(resources, (resource: Resource) => {\n        if (resource.handle === handle) {\n          found = true\n          resourcesToSelect.push(resource)\n        }\n      })\n      if (!found) {\n        console.warn('Handle not found in resources', handle)\n        handlesNotFound.push(handle)\n      }\n    })\n  })\n\n  recurseResources(resourcesToSelect, (resource: Resource) => {\n    selectedResourceIDs.push(resource.id)\n  })\n\n  return { selected: selectedResourceIDs, unavailable: handlesNotFound }\n}\n\n// --------------------------------------------------------------------------\n\nexport function recurseResources(\n  resources: Resource[],\n  fn:\n    | ((resource: Resource, index: number) => boolean | void)\n    | ((resource: Resource) => boolean | void)\n) {\n  const recfn = (resource: Resource, index: number) => {\n    if (false === fn(resource, index)) {\n      // no recursion\n    } else {\n      resource.subResources.forEach(recfn)\n    }\n  }\n  resources.forEach(recfn)\n}\n\nexport function recurseResource(resource: Resource, fn: (resource: Resource) => boolean | void) {\n  if (false === fn(resource)) {\n    // no recursion\n  } else {\n    recurseResources(resource.subResources, fn)\n  }\n}\n\nexport function findResourceByFilter(\n  resources: Resource[],\n  filter: (resource: Resource) => boolean\n): Resource | undefined {\n  let found: Resource | undefined = undefined\n\n  // NOTE: we use find to abort search if we have found anything\n  const findRecFn = (resource: Resource) => {\n    if (found !== undefined) return true\n\n    if (filter(resource)) {\n      found = resource\n      return true\n    }\n\n    return resource.subResources.find(findRecFn) !== undefined\n  }\n  resources.find(findRecFn)\n\n  return found\n}\n\nexport function getResourceIDs(resources: Resource[]) {\n  const resourceIDs: string[] = []\n  recurseResources(resources, (resource: Resource) => {\n    resourceIDs.push(resource.id)\n  })\n  return resourceIDs\n}\n\nexport function getResourceIDsBySplit<T extends string | number | symbol | boolean>(\n  resources: Resource[],\n  filter: (resource: Resource) => T\n): Map<T, string[]> {\n  const resourceIDsMap: Map<T, string[]> = new Map()\n  recurseResources(resources, (resource: Resource) => {\n    const category: T = filter(resource)\n    if (!resourceIDsMap.has(category)) resourceIDsMap.set(category, [])\n    resourceIDsMap.get(category)!.push(resource.id)\n  })\n  return resourceIDsMap\n}\n\nexport function getAvailableResourceIDs(\n  resources: Resource[],\n  queryTypeId: QueryTypeID,\n  languageCode: string\n) {\n  const resourceIDs: string[] = []\n  const checkFn = (resource: Resource) =>\n    isResourceAvailableDueToSubResource(resource, checkFn) ||\n    isResourceAvailable(resource, queryTypeId, languageCode)\n\n  recurseResources(resources, (resource: Resource) => {\n    if (checkFn(resource)) {\n      resourceIDs.push(resource.id)\n    }\n  })\n  return resourceIDs\n}\n\nexport function getInstitutions(resources: Resource[], resourceIDs: string[]) {\n  const locale = LocaleStore.getState().locale\n  const institutions = new Set<string>()\n\n  recurseResources(resources, (resource: Resource) => {\n    if (resourceIDs.includes(resource.id)) {\n      const institution =\n        getBestFromMultilingualValuesTryByLanguage(resource.institution, locale) ?? ''\n      institutions.add(institution)\n      // return false // top-most resource in tree, don't delve deeper\n    }\n    return true\n  })\n\n  // console.debug('institutions: ', institutions.size, { institutions: institutions })\n  return Array.from(institutions)\n}\n\nexport function getResourceParentIDs(\n  resources: Resource[],\n  filter: (resource: Resource) => boolean\n) {\n  const parentIDs: string[] = []\n\n  const recursivelyFind = (resource: Resource): boolean => {\n    // check recursively for all children\n    const anyChild = resource.subResources.map(recursivelyFind)\n    // if for any it is true\n    if (anyChild.some(Boolean)) {\n      // then add current resource ID as parent for some nested children\n      parentIDs.push(resource.id)\n      // and return true to get parents of current resource, too\n      return true\n    }\n    // if self is true, then parent should add its ID\n    return filter(resource) === true\n  }\n  resources.forEach(recursivelyFind)\n\n  return parentIDs\n}\n\nexport function flattenResources(resources: Resource[]) {\n  const flattenFn = (resource: Resource): Resource[] => [\n    resource,\n    ...resource.subResources.map(flattenFn).flat(),\n  ]\n  return resources.map(flattenFn).flat()\n}\n\n// --------------------------------------------------------------------------\n\nexport const MULTILINGUAL_VALUE_CHECK_LANGUAGES = ['en', 'eng', 'de', 'deu'] as const\n\nexport function getBestFromMultilingualValues(\n  values: null | string | { [language: string]: string }\n) {\n  // checks: if null, return\n  if (values === null) {\n    return null\n  }\n  // if not a mapping, then we only have one choice\n  if (typeof values === 'string') {\n    return values\n  }\n\n  // check from list of languages\n  for (const language of MULTILINGUAL_VALUE_CHECK_LANGUAGES) {\n    if (Object.hasOwn(values, language)) {\n      return values[language]\n    }\n  }\n\n  // otherwise try to use first\n  const ownLanguages = Object.getOwnPropertyNames(values)\n  if (ownLanguages.length > 0) {\n    return values[ownLanguages[0]]\n  }\n\n  // if not, it is empty? then null\n  return null\n}\n\nexport function getFromMultilingualValuesByLanguage(\n  values: null | string | { [language: string]: string },\n  language?: string\n) {\n  // checks: if null, return\n  if (values === null) {\n    return null\n  }\n  // if not a mapping, then we only have one choice\n  if (typeof values === 'string') {\n    return values\n  }\n\n  // otherwise, try to find value for language\n  if (language && Object.hasOwn(values, language)) {\n    return values[language]\n  }\n\n  // if not, return null\n  return null\n}\n\nexport function getBestFromMultilingualValuesTryByLanguage(\n  values: null | string | { [language: string]: string },\n  language?: string\n) {\n  // try to guess browser/user language (if not provided)\n  if (language === undefined) {\n    language = LocaleStore.getState().locale\n  }\n\n  const valueByLanguage = getFromMultilingualValuesByLanguage(values, language)\n  if (valueByLanguage !== null) return valueByLanguage\n\n  // if not found by language, then try to guess something\n  return getBestFromMultilingualValues(values)\n}\n\n/** Compute the language that would be used to retrieve a multi-lingual resource information value. */\nexport function getBestLanguageFromMultilingualValuesTryByLanguage(\n  values: null | string | { [language: string]: string },\n  language?: string\n) {\n  // if null, then we have nothing\n  if (values === null) return undefined\n  // if not a mapping, then we only have one choice\n  if (typeof values === 'string') return undefined\n\n  // try to guess browser/user language (if not provided)\n  if (language === undefined) {\n    language = LocaleStore.getState().locale\n  }\n\n  // getFromMultilingualValuesByLanguage(values, language)\n  // try to find value for language\n  if (language && Object.hasOwn(values, language)) return language\n\n  // getBestFromMultilingualValues(values)\n  // check from list of languages\n  for (const language of MULTILINGUAL_VALUE_CHECK_LANGUAGES) {\n    if (Object.hasOwn(values, language)) return language\n  }\n  // otherwise try to use first\n  const ownLanguages = Object.getOwnPropertyNames(values)\n  if (ownLanguages.length > 0) return ownLanguages[0]\n  // if not, it is empty? then null (this should not be possible)\n  return undefined\n}\n\n/**\n * Get languages/locales used in resource meta information.\n * @param resource Resource with meta information (title, description, institution, ...)\n * @param defaultLanguage fallback language if not multilingual information set\n * @returns unique list of languages found for title/description/institution or fallback if no multilingual options\n */\nexport function getLanguagesFromResourceInfo(resource: ResourceRaw, defaultLanguage = 'en') {\n  const languagesForTitle =\n    typeof resource.title === 'string' || resource.title === null\n      ? [defaultLanguage]\n      : Object.getOwnPropertyNames(resource.title)\n  const languagesForDescription =\n    typeof resource.description === 'string' || resource.description === null\n      ? [defaultLanguage]\n      : Object.getOwnPropertyNames(resource.description)\n  const languagesForInstitution =\n    typeof resource.institution === 'string' || resource.institution === null\n      ? [defaultLanguage]\n      : Object.getOwnPropertyNames(resource.institution)\n\n  // TODO: only collect languages if values differ, else fallback to default?\n\n  const languageForResource = [\n    ...languagesForTitle,\n    ...languagesForDescription,\n    ...languagesForInstitution,\n  ]\n\n  // TODO: order by count?\n  const languageForResourceUniq = Array.from(new Set(languageForResource))\n\n  return languageForResourceUniq\n}\n\n// --------------------------------------------------------------------------\n\nexport function isResourceAvailableForQueryType(resource: Resource, queryTypeId: QueryTypeID) {\n  // check search capabilities (ignore version, just check caps)\n  if (queryTypeId === 'fcs' && !resource.endpoint.searchCapabilities.includes('ADVANCED_SEARCH')) {\n    // want 'fcs' but does not have 'ADVANCED_SEARCH' capability\n    return false\n  }\n  if (queryTypeId === 'lex' && !resource.endpoint.searchCapabilities.includes('LEX_SEARCH')) {\n    // want 'lex' but does not have 'LEX_SEARCH' capability\n    return false\n  }\n  // 'cql' is required default, so no check\n  return true\n}\n\nexport function isResourceAvailableForLanguage(resource: Resource, languageCode: string) {\n  // yes for any language\n  if (languageCode === MULTIPLE_LANGUAGE_CODE) {\n    return true\n  }\n\n  // yes if the resource is in only that language\n  if (\n    resource.languages &&\n    resource.languages.length === 1 &&\n    resource.languages[0] === languageCode\n  ) {\n    return true\n  }\n\n  // ? yes if the resource also contains that language\n  if (resource.languages && resource.languages.indexOf(languageCode) >= 0) {\n    return true\n  }\n\n  // ? yes if the resource has no language\n  // if (!resource.languages || resource.languages.length === 0) {\n  // \t return true\n  // }\n\n  return false\n}\n\nexport function isResourceAvailableDueToSubResource(\n  resource: Resource,\n  checkFn: (resource: Resource) => boolean\n) {\n  // if no subresources, then it's not a requirement\n  if (!resource.subResources || resource.subResources.length === 0) {\n    return false\n  }\n\n  // recursively check\n  let shouldBeAvailable = false // default false if no descendant says yes\n  const recursivelyCheck = (resource: Resource) => {\n    if (checkFn?.(resource) === true) {\n      shouldBeAvailable = true\n      return\n    }\n    resource.subResources.forEach(recursivelyCheck)\n  }\n  resource.subResources.forEach(recursivelyCheck)\n\n  return shouldBeAvailable\n}\n\nexport function isResourceAvailable(\n  resource: Resource,\n  queryTypeId: QueryTypeID,\n  languageCode: string\n): boolean {\n  if (!isResourceAvailableForQueryType(resource, queryTypeId)) return false\n  if (!isResourceAvailableForLanguage(resource, languageCode)) return false\n  return true\n}\n\n// --------------------------------------------------------------------------\n\nexport const SORT_FNS: {\n  [key in ResourceSelectionModalViewOptionSorting]: (a: Resource, b: Resource) => number\n} = {\n  'title-up': (a, b) => {\n    const locale = LocaleStore.getState().locale\n\n    const aTitle = getBestFromMultilingualValuesTryByLanguage(a.title, locale) ?? ''\n    const bTitle = getBestFromMultilingualValuesTryByLanguage(b.title, locale) ?? ''\n\n    return aTitle.localeCompare(bTitle)\n  },\n  'title-down': (a, b) => {\n    const locale = LocaleStore.getState().locale\n\n    const aTitle = getBestFromMultilingualValuesTryByLanguage(a.title, locale) ?? ''\n    const bTitle = getBestFromMultilingualValuesTryByLanguage(b.title, locale) ?? ''\n\n    return -aTitle.localeCompare(bTitle)\n  },\n  'institution-up': (a, b) => {\n    const locale = LocaleStore.getState().locale\n\n    const aInstitution = getBestFromMultilingualValuesTryByLanguage(a.institution, locale) ?? ''\n    const bInstitution = getBestFromMultilingualValuesTryByLanguage(b.institution, locale) ?? ''\n    const aTitle = getBestFromMultilingualValuesTryByLanguage(a.title, locale) ?? ''\n    const bTitle = getBestFromMultilingualValuesTryByLanguage(b.title, locale) ?? ''\n\n    const ret = aInstitution.localeCompare(bInstitution)\n    return ret !== 0 ? ret : aTitle.localeCompare(bTitle)\n  },\n  'institution-down': (a, b) => {\n    const locale = LocaleStore.getState().locale\n\n    const aInstitution = getBestFromMultilingualValuesTryByLanguage(a.institution, locale) ?? ''\n    const bInstitution = getBestFromMultilingualValuesTryByLanguage(b.institution, locale) ?? ''\n    const aTitle = getBestFromMultilingualValuesTryByLanguage(a.title, locale) ?? ''\n    const bTitle = getBestFromMultilingualValuesTryByLanguage(b.title, locale) ?? ''\n\n    const ret = -aInstitution.localeCompare(bInstitution)\n    return ret !== 0 ? ret : aTitle.localeCompare(bTitle)\n  },\n}\n\n// export function isResourceSelectable(resource: Resource) { return true }\n// export function isResourceAvailable(resource: Resource) { return true }\n// export function isResourceVisible(resource: Resource) { return true }\n// export function selectResource(resource: Resource, selected: boolean, propagate: boolean = true) {}\n// export function sortResources(resources: Resource[], criteria: string)\n","import { useEffect, useState } from 'react'\n\n// from: https://stackoverflow.com/a/77124113/9360161\n// also: https://www.dhiwise.com/post/ultimate-guide-to-implementing-react-debounce-effectively\n\n// value should be a state\nexport default function useDebounce<T>(value: T, delay?: number): T {\n  const [debounceValue, setDebounceValue] = useState(value)\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebounceValue(value)\n    }, delay)\n\n    return () => {\n      clearTimeout(handler)\n    }\n  }, [value, delay])\n  return debounceValue\n}\n","function getTextCursorOffset(\n  container: Node,\n  node: Node,\n  offset: number = 0,\n  selectionNode: Node = node\n) {\n  // TODO: or is this only for the container element?\n  if (\n    node === container &&\n    node === selectionNode &&\n    node.nodeType === Node.ELEMENT_NODE &&\n    offset === 1\n  ) {\n    console.debug('offset=1 on node', {\n      container,\n      node,\n      nodeType: node.nodeType,\n      offset,\n      length: node.textContent?.length,\n    })\n    return node.textContent?.length || 0\n  }\n\n  // no nested children\n  if (node === container || container === null) return offset\n\n  // go through parent and children until have our offset in the container\n  const parent = node.parentNode\n  // if parent is null then we can't do anything, offset should be correct?\n  if (parent === null) return offset\n  // otherwise find previous children\n  let lengthBefore = 0\n  const children = parent.childNodes\n  for (let i = 0; i < children.length; i++) {\n    const child = children[i]\n    if (child === node) break\n\n    // store text length before\n    if (child.nodeType === Node.TEXT_NODE) {\n      lengthBefore += child.textContent?.length || 0\n    } else if (child.nodeType === Node.ELEMENT_NODE) {\n      // NOTE: innerText for visible text required?\n      // see: https://stackoverflow.com/a/35213639/9360161\n      lengthBefore += child.textContent?.length || 0\n    } else {\n      console.warn('unknown node type', { container, node, offset, parent, i, child })\n    }\n  }\n\n  // recurse up, until we have found our container\n  // console.debug('[getTextCursorOffset]#recurse', { container, selectionNode, node, parent, lengthBefore, offset })\n  return getTextCursorOffset(container, parent, lengthBefore + offset, selectionNode)\n}\n\nfunction getRangeContainerWithOffsetFromTextOffset(container: Node, offset: number) {\n  // TODO: may be enough if at start ...?\n  // if (offset === 0) {\n  //   return { node: container, offset: offset }\n  // }\n\n  // check if possible (e.g., container has enough text to contain the offset)\n  const containerLength = container.textContent?.length || 0\n  if (containerLength < offset) return null\n\n  // go through children and find where offset could be\n  let lengthBefore = 0\n  const children = container.childNodes\n  for (let i = 0; i < children.length; i++) {\n    const child = children[i]\n\n    let childLength = 0\n    if (child.nodeType === Node.TEXT_NODE) {\n      childLength = child.textContent?.length || 0\n    } else if (child.nodeType === Node.ELEMENT_NODE) {\n      // NOTE: innerText for visible text required?\n      // see: https://stackoverflow.com/a/35213639/9360161\n      childLength = child.textContent?.length || 0\n    } else {\n      console.warn('unknown node type, skip', { container, offset, child })\n    }\n    // skip if empty child, but do not skip if only child\n    if (childLength === 0 && children.length !== 1) continue\n\n    // check if with this child content, the offset is included\n    lengthBefore += childLength\n    if (lengthBefore >= offset) {\n      // found, now only need to check if we need to go deeper\n      const newOffset = offset - (lengthBefore - childLength)\n      if (child.nodeType === Node.ELEMENT_NODE) {\n        // we need to check deeper\n        return getRangeContainerWithOffsetFromTextOffset(child, newOffset)\n      } else {\n        // otherwise this is it\n        return { node: child, offset: newOffset }\n      }\n    }\n  }\n  console.debug('we should have found the offset ...', {\n    container,\n    containerLength,\n    children,\n    childrenCount: children.length,\n    offset,\n  })\n  return null\n}\n\n// --------------------------------------------------------------------------\n\nexport function getAbsoluteTextCursorOffsets(container: Node, range: Range) {\n  if (!range) return null\n\n  const start = getTextCursorOffset(container, range.startContainer, range.startOffset)\n\n  // optimization if same node\n  if (\n    range.startContainer.nodeType === Node.TEXT_NODE &&\n    range.endContainer === range.startContainer\n  ) {\n    return [start, start + (range.endOffset - range.startOffset)] as const\n  }\n\n  const end = getTextCursorOffset(container, range.endContainer, range.endOffset)\n\n  // console.debug('[getAbsoluteTextCursorOffsets]', {\n  //   container,\n  //   range,\n  //   startContainer: range.startContainer,\n  //   startOffset: range.startOffset,\n  //   endContainer: range.endContainer,\n  //   endOffset: range.endOffset,\n  //   start,\n  //   end,\n  // })\n\n  return [start, end] as const\n}\n\nexport function setCursorPosition(container: Node, offset: number) {\n  // console.debug('[setCursorPosition]', offset)\n  const isTargetFocused = document.activeElement === container\n  if (!isTargetFocused) return null\n\n  const selection = window.getSelection()\n  if (!selection) return null\n\n  const range = document.createRange()\n  const startRange = getRangeContainerWithOffsetFromTextOffset(container, offset)\n  if (startRange) {\n    try {\n      range.setStart(startRange.node, startRange.offset)\n      range.collapse(true)\n      selection.removeAllRanges()\n      selection.addRange(range)\n    } catch (error) {\n      console.error('Error trying to set cursor!', error, { container, offset, startRange })\n    }\n  }\n}\n\nexport function getCursorPosition(container: Node) {\n  const isTargetFocused = document.activeElement === container\n  if (!isTargetFocused) return null\n\n  const selection = window.getSelection()\n  if (!selection) return null\n  if (selection.rangeCount === 0) return null\n\n  // only look at first range if multiple\n  const range = selection.getRangeAt(0)\n  const idxRange = getAbsoluteTextCursorOffsets(container, range)\n  if (!idxRange) return null\n  // only look at start of range\n  return idxRange[0]\n}\n","import Prism from '@vendor/prismjs'\n\nexport function queryTypeToPrismLanguage(queryType?: string) {\n  if (queryType === 'cql') return 'fcs-cql'\n  if (queryType === 'fcs') return 'fcs-fcsql'\n  if (queryType === 'lex') return 'fcs-lexcql'\n  return 'plain'\n}\n\nexport function highlightSyntax(value: string, queryType?: string) {\n  // console.debug('do syntax highlighting ...', { value, queryType })\n\n  // value = JSON.stringify(Object.keys(Prism.languages))\n  const language = queryTypeToPrismLanguage(queryType)\n  const pluginClasses = 'match-braces rainbow-braces'\n\n  let prismValue = value\n  try {\n    prismValue = Prism.highlight(value, language)\n  } catch (error) {\n    console.warn('Error trying to highlight value', { value, error, language })\n  }\n  const html = `<pre><code class=\"language-${language} ${pluginClasses}\">${prismValue}</code></pre>`\n\n  return html\n}\n","import React, { useEffect, useImperativeHandle, useLayoutEffect, useRef, useState } from 'react'\n\nimport useDebounce from '@/hooks/useDebounce'\nimport type { QueryTypeID } from '@/utils/constants'\nimport { getAbsoluteTextCursorOffsets, getCursorPosition, setCursorPosition } from '@/utils/cursor'\nimport { highlightSyntax } from '@/utils/prism'\n\nimport '@vendor/prismjs/themes/prism-vs.css'\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\ndeclare const window: Window &\n  typeof globalThis & {\n    clipboardData: DataTransfer\n  }\n\n// see helpers.d.ts from react-bootstrap\ntype Omit<T, U> = Pick<T, Exclude<keyof T, keyof U>>\n\ninterface NonUsableProps {\n  contentEditable: never\n  dangerouslySetInnerHTML: never\n  onInput: never\n  onPaste: never\n  onKeyDown: never\n  onKeyUp: never\n  onClick: never\n}\n\nexport interface ContentEditableProps {\n  value?: string\n  disabled?: boolean\n  isInvalid?: boolean\n  placeholder?: string\n  queryType?: QueryTypeID\n  delay?: number\n  onChange?: (value: string) => void\n  onValidationChange?: (isValid: boolean) => void\n  onCursorChange?: (startPos: number | null, endPos?: number) => void\n}\n\nexport type Props = Omit<React.ComponentProps<'div'>, NonUsableProps> & ContentEditableProps\n\n// --------------------------------------------------------------------------\n\nfunction sanitizeValue(value?: string | null) {\n  if (!value) return ''\n\n  // illegal whitespace\n  value = value.replace(/[\\n\\t]/g, ' ')\n  value = value.replace(/&nbsp;|\\u202F|\\u00A0/g, ' ')\n\n  // NOTE: not required for for pre/code\n  // HTML escape, entities\n  // value = value.replace(/&/g, '&amp;')\n  // HTML\n  // value = value.replace(/</g, '&lt;')\n  // value = value.replace(/>/g, '&gt;')\n  return value\n}\n\n// --------------------------------------------------------------------------\n// component\n\nconst ContentEditable = React.forwardRef<HTMLDivElement, Props>(\n  (\n    { value, onChange, onCursorChange, disabled, placeholder, queryType, delay = 200, ...props },\n    ref\n  ) => {\n    // ref to hidden input element (for form stuffs)\n    const inputRef = useRef<HTMLInputElement>(null)\n    // ref to our contentEditable input\n    const mRef = useRef<HTMLDivElement>(null)\n    // allow forwardRefs but use our local one since we need access\n    // see: https://stackoverflow.com/a/76739143/9360161\n    useImperativeHandle(ref, () => mRef.current as HTMLDivElement)\n\n    const [sanitizedValue, setSanitizedValue] = useState(sanitizeValue(value))\n    const [cursorPos, setCursorPos] = useState<number | null>(null)\n\n    // debounce to avoid unnecessary repeated calls to highlighter if value stays the same\n    const deboundedSanitizedValue = useDebounce(sanitizedValue, delay)\n    const [htmlValue, setHtmlValue] = useState(deboundedSanitizedValue)\n    useEffect(() => {\n      const valueWithStyle = highlightSyntax(deboundedSanitizedValue, queryType)\n      setHtmlValue(valueWithStyle)\n\n      if (mRef.current) {\n        const pos = getCursorPosition(mRef.current)\n        setCursorPos(pos)\n      }\n    }, [deboundedSanitizedValue, queryType])\n\n    // set visible value\n    useEffect(() => {\n      // if (disabled) return\n\n      const newValue = sanitizeValue(value)\n\n      // detection if already styled and we do not need to restyle again\n      if (deboundedSanitizedValue === newValue) return\n\n      setSanitizedValue(newValue)\n      // we still need to set the value (without styling) to show the current value to the user\n      setHtmlValue(highlightSyntax(newValue))\n\n      if (mRef.current) {\n        const pos = getCursorPosition(mRef.current)\n        setCursorPos(pos)\n      }\n    }, [value, deboundedSanitizedValue])\n\n    // set cursor position\n    useLayoutEffect(() => {\n      if (mRef.current && cursorPos !== null) {\n        // only if we have a valid cursor, otherwise let default behaviour do the work\n        // console.debug('[useLayoutEffect#setCursorPosition]', cursorPos)\n        setCursorPosition(mRef.current, cursorPos)\n      }\n    })\n\n    // ------------------------------------------------------------------------\n    // event handlers\n\n    function handleInput(event: React.ChangeEvent<HTMLDivElement>) {\n      const value = event.target.innerText\n      // console.debug('[handleInput]', value)\n\n      if (inputRef.current) {\n        inputRef.current.value = value\n      }\n\n      // TODO: might be required?\n      setSanitizedValue(value)\n\n      onChange?.(value)\n    }\n\n    function handlePaste(event: React.ClipboardEvent<HTMLDivElement>) {\n      // console.debug('[handlePaste]', event)\n\n      event.stopPropagation()\n      event.preventDefault()\n\n      // see: https://stackoverflow.com/a/6804718/9360161\n      // Get pasted data via clipboard API\n      const clipboardData = event.clipboardData || window.clipboardData\n      const pastedData = clipboardData.getData('text')\n\n      handleInsert(pastedData)\n    }\n\n    function handleKeyDown(event: React.KeyboardEvent<HTMLDivElement>) {\n      // console.debug('[handleKeyDown]', event.key, event)\n\n      // TODO: handle Ctrl-Z?\n      // NOTE: Ctrl-X / cut is handled\n      // NOTE: (Shift-)Tab is handled\n\n      // TODO: handle Ctrl-A Delete/Backspace\n      // TODO: handle Home/End <any-input>\n\n      if (event.key === 'Enter') {\n        // console.debug('[handleKeyDown:Enter]')\n\n        event.stopPropagation()\n        event.preventDefault()\n\n        if (inputRef.current) {\n          // dispatching ENTER keydown events will not work because of trust issues\n\n          // request submit directly via enclosing form\n          // NOTE: will ignore disabled status of submit button...\n          inputRef.current.form?.requestSubmit()\n        }\n      } else if (event.key === 'Backspace') {\n        // console.debug('[handleKeyDown#Backspace]')\n\n        event.stopPropagation()\n        event.preventDefault()\n\n        // custom backspace deletion handling since backspace on formatted text\n        // will jump the cursor to the left more than expected???\n        handleBackspace()\n      } else if (event.key === 'Delete') {\n        // console.debug('[handleKeyDown#Delete]')\n\n        event.stopPropagation()\n        event.preventDefault()\n\n        handleDelete()\n      } else if (event.ctrlKey && event.key === 'a') {\n        // TODO: required?\n        // if (mRef.current) {\n        //   const selection = window.getSelection()\n        //   if (selection) {\n        //     const range = document.createRange()\n        //     range.selectNodeContents(mRef.current)\n        //     selection.removeAllRanges()\n        //     selection.addRange(range)\n        //     event.stopPropagation()\n        //     event.preventDefault()\n        //   }\n        // }\n      } else {\n        // default, do not attempt to set cursor\n        setCursorPos(null)\n      }\n    }\n\n    function handlePossibleCursorChange(isClick: boolean = false) {\n      // if no element or no event handler, then skip everything\n      if (!mRef.current) return\n      if (!onCursorChange) return\n\n      const container = mRef.current\n      const isTargetFocused = document.activeElement === container\n      if (!isTargetFocused) return\n\n      const selection = window.getSelection()\n      if (!selection) return\n      if (selection.rangeCount === 0) return\n\n      const selectionIndices: Array<readonly [number, number]> = []\n      for (let i = 0; i < selection.rangeCount; i++) {\n        const range = selection.getRangeAt(i)\n        const idxRange = getAbsoluteTextCursorOffsets(container, range)\n        if (idxRange) selectionIndices.push(idxRange)\n      }\n      if (selectionIndices.length === 0) return\n\n      // use last selection as most current one\n      const [start, end] = selectionIndices.pop()!\n\n      // only trigger if selection is a single cursor, not for ranges\n      if (isClick) {\n        if (start === end) {\n          setCursorPos(start)\n          onCursorChange?.(start)\n          // } else {\n          // NOTE: this does not work, maybe due to re-rendering\n          // onCursorChange?.(start, end)\n        }\n      } else {\n        onCursorChange?.(start, start !== end ? end : undefined)\n      }\n    }\n\n    // ------------------------------------------------------------------------\n\n    function doRemove(mode: 'delete' | 'backspace' | 'paste') {\n      if (!mRef.current) return null\n\n      const container = mRef.current\n      const isTargetFocused = document.activeElement === container\n      if (!isTargetFocused) return null\n\n      const selection = window.getSelection()\n      if (!selection) return null\n      if (selection.rangeCount === 0) return null\n\n      const selectionIndices: Array<readonly [number, number]> = []\n      for (let i = 0; i < selection.rangeCount; i++) {\n        const range = selection.getRangeAt(i)\n        const idxRange = getAbsoluteTextCursorOffsets(container, range)\n        if (idxRange) selectionIndices.push(idxRange)\n      }\n\n      // nothing to do\n      if (selectionIndices.length === 0) return null\n\n      // sort, so we can delete correctly (from the back to keep indices valid)\n      selectionIndices.sort()\n\n      // how many chars will deleted\n      const numDeleted = selectionIndices\n        .map(([start, end]) => end - start)\n        .reduce((acc, cur) => acc + cur, 0)\n\n      const oldValue = container.innerText // TODO: use container.textContent?\n      const newValueSpansRemoved = selectionIndices\n        .toReversed()\n        .reduce((text, [start, end]) => text.slice(0, start) + text.slice(end), oldValue)\n\n      // console.debug('deleting', { mode, oldValue, length: oldValue.length, newValueSpansRemoved, numDeleted, selectionIndices })\n\n      if (mode === 'backspace') {\n        if (numDeleted === 0) {\n          // then perform normal backspace operation\n          const lastPos = selectionIndices\n            .filter(([start, end]) => start === end)\n            .map(([, end]) => end)\n            .pop()\n\n          // did delete nothing and am at start\n          if (lastPos === 0) return null\n\n          if (lastPos !== undefined) {\n            // should only be a single cursor! (multiple cursors are not supported by default in browsers?)\n            const newValue =\n              newValueSpansRemoved.slice(0, lastPos - 1) + newValueSpansRemoved.slice(lastPos)\n\n            return { value: newValue, offset: lastPos - 1 }\n          }\n        } else {\n          // from end of last selection minus deleted chars will be new pos\n          // collapse multiple ranges into one for simplicity\n          const lastPos = selectionIndices.map(([, end]) => end).pop()\n\n          if (lastPos !== undefined) {\n            return { value: newValueSpansRemoved, offset: lastPos - numDeleted }\n          }\n        }\n\n        console.warn('invalid \"backspace\" process, abort', {\n          container,\n          selectionIndices,\n          oldValue,\n          newValueSpansRemoved,\n          numDeleted,\n        })\n        return null\n      } else if (mode === 'delete') {\n        if (numDeleted === 0) {\n          // then perform normal backspace operation\n          const lastPos = selectionIndices\n            .filter(([start, end]) => start === end)\n            .map(([, end]) => end)\n            .pop()\n\n          if (lastPos !== undefined) {\n            // should only be a single cursor! (multiple cursors are not supported by default in browsers?)\n            const newValue =\n              newValueSpansRemoved.slice(0, lastPos) + newValueSpansRemoved.slice(lastPos + 1)\n\n            return { value: newValue, offset: lastPos }\n          }\n        } else {\n          // from end of last selection minus deleted chars will be new pos\n          // collapse multiple ranges into one for simplicity\n          const lastPos = selectionIndices.map(([, end]) => end).pop()\n\n          if (lastPos !== undefined) {\n            return { value: newValueSpansRemoved, offset: lastPos - numDeleted }\n          }\n        }\n\n        console.warn('invalid \"delete\" process, abort', {\n          container,\n          selectionIndices,\n          oldValue,\n          newValueSpansRemoved,\n          numDeleted,\n        })\n        return null\n      } else if (mode === 'paste') {\n        if (numDeleted === 0) {\n          // just find first position\n          const firstPos = selectionIndices\n            .filter(([start, end]) => start === end)\n            .map(([start]) => start)\n            .shift()\n\n          if (firstPos !== undefined) {\n            return { value: newValueSpansRemoved, offset: firstPos }\n          }\n        } else {\n          const firstPos = selectionIndices.map(([start]) => start).shift()\n\n          if (firstPos !== undefined) {\n            return { value: newValueSpansRemoved, offset: firstPos }\n          }\n        }\n\n        console.warn('invalid \"paste\" process, abort', {\n          container,\n          selectionIndices,\n          oldValue,\n          newValueSpansRemoved,\n          numDeleted,\n        })\n        return null\n      }\n    }\n\n    function handleInsert(value: string) {\n      const result = doRemove('paste')\n      if (!result) return\n\n      const valueToInsertSanitized = sanitizeValue(value)\n\n      const { value: newValue, offset: insertPos } = result\n      const newValueWithInsert =\n        newValue.slice(0, insertPos) + valueToInsertSanitized + newValue.slice(insertPos)\n      const newCursorPos = insertPos + value.length\n\n      setSanitizedValue(newValueWithInsert)\n      setCursorPos(newCursorPos)\n\n      if (inputRef.current) {\n        inputRef.current.value = newValueWithInsert\n      }\n      onChange?.(newValueWithInsert)\n      onCursorChange?.(newCursorPos)\n    }\n\n    function handleBackspace() {\n      const result = doRemove('backspace')\n      if (!result) return\n\n      const { value: newValue, offset: newCursorPos } = result\n\n      const sanitizedValue = sanitizeValue(newValue)\n\n      setSanitizedValue(sanitizedValue)\n      setCursorPos(newCursorPos)\n\n      if (inputRef.current) {\n        inputRef.current.value = sanitizedValue\n      }\n      // if (mRef.current) {\n      //   mRef.current.innerHTML = fancifyValue(sanitizedValue)\n      // }\n      onChange?.(sanitizedValue)\n      onCursorChange?.(newCursorPos)\n    }\n\n    function handleDelete() {\n      const result = doRemove('delete')\n      if (!result) return\n\n      const { value: newValue, offset: newCursorPos } = result\n\n      const sanitizedValue = sanitizeValue(newValue)\n\n      setSanitizedValue(sanitizedValue)\n      setCursorPos(newCursorPos)\n\n      if (inputRef.current) {\n        inputRef.current.value = sanitizedValue\n      }\n      onChange?.(sanitizedValue)\n      onCursorChange?.(newCursorPos)\n    }\n\n    // ------------------------------------------------------------------------\n    // UI\n\n    return (\n      <>\n        <div\n          role=\"input\"\n          // @ts-expect-error: expected, we want to set it for styling\n          disabled={disabled}\n          placeholder={placeholder}\n          spellCheck={false} // can be overwritten\n          autoCapitalize=\"off\"\n          autoCorrect=\"off\"\n          {...props}\n          onInput={handleInput}\n          onPaste={handlePaste}\n          onKeyDown={handleKeyDown}\n          onKeyUp={() => handlePossibleCursorChange()}\n          onClick={() => handlePossibleCursorChange(true)}\n          tabIndex={disabled ? -1 : props.tabIndex}\n          contentEditable // plaintext-only?\n          dangerouslySetInnerHTML={{ __html: htmlValue }}\n          ref={mRef}\n        />\n        {placeholder && value === '' && (\n          <span className=\"input-placeholder-simulacrum\">{placeholder}</span>\n        )}\n        {/* required for form submission */}\n        <input type=\"hidden\" ref={inputRef} />\n      </>\n    )\n  }\n)\n\n// to make it show up in the dev tools\nContentEditable.displayName = 'ContentEditable'\n\nexport default ContentEditable\n","import type { FuzzyMatches } from '@nozbe/microfuzz'\nimport { Highlight, useFuzzySearchList } from '@nozbe/microfuzz/react'\nimport { useMemo, useState } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Form from 'react-bootstrap/Form'\nimport Modal from 'react-bootstrap/Modal'\nimport Row from 'react-bootstrap/Row'\nimport { useTranslation } from 'react-i18next'\n\nimport type { Resource } from '@/utils/api'\nimport type { LanguageCode2NameMap, LanguageFilterOptions } from '@/utils/search'\nimport { DEFAULT_SEARCH_LANGUAGE_FILTER, MULTIPLE_LANGUAGE_CODE } from '@/utils/search'\n\n// --------------------------------------------------------------------------\n// types\n\nexport type LanguageModelCloseActions = 'close' | 'confirm' | 'abort'\n\ninterface LanguageModalProps {\n  show: boolean\n  languages?: LanguageCode2NameMap\n  resources?: Resource[]\n  searchLanguage?: string\n  searchLanguageFilter?: LanguageFilterOptions\n  showResourceCounts?: boolean\n  showLanguageFilterOptions?: boolean\n  onModalClose: (result: {\n    language: string\n    filter: LanguageFilterOptions\n    action: LanguageModelCloseActions\n  }) => void\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction LanguageModal({\n  show,\n  languages,\n  resources,\n  searchLanguage,\n  searchLanguageFilter,\n  showResourceCounts: paramShowResourceCounts,\n  showLanguageFilterOptions = true,\n  onModalClose,\n}: LanguageModalProps) {\n  const { t } = useTranslation()\n\n  //  = { languages: {}, searchLanguage: MULTIPLE_LANGUAGE_CODE, searchLanguageFilter: DEFAULT_SEARCH_LANGUAGE_FILTER }\n  const [selectedLanguage, setSelectedLanguage] = useState(searchLanguage || MULTIPLE_LANGUAGE_CODE)\n  const [selectedFilterOption, setSelectedFilterOption] = useState(\n    searchLanguageFilter || DEFAULT_SEARCH_LANGUAGE_FILTER\n  )\n  const [languageFilter, setLanguageFilter] = useState('')\n  const [showResourceCounts, setShowResourceCounts] = useState(paramShowResourceCounts ?? false)\n\n  const languageToNumberOfResources = useMemo(() => {\n    const counts = new Map<string, number>()\n\n    if (resources) {\n      resources.forEach((resource) =>\n        resource.languages.forEach((language) =>\n          counts.set(language, (counts.get(language) ?? 0) + 1)\n        )\n      )\n      counts.set(MULTIPLE_LANGUAGE_CODE, resources.length)\n    }\n\n    return counts\n  }, [resources])\n\n  const filteredLanguages = useFuzzySearchList({\n    list: Object.entries(languages ?? {}).toSorted(),\n    // If `queryText` is blank, `list` is returned in whole\n    queryText: languageFilter,\n    getText: (item) => [item[0], item[1]],\n    mapResultItem: ({ item, score, matches }) => ({ item, matches, score }),\n  })\n\n  if (!languages) return null\n\n  const oneThird = Math.floor((filteredLanguages.length + 2) / 3)\n\n  // ------------------------------------------------------------------------\n  // event handlers\n\n  function handleClose(action: LanguageModelCloseActions) {\n    onModalClose({\n      language: selectedLanguage,\n      filter: selectedFilterOption,\n      action: action,\n    })\n  }\n\n  function handleReset() {\n    setSelectedLanguage(searchLanguage || MULTIPLE_LANGUAGE_CODE)\n    setSelectedFilterOption(searchLanguageFilter || DEFAULT_SEARCH_LANGUAGE_FILTER)\n  }\n\n  function handleToggleShowResourceCountsChange() {\n    setShowResourceCounts((show) => !show)\n  }\n\n  // ------------------------------------------------------------------------\n  // UI\n\n  function renderLanguageOption(\n    code: string,\n    language: string | null,\n    highlights?: FuzzyMatches,\n    score?: number\n  ) {\n    const isSelected = selectedLanguage === code\n    let className = 'd-block py-0 my-1 border-0'\n    if (isSelected) className += ' fw-semibold selected'\n\n    if (highlights === undefined) highlights = [null, null]\n\n    return (\n      <Button\n        size=\"sm\"\n        // variant=\"outline-dark\"\n        className={className}\n        style={{\n          color: `var(${isSelected ? '--bs-green' : '--bs-body-colors'})`,\n          backgroundColor: 'var(--bs-body-bg)',\n        }}\n        onClick={() => setSelectedLanguage(code)}\n        data-filter-score={score}\n        key={code}\n      >\n        {isSelected && <span className=\"selected-marker me-1\"></span>}\n        <Highlight ranges={highlights[1]} text={language ?? code} />{' '}\n        <sup>\n          <Highlight ranges={highlights[0]} text={code} />\n        </sup>\n        {showResourceCounts && languageToNumberOfResources.has(code) && (\n          <>\n            {' '}\n            <span className=\"text-muted\">({languageToNumberOfResources.get(code)})</span>\n          </>\n        )}\n      </Button>\n    )\n  }\n\n  return (\n    <Modal show={show} onHide={() => handleClose('close')} size=\"xl\" fullscreen=\"lg-down\" centered>\n      <Modal.Header closeButton>\n        <Modal.Title>{t('search.languagesModal.title')}</Modal.Title>\n      </Modal.Header>\n      <Modal.Body className=\"px-0\">\n        <Container\n          className={['px-4']\n            .concat(showLanguageFilterOptions ? ['pb-3 border-bottom'] : [])\n            .join(' ')}\n        >\n          <Row>\n            <Col sm></Col>\n            <Col sm className=\"mb-3 mb-sm-2 align-content-end\">\n              {renderLanguageOption(\n                MULTIPLE_LANGUAGE_CODE,\n                t('languageCodeToName.any', { ns: 'common' })\n              )}\n            </Col>\n            <Col sm>\n              <Form.Control\n                size=\"sm\"\n                placeholder={t('search.languagesModal.filterInputPlaceholder')}\n                name=\"languages-filter\"\n                value={languageFilter}\n                onChange={(event) => setLanguageFilter(event.target.value)}\n              />\n              {resources && (\n                <Form.Check\n                  name=\"languages-show-count\"\n                  id=\"languages-show-count\"\n                  checked={showResourceCounts}\n                  onChange={handleToggleShowResourceCountsChange}\n                  type=\"checkbox\"\n                  label={t('search.languagesModal.checkboxShowNumberOfResources')}\n                  className=\"mt-1\"\n                />\n              )}\n            </Col>\n          </Row>\n          <Row>\n            <Col sm>\n              {filteredLanguages\n                .slice(0, oneThird)\n                .map(({ item: [code, language], matches, score }) =>\n                  renderLanguageOption(code, language, matches, score)\n                )}\n            </Col>\n            <Col sm>\n              {filteredLanguages\n                .slice(oneThird, 2 * oneThird)\n                .map(({ item: [code, language], matches, score }) =>\n                  renderLanguageOption(code, language, matches, score)\n                )}\n            </Col>\n            <Col sm>\n              {filteredLanguages\n                .slice(2 * oneThird)\n                .map(({ item: [code, language], matches, score }) =>\n                  renderLanguageOption(code, language, matches, score)\n                )}\n            </Col>\n          </Row>\n        </Container>\n        {showLanguageFilterOptions && (\n          <Form>\n            <Container className=\"px-4 pt-3\">\n              {(['byMeta', 'byGuess', 'byMetaAndGuess'] as LanguageFilterOptions[]).map((type) => (\n                <Form.Check\n                  key={type}\n                  type=\"radio\"\n                  name=\"filterOpts\"\n                  value={type}\n                  id={`filterOpts-${type}`}\n                  checked={selectedFilterOption === type}\n                  onChange={() => setSelectedFilterOption(type)}\n                  label={t(`search.languagesModal.optionLanguage${type}`)}\n                />\n              ))}\n            </Container>\n          </Form>\n        )}\n      </Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"secondary\" onClick={handleReset}>\n          {t('search.languagesModal.buttonReset')}\n        </Button>\n        <Button variant=\"secondary\" onClick={() => handleClose('abort')}>\n          {t('search.languagesModal.buttonAbort')}\n        </Button>\n        <Button variant=\"primary\" onClick={() => handleClose('confirm')}>\n          {t('search.languagesModal.buttonConfirm')}\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  )\n}\n\nexport default LanguageModal\n","export type QueryTypeID = (typeof QUERY_TYPES)[number]['id']\nexport type QueryTypeIDForQueryBuilder = (typeof QUERY_TYPES_WITH_BUILDER_SUPPORT)[number]\nexport type DownloadFormats = (typeof DOWNLOAD_FORMATS)[number]['id']\nexport type NumberOfResults = (typeof NUMBER_OF_RESULTS)[number]\n\n// --------------------------------------------------------------------------\n\nexport const QUERY_TYPES = [\n  {\n    id: 'cql',\n    name: 'Text layer Contextual Query Language (CQL)',\n    searchLabel: 'Full-text search',\n    color: '#29a900',\n    searchPlaceholder: 'Elephant',\n  },\n  {\n    id: 'fcs',\n    name: 'Multi-layer Federated Content Search Query Language (FCS-QL)',\n    searchLabel: 'Multi-layer annotation search',\n    color: '#00a8cc',\n    searchPlaceholder: \"[word = 'annotation'][word = 'focused']\",\n  },\n  {\n    id: 'lex',\n    name: 'Lexical Resources Contextual Query Language (LexCQL)',\n    searchLabel: 'Lexical resource search',\n    color: '#e77e00',\n    searchPlaceholder: 'banana',\n  },\n] as const\n\nexport const QUERY_TYPE_MAP = Object.fromEntries(\n  ['cql', 'fcs', 'lex'].map((id) => [id, QUERY_TYPES.find((qt) => qt.id === id)])\n)\n\nexport const QUERY_TYPES_WITH_BUILDER_SUPPORT = ['fcs', 'lex'] as const\n\nexport const DOWNLOAD_FORMATS = [\n  { id: 'text', label: 'Plain Text' },\n  { id: 'csv', label: 'CSV' },\n  { id: 'tcf', label: 'TCF' },\n  { id: 'ods', label: 'ODS' },\n  { id: 'excel', label: 'Excel' },\n] as const\n\nexport const DEFAULT_QUERY_TYPE: QueryTypeID = 'cql'\n\nexport const NUMBER_OF_RESULTS = [10, 20, 50, 100, 200, 250] as const\n\nexport const NO_MORE_RECORDS_DIAGNOSTIC_URI = 'info:srw/diagnostic/1/61'\n","import { QueryTypeID } from '@/utils/constants'\n\ninterface Example {\n  id: string\n  queryType: QueryTypeID\n  query: string\n  description: string\n  resourceIDs?: string[] | undefined\n}\n\nexport default [\n  {\n    id: 'cql-single-term',\n    queryType: 'cql',\n    query: 'Elephant',\n    description: 'Query with single term',\n  },\n  {\n    id: 'cql-with-boolean',\n    queryType: 'cql',\n    query: 'cat AND dog',\n    description: 'Query with boolean',\n  },\n  {\n    id: 'cql-with-phrase',\n    queryType: 'cql',\n    query: '\"exciting news\"',\n    description: 'Query with phrase (quoting because of whitespaces)',\n  },\n\n  {\n    id: 'fcs-three-tokens-artznei',\n    queryType: 'fcs',\n    query: '[ word = \"her.*\" ] [ lemma = \"Artznei\" ] [ pos = \"VERB\" ]',\n    description:\n      'Phrase with three tokens: a word starting with \"her\", a lemmatized word, and a verb',\n    resourceIDs: [\n      // Deutsches Textarchiv (DTA) - Berlin-Brandenburg Academy of Sciences and Humanities\n      'https://clarin.bbaw.de/fcs/dta#http://hdl.handle.net/11858/00-203C-0000-0023-8324-0',\n    ],\n  },\n\n  {\n    id: 'lex-plain-string',\n    queryType: 'lex',\n    query: 'apple',\n    description: 'Search for plain string',\n  },\n  {\n    id: 'lex-lemma-with-language',\n    queryType: 'lex',\n    query: 'lemma =/lang=deu \"Apfel\"',\n    description: 'Search for German lemma \"Apfel\"',\n  },\n] as Example[]\n","import { Fragment } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Modal from 'react-bootstrap/Modal'\nimport Row from 'react-bootstrap/Row'\nimport { useTranslation } from 'react-i18next'\n\nimport { QUERY_TYPE_MAP, QueryTypeID } from '@/utils/constants'\nimport { highlightSyntax } from '@/utils/prism'\nimport exampleQueries from './examples'\n\n// --------------------------------------------------------------------------\n// types\n\ninterface QuerySuggestionsModal {\n  show: boolean\n  queryTypes?: QueryTypeID[]\n  onModalClose: (result: {\n    query?: string\n    queryType?: QueryTypeID\n    resourceIDs?: string[]\n    action: string\n  }) => void\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction QuerySuggestionsModal({\n  show,\n  queryTypes: queryTypesProp,\n  onModalClose,\n}: QuerySuggestionsModal) {\n  const { t } = useTranslation()\n\n  const queryTypes: readonly QueryTypeID[] =\n    queryTypesProp && queryTypesProp.length > 0 ? queryTypesProp : ['cql', 'fcs', 'lex']\n  const requestedExamples = exampleQueries.filter((example) =>\n    queryTypes.includes(example.queryType)\n  )\n\n  // if there are no examples queries for this set of queryTypes, then do not show anything\n  if (requestedExamples.length === 0) {\n    handleClose('abort')\n    return null\n  }\n\n  // --------------------------------------------------------------\n  // event handlers\n\n  function handleClose(action: string) {\n    onModalClose({ query: undefined, queryType: undefined, resourceIDs: undefined, action: action })\n  }\n\n  function handleUseQueryClose(\n    query: string,\n    queryType: QueryTypeID,\n    resourceIDs: string[] | undefined = undefined\n  ) {\n    // TODO: better action name? \"use\"\n    onModalClose({\n      query: query,\n      queryType: queryType,\n      resourceIDs: resourceIDs,\n      action: 'confirm',\n    })\n  }\n\n  // --------------------------------------------------------------\n  // rendering\n\n  function renderExample(\n    query: string,\n    queryType: QueryTypeID,\n    description?: string,\n    resourceIDs?: string[] | undefined,\n    nr?: number\n  ) {\n    // TODO: get description from translation resource?\n    return (\n      <Row key={query}>\n        <Col md={'auto'} className=\"d-none d-md-block\">\n          {nr && `${nr}.`}\n        </Col>\n        <Col className=\"d-flex flex-column\">\n          {description !== undefined && <div>{description}</div>}\n          <div dangerouslySetInnerHTML={{ __html: highlightSyntax(query, queryType) }} />\n        </Col>\n        <Col md={'auto'} className=\"d-flex justify-content-end align-items-baseline\">\n          <Button size=\"sm\" onClick={() => handleUseQueryClose(query, queryType, resourceIDs)}>\n            {t('search.suggestionsModal.buttonUseQuery')}\n          </Button>\n        </Col>\n      </Row>\n    )\n  }\n\n  return (\n    <Modal\n      id=\"search-query-suggestions-modal\"\n      show={show}\n      onHide={() => handleClose('close')}\n      size=\"xl\"\n      fullscreen=\"xl-down\"\n      centered\n    >\n      <Modal.Header closeButton>\n        <Modal.Title>{t('search.suggestionsModal.title')}</Modal.Title>\n      </Modal.Header>\n      <Modal.Body className=\"px-0\">\n        {/* grouped by querytype or other category; each item with label/description, query, button to use */}\n        {/* TODO: should use table instead? */}\n        <Container fluid>\n          {queryTypes.map((queryType) => {\n            const examples = requestedExamples.filter((example) => example.queryType === queryType)\n\n            // skip if no examples for this queryType\n            if (examples.length === 0) return null\n\n            return (\n              <Fragment key={queryType}>\n                <Row>\n                  <Col>\n                    <h4 className=\"border-bottom pb-2\">\n                      {t(`queryTypes.${queryType}.nameLong`, {\n                        ns: 'common',\n                        defaultValue: QUERY_TYPE_MAP[queryType]?.name ?? queryType.toUpperCase(),\n                      })}\n                    </h4>\n                  </Col>\n                </Row>\n                {examples.map((example, index) =>\n                  renderExample(\n                    example.query,\n                    example.queryType,\n                    example.description,\n                    example.resourceIDs,\n                    index + 1\n                  )\n                )}\n              </Fragment>\n            )\n          })}\n        </Container>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"primary\" onClick={() => handleClose('close')}>\n          {t('search.suggestionsModal.buttonClose')}\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  )\n}\n\nexport default QuerySuggestionsModal\n","import { useEffect, useState } from 'react'\nimport Form from 'react-bootstrap/Form'\n\nimport useDebounce from '@/hooks/useDebounce'\n\n// --------------------------------------------------------------------------\n\nfunction DebouncedFuzzySearchInput({\n  disabled,\n  value,\n  onChange,\n  delay = 300,\n}: {\n  disabled?: boolean\n  value?: string\n  onChange: (filter: string) => void\n  delay?: number\n}) {\n  const [filter, setFilter] = useState(value ?? '')\n  const deboundedFilter = useDebounce(filter, delay)\n\n  useEffect(() => {\n    onChange(deboundedFilter)\n  }, [onChange, deboundedFilter])\n\n  return (\n    <Form.Control\n      type=\"search\"\n      placeholder=\"Search for ...\"\n      value={filter}\n      onChange={(event) => setFilter(event.target.value)}\n      disabled={disabled}\n    />\n  )\n}\n\nexport default DebouncedFuzzySearchInput\n","import type { HighlightRanges } from '@nozbe/microfuzz'\nimport { useFuzzySearchList } from '@nozbe/microfuzz/react'\n\nimport type { Resource } from '@/utils/api'\nimport { flattenResources, getBestFromMultilingualValuesTryByLanguage } from '@/utils/resources'\n\nexport type ResourceSearchFields = 'title' | 'institution' | 'description'\nexport type FuzzyMatchesByField = Map<ResourceSearchFields, HighlightRanges | null>\n\nexport default function useFuzzySearchListWithHierarchy(\n  filter: string,\n  resources: Resource[],\n  locale: string,\n  fields?: ResourceSearchFields[]\n) {\n  // flatten nested list to allow fuzzy search everywhere\n  const flattenedResources = flattenResources(resources)\n\n  fields ??= ['title', 'institution', 'description']\n\n  // fuzzy reduce search results\n  const filteredResources = useFuzzySearchList({\n    list: flattenedResources,\n    // TODO: only search in \"resource\" mode for now\n    // queryText: viewResourcesGrouping === 'resource' ? filter : '',\n    queryText: filter,\n    getText: (item) => {\n      const strings = []\n      if (fields.includes('title')) {\n        strings.push(getBestFromMultilingualValuesTryByLanguage(item.title, locale))\n      }\n      if (fields.includes('institution')) {\n        strings.push(getBestFromMultilingualValuesTryByLanguage(item.institution, locale))\n      }\n      if (fields.includes('description')) {\n        strings.push(getBestFromMultilingualValuesTryByLanguage(item.description, locale))\n      }\n      return strings\n    },\n    // structure matches for better access?\n    mapResultItem: ({ item, score, matches }) => {\n      // map array to map\n      const matchesByField = new Map<ResourceSearchFields, HighlightRanges | null>()\n      let fieldIdx = 0\n      if (fields.includes('title')) matchesByField.set('title', matches[fieldIdx++])\n      if (fields.includes('institution')) matchesByField.set('institution', matches[fieldIdx++])\n      if (fields.includes('description')) matchesByField.set('description', matches[fieldIdx++])\n\n      return { resource: item, matches: matchesByField, score }\n    },\n  })\n  // console.debug('filtered resources', filter, filteredResources)\n\n  // TODO: does this improve anything (since we debounce the input?)\n  // if (filter === '') {\n  //   return {\n  //     resources: resources,\n  //     matches: undefined,\n  //     scores: undefined,\n  //   }\n  // }\n\n  // all matches for highlighting\n  const filteredResourcesHighlights: Map<string, FuzzyMatchesByField> = filteredResources.reduce(\n    (map, { resource, matches }) => (map.set(resource.id, matches), map),\n    new Map()\n  )\n  // all scores (to be augmented with missing parents for nested children)\n  const filteredResourcesScores: Map<string, number> = filteredResources.reduce(\n    (map, { resource, score }) => map.set(resource.id, score),\n    new Map()\n  )\n\n  // find parents that are filtered out by useFuzzySearchList to get back the hierarchy\n  const resourceIDsOfParentsToAdd = new Set()\n\n  // children (nested), we need to generate the missing parents\n  filteredResources\n    .filter(({ resource }) => resource.rootResourceId !== null)\n    .forEach(({ resource, score }) => {\n      const rootScore = filteredResourcesScores.get(resource.rootResourceId!)\n      if (rootScore === undefined) {\n        // if unknown, add score and add parent to to-be-added list\n        resourceIDsOfParentsToAdd.add(resource.rootResourceId)\n        filteredResourcesScores.set(resource.rootResourceId!, score)\n      } else if (score < rootScore) {\n        // if known but with smaller score, update score to rank higher\n        filteredResourcesScores.set(resource.rootResourceId!, score)\n      }\n    })\n\n  // to-be-added parents for children with results\n  const filteredResourcesParents = resources\n    .filter((resource) => resourceIDsOfParentsToAdd.has(resource.id))\n    .map((resource) => ({ resource, score: filteredResourcesScores.get(resource.id) }))\n\n  // default results (not nested/children)\n  const filteredResourcesRoots = filteredResources.filter(\n    ({ resource }) => !resource.rootResourceId\n  )\n\n  // combined list of results; minus highlighted children; plus roots of highlighted children\n  const mergedFilteredResources = [...filteredResourcesRoots, ...filteredResourcesParents]\n    .toSorted(({ score: aScore }, { score: bScore }) =>\n      aScore === bScore ? 0 : aScore === undefined ? 1 : bScore === undefined ? -1 : aScore - bScore\n    )\n    .map(({ resource }) => resource)\n\n  return {\n    resources: mergedFilteredResources,\n    matches: filteredResourcesHighlights,\n    scores: filteredResourcesScores,\n  }\n}\n","import { Highlight } from '@nozbe/microfuzz/react'\nimport { useEffect, useState } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Card from 'react-bootstrap/Card'\nimport Col from 'react-bootstrap/Col'\nimport Form from 'react-bootstrap/Form'\nimport Row from 'react-bootstrap/Row'\nimport ToggleButton from 'react-bootstrap/ToggleButton'\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup'\nimport { useTranslation } from 'react-i18next'\n\nimport type { FuzzyMatchesByField } from '@/hooks/useFuzzySearchListWithHierarchy'\nimport appStore from '@/stores/app'\nimport { useLocaleStore } from '@/stores/locale'\nimport type { Resource } from '@/utils/api'\nimport {\n  getBestFromMultilingualValuesTryByLanguage,\n  getLanguagesFromResourceInfo,\n} from '@/utils/resources'\n\nimport bankIcon from 'bootstrap-icons/icons/bank.svg?raw'\nimport houseDoorIcon from 'bootstrap-icons/icons/house-door.svg?raw'\nimport shieldCheckIcon from 'bootstrap-icons/icons/shield-check.svg?raw'\nimport shieldLockIcon from 'bootstrap-icons/icons/shield-lock.svg?raw'\nimport translateIcon from 'bootstrap-icons/icons/translate.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n\nfunction ResourceSelector({\n  resource,\n  selectedResourceIDs,\n  highlighting,\n  highlightings,\n  shouldBeShown,\n  localeForInfos,\n  onSelectClick,\n  languageCodeToName,\n}: {\n  resource: Resource\n  selectedResourceIDs: string[]\n  highlighting?: FuzzyMatchesByField\n  highlightings?: Map<string, FuzzyMatchesByField>\n  shouldBeShown: ((resource: Resource) => boolean) | boolean\n  localeForInfos?: string | null\n  onSelectClick: (resource: Resource, selected: boolean) => void\n  languageCodeToName: (code: string) => string\n}) {\n  const { t } = useTranslation()\n\n  const isAuthenticated = appStore.getState().isAuthenticated\n\n  const [expanded, setExpanded] = useState(false)\n  const [showSubResources, setShowSubResources] = useState(false)\n\n  highlighting ??= highlightings?.get(resource.id) ?? new Map()\n\n  const isSelected = selectedResourceIDs.includes(resource.id)\n\n  // --------------------------------------------------------------\n\n  const languageForResource = getLanguagesFromResourceInfo(resource)\n\n  const userLocale = useLocaleStore((state) => state.locale)\n\n  const [locale, setLocale] = useState(userLocale)\n  // update from outside\n  useEffect(() => {\n    if (userLocale) setLocale(userLocale)\n  }, [userLocale])\n  useEffect(() => {\n    if (localeForInfos) setLocale(localeForInfos)\n  }, [localeForInfos])\n\n  // --------------------------------------------------------------\n\n  // check if resource should even be rendered\n  if (typeof shouldBeShown === 'function' && !shouldBeShown(resource)) {\n    return null\n  } else if (shouldBeShown === false) {\n    return null\n  }\n\n  // whether the expand/collapse button should be shown\n  // also, whether the sub-resources div should be shown\n  const shouldExpandToggleBeShown =\n    typeof shouldBeShown === 'function'\n      ? resource.subResources.some((subresource) => shouldBeShown(subresource))\n      : true\n\n  // --------------------------------------------------------------\n\n  function handleToggleExpansionClick() {\n    // stop de-expansion toggle if user is selecting\n    // see: https://stackoverflow.com/a/78044274/9360161\n    if (expanded && document.getSelection()?.type === 'Range') return\n    setExpanded((isExpanded) => !isExpanded)\n  }\n\n  function handleToggleSelectionClick() {\n    onSelectClick(resource, !isSelected)\n  }\n\n  function handleToggleShowSubResourcesClick() {\n    setShowSubResources((doShow) => !doShow)\n  }\n\n  // --------------------------------------------------------------\n\n  function renderResourceAvailabilityRestriction() {\n    // TODO: do we always want to render this, regardless of whether we enable authentication?\n    if (!import.meta.env.FEATURE_AUTHENTICATION) return null\n\n    if (resource.availabilityRestriction !== 'NONE') {\n      // TODO: add tooltips/aria-labels to describe access status\n      return (\n        <>\n          <i\n            dangerouslySetInnerHTML={{ __html: isAuthenticated ? shieldCheckIcon : shieldLockIcon }}\n          />{' '}\n        </>\n      )\n    }\n  }\n\n  // --------------------------------------------------------------\n\n  return (\n    <>\n      <Row className={`p-2 m-1 ${expanded && 'border-bottom'}`}>\n        <Col md=\"auto\" sm={1} onClick={handleToggleSelectionClick}>\n          <Form.Check\n            id={`resource-selection-${resource.id}`}\n            aria-label={t('search.results.resourceInfo.checkboxResourceAriaLabel', {\n              title: resource.title,\n            })}\n          >\n            <Form.Check.Input\n              checked={isSelected}\n              onChange={() => {}} // to silence react warning, use handler from parent's parent\n            />\n          </Form.Check>\n        </Col>\n        <Col\n          md={8}\n          sm={11}\n          className={`mb-sm-2 ${expanded ? '' : 'text-truncate'}`}\n          // TODO: only if we want to have a larger clickable area for the selection checkbox, not so nice when we have sub-resources ...\n          onClick={handleToggleExpansionClick}\n        >\n          <h4 className={`h5 ${expanded ? '' : 'text-truncate'}`}>\n            {renderResourceAvailabilityRestriction()}\n            <Highlight\n              text={getBestFromMultilingualValuesTryByLanguage(resource.title, locale) ?? ''}\n              ranges={highlighting.get('title') ?? null}\n            />{' '}\n            {resource.landingPage && (\n              <small>\n                <a href={resource.landingPage} className=\"matomo_link\" target=\"_blank\">\n                  {t('search.resourcesModal.resource.moreInformation')}{' '}\n                  <i dangerouslySetInnerHTML={{ __html: houseDoorIcon }} />\n                </a>\n              </small>\n            )}\n          </h4>\n          <p className={`mb-0 ${expanded ? '' : 'text-truncate'}`}>\n            {getBestFromMultilingualValuesTryByLanguage(resource.description, locale) && (\n              <Highlight\n                text={\n                  getBestFromMultilingualValuesTryByLanguage(resource.description, locale) ?? ''\n                }\n                ranges={highlighting.get('description') ?? null}\n              />\n            )}\n          </p>\n        </Col>\n        <Col\n          md={{ span: 3, offset: 0 }}\n          sm={{ span: 11, offset: 1 }}\n          className={`${expanded ? '' : ' text-truncate'}`}\n          onClick={handleToggleExpansionClick}\n        >\n          <i dangerouslySetInnerHTML={{ __html: bankIcon }} />{' '}\n          <Highlight\n            text={getBestFromMultilingualValuesTryByLanguage(resource.institution, locale) ?? ''}\n            ranges={highlighting.get('institution') ?? null}\n          />\n          <br />\n          <i dangerouslySetInnerHTML={{ __html: translateIcon }} />{' '}\n          {resource.languages.map(languageCodeToName).sort().join(', ')}\n          {expanded && languageForResource.length > 1 && (\n            <>\n              <br />\n              <ToggleButtonGroup\n                type=\"radio\"\n                name={`resources-${resource.id}-info-languages`}\n                defaultValue={locale}\n                onChange={(language) => setLocale(language)}\n                onClick={(e) => e.stopPropagation()}\n                className=\"mt-2\"\n              >\n                {languageForResource.toSorted().map((language) => (\n                  <ToggleButton\n                    variant=\"outline-secondary\"\n                    size=\"sm\"\n                    key={language}\n                    id={`resources-${resource.id}-info-languages-${language}`}\n                    value={language}\n                    type=\"radio\"\n                  >\n                    {language}\n                  </ToggleButton>\n                ))}\n              </ToggleButtonGroup>\n            </>\n          )}\n        </Col>\n        {/* sub resources view button */}\n        {shouldExpandToggleBeShown && resource.subResources.length > 0 && (\n          <>\n            <div className=\"w-100\"></div>\n            <Col md=\"auto\" sm={1} style={{ width: '2.8rem' }}></Col>\n            <Col md={{ span: 8, offset: 0 }} sm={{ span: 11, offset: 1 }}>\n              <Button\n                variant=\"link\"\n                size=\"sm\"\n                className=\"ps-0\"\n                onClick={handleToggleShowSubResourcesClick}\n              >\n                {/* TODO: hint if view-selected-only and no children are selected --> empty */}\n                {t('search.resourcesModal.resource.toggleExpand', {\n                  context: showSubResources ? 'collapse' : 'expand',\n                  count: resource.subResources.length,\n                })}\n              </Button>\n            </Col>\n          </>\n        )}\n      </Row>\n      {/* sub resources */}\n      {shouldExpandToggleBeShown && showSubResources && (\n        <Card className=\"ms-md-5 ms-sm-2 border-end-0 border-top-0 rounded-end-0 rounded-top-0\">\n          {resource.subResources.map((subResource: Resource) => (\n            <ResourceSelector\n              resource={subResource}\n              highlightings={highlightings}\n              selectedResourceIDs={selectedResourceIDs}\n              shouldBeShown={shouldBeShown}\n              onSelectClick={onSelectClick}\n              languageCodeToName={languageCodeToName}\n              key={subResource.id}\n            />\n          ))}\n        </Card>\n      )}\n    </>\n  )\n}\n\nexport default ResourceSelector\n","import { useEffect, useMemo, useRef, useState } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Col from 'react-bootstrap/Col'\nimport Collapse from 'react-bootstrap/Collapse'\nimport Container from 'react-bootstrap/Container'\nimport Form from 'react-bootstrap/Form'\nimport Row from 'react-bootstrap/Row'\nimport { useTranslation } from 'react-i18next'\nimport slugify from 'react-slugify'\n\nimport type { FuzzyMatchesByField } from '@/hooks/useFuzzySearchListWithHierarchy'\nimport type { Resource } from '@/utils/api'\nimport { getResourceIDs } from '@/utils/resources'\nimport ResourceSelector from './ResourceSelector'\n\n// --------------------------------------------------------------------------\n\nfunction GroupedResources({\n  title,\n  titleId,\n  resources,\n  selectedResourceIDs,\n  resourceScores,\n  highlightings,\n  expanded: expandedProp,\n  shouldBeShown,\n  localeForInfos,\n  onSelectClick,\n  onExpandToggleClick,\n  onSelectAllClick,\n  onDeselectAllClick,\n  languageCodeToName,\n}: {\n  title: React.ReactNode\n  titleId: string\n  resources: Resource[]\n  selectedResourceIDs: string[]\n  resourceScores?: Map<string, number>\n  highlightings?: Map<string, FuzzyMatchesByField>\n  expanded: boolean\n  shouldBeShown: ((resource: Resource) => boolean) | boolean\n  localeForInfos?: string | null\n  onSelectClick: (resource: Resource, selected: boolean) => void\n  onExpandToggleClick: (expanded: boolean) => void\n  onSelectAllClick: (resources: Resource[]) => void\n  onDeselectAllClick: (resources: Resource[]) => void\n  languageCodeToName: (code: string) => string\n}) {\n  const { t } = useTranslation()\n\n  const [expanded, setExpanded] = useState(expandedProp)\n  useEffect(() => {\n    // console.log('resource.selected', resource.selected, resource.id)\n    setExpanded(expandedProp)\n  }, [expandedProp])\n\n  // checkbox state\n  const flatResourceIds = useMemo(() => getResourceIDs(resources), [resources])\n  const flatResourcesSelected = flatResourceIds.filter((resourceId) =>\n    selectedResourceIDs.includes(resourceId)\n  )\n  const isAllSelected = flatResourcesSelected.length === flatResourceIds.length\n  const isNoneSelected = flatResourcesSelected.length === 0\n  const isSomeSelected = !isAllSelected && !isNoneSelected\n  const isSelected = isAllSelected || !isNoneSelected\n\n  const inputRef = useRef<HTMLInputElement | null>(null)\n  if (inputRef.current) inputRef.current.indeterminate = isSomeSelected\n\n  // resources we show\n  // NOTE: buttons to \"(de)select all\" will affect all resources regardless of visibility\n  const visibleResources = useMemo(\n    () =>\n      resourceScores !== undefined\n        ? resources\n            .filter((resource) => resourceScores.has(resource.id))\n            .toSorted((a, b) => {\n              const aScore = resourceScores.get(a.id)\n              const bScore = resourceScores.get(b.id)\n              if (aScore === bScore) return 0\n              if (aScore === undefined) return 1\n              if (bScore === undefined) return -1\n              return aScore - bScore\n            })\n        : resources,\n    [resourceScores, resources]\n  )\n\n  // hide if no visible resources?\n  if (visibleResources.length === 0) return null\n\n  // --------------------------------------------------------------\n  // event handlers\n\n  function handleToggleExpandButton() {\n    setExpanded((isExpanded) => !isExpanded)\n    onExpandToggleClick(!expanded) // TODO: how fast is this update above?\n  }\n\n  function handleToggleSelectionClick() {\n    if (isSomeSelected || !isSelected) {\n      onSelectAllClick(resources)\n    } else {\n      onDeselectAllClick(resources)\n    }\n  }\n\n  // --------------------------------------------------------------\n  // rendering\n\n  function renderResourceCounts() {\n    const rootResources = resources.filter((resource) => !resource.rootResourceId)\n    const numResources = getResourceIDs(rootResources).length\n    const numResourcesRoot = rootResources.length\n    const numResourcesSelected = getResourceIDs(rootResources).filter((rid) =>\n      selectedResourceIDs.includes(rid)\n    ).length\n\n    return (\n      t('search.resourcesModal.grouped.msgResources', {\n        count: numResourcesRoot,\n        nested: numResources - numResourcesRoot,\n        context: numResources - numResourcesRoot ? 'nested' : null,\n      }) +\n      (numResourcesSelected !== numResources\n        ? t('search.resourcesModal.grouped.msgResourcesSelected', { count: numResourcesSelected })\n        : '')\n    )\n  }\n\n  return (\n    <Container className=\"border-bottom pb-2 mb-4 px-0\">\n      <Row className=\"px-3\">\n        <Col md=\"auto\" sm={1} className=\"mt-1\" onClick={handleToggleSelectionClick}>\n          <Form.Check\n            id={`resource-group-selection-${slugify(titleId)}`}\n            aria-label={t('search.results.resourceInfo.checkboxResourceAriaLabel', {\n              title: titleId,\n            })}\n          >\n            <Form.Check.Input\n              checked={isSelected}\n              ref={inputRef}\n              onChange={() => {}} // to silence react warning, use handler from parent's parent\n              // search.resourcesModal.grouped.buttonSelectAll\n              // search.resourcesModal.grouped.buttonDeselectAll\n            />\n          </Form.Check>\n        </Col>\n        <Col md={9} sm={11}>\n          <h3>{title}</h3>\n        </Col>\n        <Col\n          md={2}\n          sm={12}\n          className=\"gap-1 d-inline-flex column-gap-2 justify-content-evenly\"\n          style={{ height: 'fit-content' }}\n        >\n          <Button\n            size=\"sm\"\n            variant=\"secondary\"\n            onClick={handleToggleExpandButton}\n            aria-expanded={expanded}\n          >\n            {t('search.resourcesModal.grouped.buttonExpand', {\n              context: expanded ? 'hide' : 'show',\n            })}\n          </Button>\n          {/* <Button size=\"sm\" onClick={() => onSelectAllClick(resources)}>\n            {t('search.resourcesModal.grouped.buttonSelectAll')}\n          </Button>\n          <Button size=\"sm\" onClick={() => onDeselectAllClick(resources)}>\n            {t('search.resourcesModal.grouped.buttonDeselectAll')}\n          </Button> */}\n        </Col>\n      </Row>\n      <Row className=\"px-3 ps-4 ms-4\">\n        <Col md={{ span: 11, offset: 0 }} sm={{ span: 11, offset: 1 }}>\n          {renderResourceCounts()}\n        </Col>\n      </Row>\n      {/* <Row className=\"px-3\">\n        <Col>\n          {flatResourceIds.length} - {flatResourcesSelected.length} | {isAllSelected && 'all'} -{' '}\n          {isNoneSelected && 'none'} - {isSomeSelected && 'some'} - {isSelected && 'isSelected'}\n        </Col>\n      </Row> */}\n      <Collapse in={expanded}>\n        <Container>\n          {visibleResources.map((resource: Resource) => (\n            <ResourceSelector\n              resource={resource}\n              highlightings={highlightings}\n              selectedResourceIDs={selectedResourceIDs}\n              shouldBeShown={shouldBeShown}\n              onSelectClick={onSelectClick}\n              languageCodeToName={languageCodeToName}\n              localeForInfos={localeForInfos}\n              key={resource.id}\n            />\n          ))}\n        </Container>\n      </Collapse>\n    </Container>\n  )\n}\n\nexport default GroupedResources\n","import { useEffect, useMemo, useState } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport FloatingLabel from 'react-bootstrap/FloatingLabel'\nimport Form from 'react-bootstrap/Form'\nimport Modal from 'react-bootstrap/Modal'\nimport Row from 'react-bootstrap/Row'\nimport ToggleButton from 'react-bootstrap/ToggleButton'\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup'\nimport { useTranslation } from 'react-i18next'\n\nimport DebouncedFuzzySearchInput from '@/components/DebouncedFuzzySearchInput'\nimport useFuzzySearchListWithHierarchy from '@/hooks/useFuzzySearchListWithHierarchy'\nimport { useLocaleStore } from '@/stores/locale'\nimport type { Resource } from '@/utils/api'\nimport {\n  getBestFromMultilingualValuesTryByLanguage,\n  getLanguagesFromResourceInfo,\n  getResourceIDs,\n  isResourceAvailableDueToSubResource,\n  SORT_FNS,\n} from '@/utils/resources'\nimport type {\n  LanguageCode2NameMap,\n  ResourceSelectionModalViewOptionGrouping,\n  ResourceSelectionModalViewOptionSorting,\n  ResourceSelectionModalViewOptionVisibility,\n} from '@/utils/search'\nimport {\n  DEFAULT_RESOURCE_VIEW_GROUPING,\n  DEFAULT_RESOURCE_VIEW_SORTING,\n  DEFAULT_RESOURCE_VIEW_VISIBILITY,\n  languageCodeToName as languageCodeToNameHelper,\n} from '@/utils/search'\nimport GroupedResources from './GroupedResources'\nimport ResourceSelector from './ResourceSelector'\n\nimport bankIcon from 'bootstrap-icons/icons/bank.svg?raw'\nimport translateIcon from 'bootstrap-icons/icons/translate.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\ninterface ResourcesGroupedByKeyMap {\n  [key: string]: {\n    expanded: boolean\n    resources: Resource[]\n  }\n}\n\ninterface ResourceSelectionModalProps {\n  show: boolean\n  showGrouping?: ResourceSelectionModalViewOptionGrouping\n  resources: Resource[]\n  languages?: LanguageCode2NameMap\n  availableResources: string[]\n  selectedResources: string[]\n  onModalClose: (result: { resourceIDs: string[]; action: string }) => void\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ResourceSelectionModal({\n  show,\n  showGrouping,\n  resources,\n  languages,\n  availableResources,\n  selectedResources,\n  onModalClose,\n}: ResourceSelectionModalProps) {\n  const { t } = useTranslation()\n  // locale/language information\n  const userLocale = useLocaleStore((state) => state.locale)\n  const [locale, setLocale] = useState(userLocale)\n  useEffect(() => {\n    if (userLocale) setLocale(userLocale)\n  }, [userLocale])\n\n  const langNames = new Intl.DisplayNames([userLocale, 'en'], { type: 'language' })\n\n  // resources\n  const [selectedResourceIDs, setSelectedResourceIDs] = useState(\n    selectedResources || availableResources\n  )\n\n  // view options\n  const [viewResourcesVisibility, setViewResourcesVisibility] =\n    useState<ResourceSelectionModalViewOptionVisibility>(DEFAULT_RESOURCE_VIEW_VISIBILITY)\n  const [viewResourcesGrouping, setViewResourcesGrouping] =\n    useState<ResourceSelectionModalViewOptionGrouping>(DEFAULT_RESOURCE_VIEW_GROUPING)\n  const [viewResourcesSorting, setViewResourcesSorting] =\n    useState<ResourceSelectionModalViewOptionSorting>(DEFAULT_RESOURCE_VIEW_SORTING)\n\n  // fuzzy filter\n  const [filter, setFilter] = useState('')\n\n  // TODO: grouping\n  const [resourcesGroupedByInstitute, setResourcesGroupedByInstitute] =\n    useState<ResourcesGroupedByKeyMap>({})\n  const [resourcesGroupedByLanguage, setResourcesGroupedByLanguage] =\n    useState<ResourcesGroupedByKeyMap>({})\n\n  useEffect(() => {\n    if (showGrouping) setViewResourcesGrouping(showGrouping)\n    // NOTE: remove `show` dependency to let modal keep last state when re-opened with same arguments\n  }, [show, showGrouping])\n\n  // to update modal on open\n  useEffect(() => setSelectedResourceIDs(selectedResources), [selectedResources])\n\n  // sort resources\n  const sortedResources = resources\n    .filter((resource) => availableResources.includes(resource.id))\n    .toSorted(SORT_FNS[viewResourcesSorting])\n\n  // languages for resource infos (title/description/institution)\n  const resourceInfoLanguages = sortedResources\n    .map((resource) => getLanguagesFromResourceInfo(resource))\n    .flat()\n  const resourceInfoLanguagesGrouped = resourceInfoLanguages.reduce(\n    (acc, cur) => acc.set(cur, (acc.get(cur) ?? 0) + 1),\n    new Map()\n  )\n\n  const {\n    resources: filteredResources,\n    matches: filteredResourcesHighlights,\n    scores: filteredResourceScores,\n  } = useFuzzySearchListWithHierarchy(filter, sortedResources, locale)\n\n  // TODO: memo required or simply compute as is?\n  // compute sorting of groups\n  const groupScore = useMemo(() => {\n    const groupScore: Map<string, number> = new Map()\n    if (viewResourcesGrouping === 'institution') {\n      Object.entries(resourcesGroupedByInstitute).forEach(([institute, resources]) => {\n        groupScore.set(\n          institute,\n          resources.resources.reduce((score, resource) => {\n            const rScore = filteredResourceScores.get(resource.id)\n            if (rScore === undefined) return score\n            if (score === undefined) return rScore\n            return score < rScore ? score : rScore\n          }, undefined as unknown as number)\n        )\n      })\n    } else if (viewResourcesGrouping === 'language') {\n      Object.entries(resourcesGroupedByLanguage).forEach(([institute, resources]) => {\n        groupScore.set(\n          institute,\n          resources.resources.reduce((score, resource) => {\n            const rScore = filteredResourceScores.get(resource.id)\n            if (rScore === undefined) return score\n            if (score === undefined) return rScore\n            return score < rScore ? score : rScore\n          }, undefined as unknown as number)\n        )\n      })\n    }\n    return groupScore\n  }, [\n    viewResourcesGrouping,\n    filteredResourceScores,\n    resourcesGroupedByInstitute,\n    resourcesGroupedByLanguage,\n  ])\n\n  // TODO: memo with state required?\n  useMemo(() => {\n    console.debug('recompute groupings')\n\n    const instituteToResourcesMap: ResourcesGroupedByKeyMap = {}\n    const instituteToLanguagesMap: ResourcesGroupedByKeyMap = {}\n    // resources.recurse((resource: Resource) => {}) // TODO: subresources with different grouping-key than parent?\n    resources.forEach((resource: Resource) => {\n      const institution =\n        getBestFromMultilingualValuesTryByLanguage(resource.institution, locale) ?? ''\n      if (!Object.getOwnPropertyNames(instituteToResourcesMap).includes(institution)) {\n        instituteToResourcesMap[institution] = {\n          // expanded: resourcesGroupedByInstitute?.[institution]?.expanded ?? true,\n          expanded: true,\n          resources: [],\n        }\n      }\n      instituteToResourcesMap[institution].resources.push(resource)\n\n      resource.languages.forEach((language: string) => {\n        if (!Object.getOwnPropertyNames(instituteToLanguagesMap).includes(language)) {\n          instituteToLanguagesMap[language] = {\n            // expanded: resourcesGroupedByLanguage?.[language]?.expanded ?? true,\n            expanded: true,\n            resources: [],\n          }\n        }\n        instituteToLanguagesMap[language].resources.push(resource)\n\n        // TODO: handle children with different language than parent?\n      })\n    })\n\n    setResourcesGroupedByInstitute(instituteToResourcesMap)\n    setResourcesGroupedByLanguage(instituteToLanguagesMap)\n  }, [resources, locale])\n\n  // --------------------------------------------------------------\n\n  if (!resources) return null\n\n  // --------------------------------------------------------------\n\n  const resourcesInfo = {\n    total: getResourceIDs(resources).length, // how many resources from API\n    totalRoot: resources.length, // how many resources from API (root only)\n    available: availableResources.length, // how many selectable due to other filters\n    selected: selectedResourceIDs.length, // how many selected\n    visible: getResourceIDs(filteredResources.map((resource) => resource)).length, // how many visible (due to fuzzy filtering)\n    visibleRoot: filteredResources.length, // how many visible (due to fuzzy filtering), root only\n  }\n\n  // --------------------------------------------------------------\n  // helper\n\n  function languageCodeToName(code: string) {\n    return languageCodeToNameHelper(code, languages, {\n      defaultAnyLanguage: t('languageCodeToName.any', { ns: 'common' }),\n      defaultUnknownLanguage: t('languageCodeToName.unknown', { ns: 'common' }),\n    })\n  }\n\n  function changeSelectedResourceIDs(resourceIDs: string[], isSelected: boolean) {\n    const nextResourceIDs = selectedResourceIDs.filter((rid) => !resourceIDs.includes(rid))\n    if (isSelected) {\n      setSelectedResourceIDs([...nextResourceIDs, ...resourceIDs])\n    } else {\n      setSelectedResourceIDs(nextResourceIDs)\n    }\n  }\n\n  // --------------------------------------------------------------\n  // event handlers\n\n  function handleClose(action: string) {\n    onModalClose({\n      resourceIDs: selectedResourceIDs,\n      action: action,\n    })\n  }\n\n  function handleViewOptionsVisibilityChange(event: React.ChangeEvent<HTMLSelectElement>) {\n    // console.debug('visibility#onchange', viewResourcesVisibility, '=>', event.target.value)\n    setViewResourcesVisibility(event.target.value as ResourceSelectionModalViewOptionVisibility)\n  }\n\n  function handleViewOptionsGroupingChange(event: React.ChangeEvent<HTMLSelectElement>) {\n    // console.debug('grouping#onchange', viewResourcesGrouping, '=>', event.target.value)\n    setViewResourcesGrouping(event.target.value as ResourceSelectionModalViewOptionGrouping)\n  }\n\n  function handleViewOptionsSortingChange(event: React.ChangeEvent<HTMLSelectElement>) {\n    // console.debug('sorting#onchange', viewResourcesSorting, '=>', event.target.value)\n    setViewResourcesSorting(event.target.value as ResourceSelectionModalViewOptionSorting)\n  }\n\n  function handleSelectAllClick() {\n    // select all available resources\n    setSelectedResourceIDs(availableResources)\n  }\n\n  function handleDeselectAllClick() {\n    // deselect all resources\n    setSelectedResourceIDs([])\n  }\n\n  function handleSelectVisibleClick() {\n    // select only visible resources (i.e. resources left after fuzzy filtering)\n    setSelectedResourceIDs(filteredResources.map((resource) => resource.id))\n  }\n\n  function handleResourceOnSelectClick(resource: Resource, selected: boolean) {\n    changeSelectedResourceIDs(getResourceIDs([resource]), selected)\n  }\n\n  function handleGroupedResourcesOnSelectAllClick(resourcesInGroup: Resource[]) {\n    changeSelectedResourceIDs(getResourceIDs(resourcesInGroup), true)\n  }\n\n  function handleGroupedResourcesOnDeselectAllClick(resourcesInGroup: Resource[]) {\n    changeSelectedResourceIDs(getResourceIDs(resourcesInGroup), false)\n  }\n\n  // --------------------------------------------------------------\n  // rendering\n\n  function shouldResourceBeShown(resource: Resource) {\n    // invisibile resources should not be shown\n    if (!availableResources.includes(resource.id)) return false\n\n    // check view mode\n    if (viewResourcesVisibility === 'selected') {\n      // hide all not-selected resources\n      if (\n        // resource self is not selected\n        !selectedResourceIDs.includes(resource.id) &&\n        // AND none of its children are selected\n        !isResourceAvailableDueToSubResource(resource, (subResource: Resource) =>\n          selectedResourceIDs.includes(subResource.id)\n        )\n      ) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  function renderResources() {\n    if (viewResourcesGrouping === 'institution') {\n      return Object.entries(resourcesGroupedByInstitute)\n        .toSorted(([a], [b]) => {\n          const aScore = groupScore.get(a)\n          const bScore = groupScore.get(b)\n          if (aScore === bScore) return 0\n          if (aScore === undefined) return 1\n          if (bScore === undefined) return -1\n          return aScore - bScore\n        })\n        .map(\n          ([institution, { expanded, resources }]: [\n            string,\n            { expanded: boolean; resources: Resource[] }\n          ]) => (\n            <GroupedResources\n              title={\n                <>\n                  <i dangerouslySetInnerHTML={{ __html: bankIcon }} /> {institution}\n                </>\n              }\n              titleId={institution}\n              resources={resources}\n              selectedResourceIDs={selectedResourceIDs}\n              resourceScores={filteredResourceScores}\n              highlightings={filteredResourcesHighlights}\n              expanded={expanded}\n              shouldBeShown={shouldResourceBeShown}\n              onSelectAllClick={handleGroupedResourcesOnSelectAllClick}\n              onExpandToggleClick={(expanded) => {\n                console.debug('expanded', expanded, institution)\n                setResourcesGroupedByInstitute({\n                  ...resourcesGroupedByInstitute,\n                  [institution]: {\n                    ...resourcesGroupedByInstitute[institution],\n                    expanded: expanded,\n                  },\n                })\n              }}\n              onDeselectAllClick={handleGroupedResourcesOnDeselectAllClick}\n              onSelectClick={handleResourceOnSelectClick}\n              languageCodeToName={languageCodeToName}\n              localeForInfos={locale}\n              key={institution}\n            />\n          )\n        )\n    }\n    if (viewResourcesGrouping === 'language') {\n      return Object.entries(resourcesGroupedByLanguage)\n        .toSorted(([a], [b]) => {\n          const aScore = groupScore.get(a)\n          const bScore = groupScore.get(b)\n          if (aScore === bScore) return 0\n          if (aScore === undefined) return 1\n          if (bScore === undefined) return -1\n          return aScore - bScore\n        })\n        .map(\n          ([language, { expanded, resources }]: [\n            string,\n            { expanded: boolean; resources: Resource[] }\n          ]) => (\n            <GroupedResources\n              title={\n                <>\n                  <i dangerouslySetInnerHTML={{ __html: translateIcon }} />{' '}\n                  {languageCodeToName(language)} [{language}]\n                </>\n              }\n              titleId={language}\n              resources={resources}\n              selectedResourceIDs={selectedResourceIDs}\n              resourceScores={filteredResourceScores}\n              highlightings={filteredResourcesHighlights}\n              expanded={expanded}\n              shouldBeShown={shouldResourceBeShown}\n              onSelectAllClick={handleGroupedResourcesOnSelectAllClick}\n              onExpandToggleClick={(expanded) =>\n                (resourcesGroupedByLanguage[language].expanded = expanded)\n              }\n              onDeselectAllClick={handleGroupedResourcesOnDeselectAllClick}\n              onSelectClick={handleResourceOnSelectClick}\n              languageCodeToName={languageCodeToName}\n              localeForInfos={locale}\n              key={language}\n            />\n          )\n        )\n    }\n    return filteredResources\n      .filter((resource) => !resource.rootResourceId)\n      .map((resource) => (\n        <ResourceSelector\n          resource={resource}\n          selectedResourceIDs={selectedResourceIDs}\n          highlighting={filteredResourcesHighlights.get(resource.id)}\n          highlightings={filteredResourcesHighlights}\n          shouldBeShown={shouldResourceBeShown}\n          onSelectClick={handleResourceOnSelectClick}\n          languageCodeToName={languageCodeToName}\n          localeForInfos={locale}\n          key={resource.id}\n        />\n      ))\n  }\n\n  return (\n    <Modal\n      id=\"resource-selection-modal\"\n      show={show}\n      onHide={() => handleClose('close')}\n      size=\"xl\"\n      fullscreen=\"xl-down\"\n      centered\n    >\n      <Modal.Header closeButton>\n        <Modal.Title>{t('search.resourcesModal.title')}</Modal.Title>\n      </Modal.Header>\n      <Modal.Body className=\"px-0\">\n        {/* resource viewing options */}\n        <Form className=\"px-3 pb-3 border-bottom\" onSubmit={(event) => event.preventDefault()}>\n          <Container>\n            <Row className=\"d-sm-flex row-gap-2 justify-content-around\">\n              <Col md={2} sm={6}>\n                <FloatingLabel label=\"View\" controlId=\"resource-view-options-visibility\">\n                  <Form.Select\n                    value={viewResourcesVisibility}\n                    onChange={handleViewOptionsVisibilityChange}\n                  >\n                    <option value=\"all\">All</option>\n                    <option value=\"selected\">Selected only</option>\n                  </Form.Select>\n                </FloatingLabel>\n              </Col>\n              <Col md={2} sm={6}>\n                <FloatingLabel label=\"Group by\" controlId=\"resource-view-options-grouping\">\n                  <Form.Select\n                    value={viewResourcesGrouping}\n                    onChange={handleViewOptionsGroupingChange}\n                  >\n                    <option value=\"resource\">(Resource)</option>\n                    <option value=\"institution\">Institution</option>\n                    <option value=\"language\">Language</option>\n                  </Form.Select>\n                </FloatingLabel>\n              </Col>\n              <Col md={2} sm={6}>\n                <FloatingLabel label=\"Sort by\" controlId=\"resource-view-options-sorting\">\n                  <Form.Select\n                    value={viewResourcesSorting}\n                    onChange={handleViewOptionsSortingChange}\n                    disabled={viewResourcesGrouping !== 'resource' || filter.trim() !== ''}\n                  >\n                    <option value=\"title-up\">Title (up)</option>\n                    <option value=\"title-down\">Title (down)</option>\n                    <option value=\"institution-up\">Institution (up)</option>\n                    <option value=\"institution-down\">Institution (down)</option>\n                  </Form.Select>\n                </FloatingLabel>\n              </Col>\n              <Col md={3} sm={12}>\n                <FloatingLabel\n                  label=\"Resource filter query\"\n                  controlId=\"resource-view-options-filter\"\n                >\n                  <DebouncedFuzzySearchInput\n                    value={filter}\n                    onChange={(value) => setFilter(value)}\n                  />\n                </FloatingLabel>\n              </Col>\n              <Col\n                md={3}\n                sm={12}\n                className=\"gap-1 d-inline-flex column-gap-2 justify-content-evenly\"\n              >\n                <Button onClick={handleSelectAllClick}>Select all</Button>\n                <Button\n                  onClick={handleSelectVisibleClick}\n                  disabled={viewResourcesVisibility !== 'all' || filter.trim() === ''}\n                >\n                  Select visible\n                </Button>\n                <Button onClick={handleDeselectAllClick}>Deselect all</Button>\n              </Col>\n            </Row>\n            {resourceInfoLanguagesGrouped.size > 1 && (\n              <Form.Group as={Row} controlId=\"resource-info-language\" className=\"mt-2\">\n                <Form.Label column sm=\"auto\" style={{ fontSize: '0.875rem' }}>\n                  {t('search.resourcesModal.labelChangeResourceInfoLanguage')}\n                </Form.Label>\n                <Col sm=\"auto\">\n                  <ToggleButtonGroup\n                    type=\"radio\"\n                    name=\"resource-info-languages\"\n                    defaultValue={locale}\n                    onChange={(language) => setLocale(language)}\n                  >\n                    {Array.from(resourceInfoLanguagesGrouped.entries())\n                      .toSorted()\n                      .map(([language, amount]) => (\n                        <ToggleButton\n                          size=\"sm\"\n                          key={language}\n                          id={`resource-info-languages-${language}`}\n                          value={language}\n                          variant=\"secondary\"\n                          title={t('search.resourcesModal.buttonChangeResourceInfoLanguageTitle', {\n                            count: amount,\n                            language,\n                            languageName: langNames.of(language),\n                          })}\n                        >\n                          {langNames.of(language)} <sup>{language}</sup>\n                        </ToggleButton>\n                      ))}\n                  </ToggleButtonGroup>\n                </Col>\n              </Form.Group>\n            )}\n          </Container>\n        </Form>\n        {/* info */}\n        <p className=\"m-4 mb-0\">\n          {t('search.resourcesModal.msgResourcesSelected', {\n            count: resourcesInfo.selected,\n            total: resourcesInfo.visible,\n            available: resourcesInfo.available,\n            context: resourcesInfo.available !== resourcesInfo.visible ? 'available' : null,\n          })}\n        </p>\n        {/* resources */}\n        <Container className=\"px-3 pt-3\">{renderResources()}</Container>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"primary\" onClick={() => handleClose('confirm')}>\n          {t('search.resourcesModal.buttonConfirm')}\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  )\n}\n\nexport default ResourceSelectionModal\n","import { useState } from 'react'\n\n// export default function useToggleOnce<T>(\n//   value: T | (() => T)\n// ): [T, React.Dispatch<React.SetStateAction<T>>] {\n//   const [state, setState] = useState(value)\n\n//   const toggleOnce: React.Dispatch<React.SetStateAction<T>> = (value: React.SetStateAction<T>) => {\n//     // use state/ref to check if triggered / or even a local var?\n//     setState(value)\n//   }\n//   return [state, toggleOnce]\n// }\n\nexport default function useFlipOnceTrue(): [boolean, () => void] {\n  const [state, setState] = useState(false)\n\n  const flipOnce = () => {\n    if (state !== true) setState(true)\n  }\n  return [state, flipOnce]\n}\n","import { useCallback, useMemo } from 'react'\nimport type { SetURLSearchParams, URLSearchParamsInit } from 'react-router'\nimport { createSearchParams, useLocation, useNavigate } from 'react-router'\n\nexport default function useSearchParamsFromHash(): [URLSearchParams, SetURLSearchParams] {\n  const routerNavigate = useNavigate()\n  const { hash } = useLocation()\n\n  const searchParams = useMemo(() => {\n    return new URLSearchParams(hash.substring(1))\n  }, [hash])\n\n  const setSearchParams = useCallback(\n    (nextInit?: URLSearchParamsInit | ((prev: URLSearchParams) => URLSearchParamsInit)) => {\n      const newSearchParams = createSearchParams(\n        typeof nextInit === 'function' ? nextInit(new URLSearchParams(searchParams)) : nextInit\n      )\n      const newHash = !newSearchParams.entries().next().done ? `#${newSearchParams}` : ''\n\n      if (hash !== newHash) {\n        routerNavigate({ hash: newHash })\n      }\n    },\n    [searchParams, hash, routerNavigate]\n  )\n  return [searchParams, setSearchParams]\n}\n","import type { AxiosInstance } from 'axios'\nimport React, { lazy, Suspense, useCallback, useEffect, useState } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport Form from 'react-bootstrap/Form'\nimport InputGroup from 'react-bootstrap/InputGroup'\nimport ToggleButton from 'react-bootstrap/ToggleButton'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { useSearchParams } from 'react-router'\n\nimport ContentEditable from '@/components/ContentEditable'\nimport type { LanguageModelCloseActions } from '@/components/LanguageModal'\nimport LanguageModal from '@/components/LanguageModal'\nimport QuerySuggestionsModal from '@/components/QuerySuggestionsModal'\nimport ResourceSelectionModal from '@/components/ResourceSelectionModal'\nimport useFlipOnceTrue from '@/hooks/useFlipOnceTrue'\nimport useSearchParamsFromHash from '@/hooks/useSearchParamsFromHash'\nimport type { Resource } from '@/utils/api'\nimport type { NumberOfResults, QueryTypeID, QueryTypeIDForQueryBuilder } from '@/utils/constants'\nimport {\n  DEFAULT_QUERY_TYPE,\n  NUMBER_OF_RESULTS,\n  QUERY_TYPE_MAP,\n  QUERY_TYPES,\n  QUERY_TYPES_WITH_BUILDER_SUPPORT,\n} from '@/utils/constants'\nimport { getAvailableResourceIDs, getInstitutions } from '@/utils/resources'\nimport type {\n  LanguageCode2NameMap,\n  LanguageFilterOptions,\n  ResourceSelectionModalViewOptionGrouping,\n} from '@/utils/search'\nimport {\n  DEFAULT_RESOURCE_VIEW_GROUPING,\n  DEFAULT_SEARCH_LANGUAGE_FILTER,\n  languageCodeToName,\n  MULTIPLE_LANGUAGE_CODE,\n} from '@/utils/search'\nimport type { ToastMessage } from './utils'\n\n// SVG, for inverted/specific colors: https://stackoverflow.com/a/52041765/9360161\nimport balloonIcon from 'bootstrap-icons/icons/balloon.svg?raw'\nimport gearIcon from 'bootstrap-icons/icons/gear-fill.svg?raw'\nimport highlightsIcon from 'bootstrap-icons/icons/highlights.svg?raw'\nimport magicIcon from 'bootstrap-icons/icons/magic.svg?raw'\nimport searchIcon from 'bootstrap-icons/icons/search.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// lazy components\n\nconst QueryBuilderModal = /*#__PURE__*/ lazy(() => import('@/components/QueryBuilder'))\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface SearchProps {\n  axios: AxiosInstance\n}\n\nexport interface SearchInputProps {\n  resources: Resource[]\n  availableResources: string[] | null\n  selectedResources: string[] | null\n  languages?: LanguageCode2NameMap\n  onSearch: (searchData: SearchData) => void\n  onShowToast?: (toast: ToastMessage) => void\n  hasSearch: boolean\n  disabled?: boolean\n}\n\nexport interface SearchData {\n  language: string\n  languageFilter: LanguageFilterOptions\n  queryType: QueryTypeID\n  query: string\n  resourceIDs: string[]\n  numberOfResults: NumberOfResults\n}\n\nexport interface queryError {\n  msg: string\n  details: unknown\n}\n\n// --------------------------------------------------------------------------\n\nfunction getQueryFromSearchParams(params: URLSearchParams, fallback: string = '') {\n  const newQuery = params.get('query')\n  if (newQuery) {\n    return newQuery\n  }\n  return fallback\n}\n\nfunction getQueryTypeFromSearchParams(params: URLSearchParams, fallback: QueryTypeID = 'cql') {\n  const newQueryType = params.get('queryType')\n  if (newQueryType) {\n    if (QUERY_TYPES.find((qt) => qt.id === newQueryType) !== undefined) {\n      return newQueryType as QueryTypeID\n    }\n    console.warn('Found unsupported queryType in search params', newQueryType)\n  }\n  return fallback\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction SearchInput({\n  resources,\n  languages,\n  onSearch,\n  onShowToast,\n  availableResources: availableResourcesProps = null,\n  selectedResources: selectedResourcesProps = null,\n  hasSearch = false,\n  disabled = false,\n}: SearchInputProps) {\n  const { t } = useTranslation()\n  const [searchParams, setSearchParams] = useSearchParams()\n  const [hashSearchParams, setHashSearchParams] = useSearchParamsFromHash()\n\n  // input modals (trigger)\n  const [showResourceSelectionModal, setShowResourceSelectionModal] = useState(false)\n  const [showResourceSelectionModalGrouping, setShowResourceSelectionModalGrouping] =\n    useState<ResourceSelectionModalViewOptionGrouping>(DEFAULT_RESOURCE_VIEW_GROUPING)\n  const [showLanguageSelectionModal, setShowLanguageSelectionModal] = useState(false)\n  const [showQuerySuggestionsModal, setShowQuerySuggestionsModal] = useState(false)\n  const [showQueryBuilderModal, setShowQueryBuilderModal] = useState(false)\n  const [isLoadQueryBuilderModalTriggered, triggerLoadQueryBuilderModal] = useFlipOnceTrue()\n\n  // user search input states\n  const [language, setLanguage] = useState(MULTIPLE_LANGUAGE_CODE)\n  const [languageFilter, setLanguageFilter] = useState<LanguageFilterOptions>(\n    DEFAULT_SEARCH_LANGUAGE_FILTER\n  )\n\n  const [queryType, setQueryType] = useState<QueryTypeID>(\n    getQueryTypeFromSearchParams(searchParams, DEFAULT_QUERY_TYPE)\n  )\n\n  // resource IDs the user can select (based on pre-filtering and search language selection)\n  const [validResourceIDs, setValidResourceIDs] = useState<string[]>(availableResourcesProps ?? [])\n  // selected resource IDs for search\n  const [selectedResourceIDs, setSelectedResourceIDs] = useState<string[]>(\n    selectedResourcesProps ?? []\n  )\n\n  const [numberOfResults, setNumberOfResults] = useState<NumberOfResults>(NUMBER_OF_RESULTS[0])\n\n  const [query, setQuery] = useState(getQueryFromSearchParams(searchParams, ''))\n  // query input validation\n  const [queryError] = useState<queryError | null>(null)\n\n  // query input syntax highlighting\n  const [queryInputEnhanced, setQueryInputEnhanced] = useState(false)\n\n  // ------------------------------------------------------------------------\n  // data updates/computation\n\n  // to update modal on open\n  useEffect(() => {\n    setSelectedResourceIDs(selectedResourcesProps ?? [])\n  }, [selectedResourcesProps])\n\n  const resetResourceSelection = useCallback(\n    () => setSelectedResourceIDs(getAvailableResourceIDs(resources, 'cql', MULTIPLE_LANGUAGE_CODE)),\n    [resources]\n  )\n\n  const getAvailableResourceIDsCallback = useCallback(\n    (resources: Resource[]) => {\n      const availableResourceIDs = getAvailableResourceIDs(\n        resources,\n        queryType,\n        languageFilter === 'byGuess' ? MULTIPLE_LANGUAGE_CODE : language\n      )\n      if (availableResourcesProps && availableResourcesProps.length > 0) {\n        // if updated from outside via props (e.g. restriction)\n        // TODO: needs testing\n        return availableResourceIDs.filter((rid) => availableResourcesProps.includes(rid))\n      }\n      return availableResourceIDs\n    },\n    [queryType, language, languageFilter, availableResourcesProps]\n  )\n\n  useEffect(() => {\n    const availableResourceIDs = getAvailableResourceIDsCallback(resources)\n    console.debug(\n      'Update resource availability',\n      // { queryType, language, languageFilter },\n      availableResourceIDs\n    )\n    // TODO: evaluate xAggregationContext\n    setValidResourceIDs(availableResourceIDs)\n\n    // TODO: handle case where availableResourceIDs is empty on init? (maybe due to props usage)\n    // setSelectedResourceIDs((resourceIDs) =>\n    //   resourceIDs === null\n    //     ? // initialization, if `null` then check available resources\n    //       availableResourceIDs.length > 0\n    //       ? // only update when we have available resources\n    //         availableResourceIDs\n    //       : // otherwise keep `null` to \"delay\" init for full default selection\n    //         null\n    //     : // incremental update\n    //       resourceIDs.filter((id) => availableResourceIDs.includes(id))\n    // )\n    // we update from outside (Search.tsx#useEffect#data)\n    setSelectedResourceIDs((resourceIDs) =>\n      resourceIDs.filter((id) => availableResourceIDs.includes(id))\n    )\n  }, [resources, getAvailableResourceIDsCallback])\n\n  // ------------------------------------------------------------------------\n\n  const doSearch = useCallback(() => {\n    const searchParams = {\n      language: language,\n      languageFilter: languageFilter,\n      queryType: queryType,\n      query: query,\n      resourceIDs: selectedResourceIDs ?? [],\n      numberOfResults: numberOfResults,\n    }\n    console.debug('search for', searchParams)\n\n    // validate and cancel if necessary\n    if (searchParams.query === '') return\n    if (searchParams.resourceIDs.length === 0) return\n\n    // TODO: query validation\n    // setQueryError({ msg: 'something went wrong (sad face emoji)', details: {} })\n\n    onSearch(searchParams)\n  }, [language, languageFilter, numberOfResults, onSearch, query, queryType, selectedResourceIDs])\n\n  useEffect(() => {\n    console.debug('searchParams', searchParams)\n\n    if (searchParams) {\n      setQuery((query) => getQueryFromSearchParams(searchParams, query))\n      setQueryType((queryType) => getQueryTypeFromSearchParams(searchParams, queryType))\n\n      const aggregationContext = searchParams.get('x-aggregation-context')\n      if (!aggregationContext) {\n        // wait until the aggregation context parameter has been evaluated (in another/parent component) (and then removed to trigger a reevaluation here)\n        // and only then trigger possible automatic search if requested\n        // this will (hopefully delay long enough to pre-select resources first before starting a search)\n        const mode = searchParams.get('mode')\n        if (mode) {\n          if (mode === 'search') {\n            console.log('Trigger search due to URL parameter!')\n            doSearch()\n          }\n          // setSearchParams((params) => (params.delete('mode'), params))\n          searchParams.delete('mode')\n          setSearchParams(searchParams)\n        }\n      }\n    }\n  }, [searchParams, setSearchParams, doSearch])\n\n  // update URL with query params\n  useEffect(() => {\n    if (searchParams.get('query') === query) return\n    // setSearchParams((params) => (params.set('query', query), params))\n    searchParams.set('query', query)\n    setSearchParams(searchParams)\n  }, [query, searchParams, setSearchParams])\n  useEffect(() => {\n    if (searchParams.get('queryType') === queryType) return\n    // setSearchParams((params) => (params.set('queryType', queryType), params))\n    searchParams.set('queryType', queryType)\n    setSearchParams(searchParams)\n  }, [queryType, searchParams, setSearchParams])\n\n  // some triggers for UI elements\n  useEffect(() => {\n    console.debug('hashSearchParams', hashSearchParams)\n\n    if (import.meta.env.FEATURE_QUERY_BUILDER) {\n      if (hashSearchParams.has('openQueryBuilder')) {\n        console.debug(\"Trigger Query Builder open due to 'openQueryBuilder' search param\")\n        triggerLoadQueryBuilderModal()\n        setShowQueryBuilderModal(true)\n\n        hashSearchParams.delete('openQueryBuilder')\n        setHashSearchParams(hashSearchParams)\n      }\n    }\n  }, [hashSearchParams, setHashSearchParams, triggerLoadQueryBuilderModal])\n\n  // ------------------------------------------------------------------------\n\n  const numberOfSelectedInstitutions = getInstitutions(resources, selectedResourceIDs ?? []).length\n\n  const hasResourcesForQueryFCS =\n    resources.find((resource) =>\n      resource.searchCapabilitiesResolved.includes('ADVANCED_SEARCH')\n    ) !== undefined\n  const hasResourcesForQueryLex =\n    resources.find((resource) => resource.searchCapabilitiesResolved.includes('LEX_SEARCH')) !==\n    undefined\n\n  const showQueryBuilderButton = QUERY_TYPES_WITH_BUILDER_SUPPORT.includes(\n    queryType as QueryTypeIDForQueryBuilder\n  )\n\n  // ------------------------------------------------------------------------\n  // event handlers\n\n  function handleChangeQueryType(eventKey: string | null) {\n    if (!eventKey) return\n\n    const newQueryType = eventKey as QueryTypeID\n\n    // process user inputs\n    const hasQueryTypeChanged = newQueryType !== queryType\n    if (hasQueryTypeChanged) {\n      // reset resource selection as it automatically changes due to options\n      console.debug('handleChangeQueryType', 'reset resource selection')\n      resetResourceSelection()\n    }\n    setQueryType(newQueryType)\n  }\n\n  function handleChangeNumberOfResults(event: React.ChangeEvent<HTMLSelectElement>) {\n    let value = Number.parseInt(event.target.value)\n    // input validation\n    if (value < 10) value = 10\n    if (value > 250) value = 250\n    if (!(NUMBER_OF_RESULTS as unknown as number[]).includes(value)) {\n      console.warn('Invalid number of results?!', { valid: NUMBER_OF_RESULTS, value })\n    }\n    setNumberOfResults(value as NumberOfResults)\n  }\n\n  function handleChangeLanguageSelection({\n    language: newLanguage,\n    filter: newLanguageFilter,\n    action,\n  }: {\n    language: string\n    filter: LanguageFilterOptions\n    action: LanguageModelCloseActions\n  }) {\n    console.debug('handleChangeLanguageSelection', {\n      language: newLanguage,\n      filter: newLanguageFilter,\n      action,\n    })\n    // first close the modal\n    setShowLanguageSelectionModal(false)\n    // if 'abort' do nothing\n    if (action === 'abort') return\n\n    // process user inputs\n    const hasLanguageChanged = newLanguage !== language || newLanguageFilter !== languageFilter\n    if (hasLanguageChanged) {\n      // reset resource selection as it automatically changes due to options\n      console.debug('handleChangeLanguageSelection', 'reset resource selection')\n      resetResourceSelection()\n    }\n    setLanguage(newLanguage)\n    setLanguageFilter(newLanguageFilter)\n  }\n\n  function handleChangeResourceSelection({\n    resourceIDs,\n    action,\n  }: {\n    resourceIDs: string[]\n    action: string\n  }) {\n    console.debug('onModalClose', { resourceIDs, action })\n    // first close the modal\n    setShowResourceSelectionModal(false)\n    // if 'abort' do nothing\n    if (action === 'abort') return\n    // process user inputs\n\n    const hasSelectionChanged = resourceIDs.length !== selectedResourceIDs.length\n    console.debug('handleChangeResourceSelection', { hasSelectionChanged })\n\n    setSelectedResourceIDs(resourceIDs)\n  }\n\n  function handleChangeQuerySuggestion({\n    query: newQuery,\n    queryType: newQueryType,\n    resourceIDs: newResourceIDs,\n    action,\n  }: {\n    query?: string\n    queryType?: QueryTypeID\n    resourceIDs?: string[] | undefined\n    action: string\n  }) {\n    console.debug('handleChangeQuerySuggestion', {\n      query: newQuery,\n      queryType: newQueryType,\n      resourceIDs: newResourceIDs,\n      action,\n    })\n    // first close the modal\n    setShowQuerySuggestionsModal(false)\n    // if 'abort' do nothing\n    if (action === 'abort') return\n    // if 'close' (ESC / x button) then also do nothing\n    if (action === 'close') return\n    // if query/queryType is empty, do nothing\n    if (!newQuery || !newQueryType) return\n\n    // process user inputs\n    // check if suggested query has resource selection to use (and check if valid for query type/language selection)\n    const hasNewResourceSelection = newResourceIDs !== undefined && newResourceIDs.length > 0\n    let hasValidNewResourceSelection = hasNewResourceSelection\n    let newSelectedResourceIDs = newResourceIDs ?? []\n    if (hasNewResourceSelection) {\n      // check that the resources are valid\n      // TODO: do we need to reset the language? (in case the suggested resources are not available there?)\n      const availableResourceIDs = getAvailableResourceIDs(\n        resources,\n        newQueryType,\n        languageFilter === 'byGuess' ? MULTIPLE_LANGUAGE_CODE : language\n      )\n      newSelectedResourceIDs = newSelectedResourceIDs.filter((resourceID) =>\n        availableResourceIDs.includes(resourceID)\n      )\n      hasValidNewResourceSelection = newSelectedResourceIDs.length > 0\n    }\n    // update resource selection if required\n    const hasQueryTypeChanged = newQueryType !== queryType\n    if (hasQueryTypeChanged && !hasValidNewResourceSelection) {\n      // reset resource selection as it automatically changes due to options\n      console.debug('handleChangeQuerySuggestion', 'reset resource selection')\n      resetResourceSelection()\n    }\n    if (hasValidNewResourceSelection) {\n      // TODO: do we want to forcefully set the resource selection?\n      setSelectedResourceIDs(newSelectedResourceIDs)\n    } else if (hasNewResourceSelection) {\n      console.warn(\n        'Suggested query also had suggested resources but they do not fit the available resources (probably due to language filter)!',\n        { language, queryType: newQueryType, resourceIDs: newResourceIDs }\n      )\n    }\n    setQueryType(newQueryType)\n    setQuery(newQuery)\n  }\n\n  function handleChangeQueryBuilderQuery({\n    query,\n    validResources,\n    action,\n  }: {\n    query: string\n    validResources: string[]\n    action: string\n  }) {\n    console.debug('onModalClose', { query, validResources, action })\n    // first close the modal\n    setShowQueryBuilderModal(false)\n    // if 'abort' do nothing\n    if (action === 'abort') return\n    // if 'close' (ESC / x button) then also do nothing\n    if (action === 'close') return\n\n    // explicitely wait for confirm\n    // process user inputs\n    setQuery(query)\n\n    // show info to users\n    // TODO: make diff of selected queries?\n    // a bit basic but should be ok, resource selection is unlikely to increase\n    if (selectedResourceIDs.length !== validResources.length) {\n      onShowToast?.({\n        title: t('search.toasts.searchInput.title'),\n        body: (\n          <>\n            <p>{t('search.toasts.searchInput.msgResourcesChangedDueToQuery')}</p>\n            <p>\n              {t('search.toasts.searchInput.msgResourcesAmountChanged', {\n                before: selectedResourceIDs.length,\n                after: validResources.length,\n              })}\n            </p>\n            <hr />\n            <Button onClick={() => setSelectedResourceIDs(selectedResourceIDs)}>\n              {t('search.toasts.searchInput.buttonRevertSelection')}\n            </Button>\n          </>\n        ),\n        variant: 'info',\n        delay: 7_000,\n      })\n    }\n    // update selected queries\n    setSelectedResourceIDs(validResources)\n  }\n\n  function handleQueryChange(value: string) {\n    // TODO: maybe input validation / syntax highlighting etc.\n    setQuery(value)\n\n    // TODO: demo\n    // setQueryError(\n    //   value.length % 2 === 1\n    //     ? { msg: 'even number of characters', details: null }\n    //     : null\n    // )\n  }\n\n  function handleSearchSubmit(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault()\n    doSearch()\n  }\n\n  // ------------------------------------------------------------------------\n  // UI\n\n  function renderSelectedResourcesMsg() {\n    const selected = (selectedResourceIDs ?? []).length\n    const context =\n      resources.length === selected || validResourceIDs.length === selected ? 'all' : null\n    return t('search.searchInput.buttonSelectedResources', { count: selected, context })\n  }\n\n  return (\n    <search id=\"fcs-query\">\n      {/* search input form */}\n      <Form noValidate onSubmit={handleSearchSubmit}>\n        <InputGroup size={!hasSearch ? 'lg' : undefined} hasValidation>\n          <Button\n            variant=\"outline-secondary\"\n            type=\"button\"\n            id=\"fcs-search-query-suggestions-button\"\n            aria-label={t('search.searchInput.buttonOpenQuerySuggestions')}\n            onClick={() => setShowQuerySuggestionsModal(true)}\n          >\n            <i dangerouslySetInnerHTML={{ __html: balloonIcon }} aria-hidden=\"true\" />\n          </Button>\n          {/* @ts-expect-error: typing does not work for onChange handler, is correct so */}\n          <Form.Control\n            placeholder=\"Elephant\"\n            aria-label={t('search.searchInput.inputQueryAriaLabel')}\n            aria-describedby=\"fcs-search-input-button\"\n            className=\"text-center search-query-input\"\n            disabled={disabled}\n            aria-disabled={disabled}\n            value={query}\n            isInvalid={!!queryError} // TODO: add syntax validation for more complex queries\n            {...(queryInputEnhanced\n              ? {\n                  as: ContentEditable,\n                  queryType: queryType,\n                  onChange: handleQueryChange,\n                }\n              : {\n                  onChange: (event) => handleQueryChange(event.target.value),\n                })}\n          />\n          {import.meta.env.FEATURE_QUERY_BUILDER && showQueryBuilderButton && (\n            <Button\n              id=\"fcs-search-input-query-builder-button\"\n              variant=\"outline-secondary\"\n              aria-label={t('search.searchInput.buttonOpenQueryBuilderAriaLabel')}\n              className=\"border-end-0 d-none d-md-block\"\n              onClick={() => {\n                triggerLoadQueryBuilderModal()\n                setShowQueryBuilderModal(true)\n              }}\n            >\n              <i dangerouslySetInnerHTML={{ __html: magicIcon }} aria-hidden=\"true\" />\n            </Button>\n          )}\n          <ToggleButton\n            id=\"fcs-search-input-enhanced-button\"\n            value=\"enhance-query\" // just a dummy value\n            type=\"checkbox\"\n            checked={queryInputEnhanced}\n            onChange={() => setQueryInputEnhanced((isChecked) => !isChecked)}\n            variant=\"outline-secondary\"\n            aria-label={t('search.searchInput.buttonEnhanceQueryAriaLabel', {\n              context: queryInputEnhanced ? 'enabled' : 'disabled',\n            })}\n            className=\"d-flex align-items-center border-end-0\"\n          >\n            <i dangerouslySetInnerHTML={{ __html: highlightsIcon }} aria-hidden=\"true\" />\n          </ToggleButton>\n          <Button\n            variant=\"outline-primary\"\n            type=\"submit\"\n            id=\"fcs-search-input-button\"\n            disabled={disabled || query.trim().length === 0}\n            aria-disabled={disabled}\n            aria-label={t('search.searchInput.buttonSearchAriaLabel')}\n          >\n            {/* TODO: visually-hidden span with description? */}\n            <i\n              dangerouslySetInnerHTML={{ __html: searchIcon }}\n              aria-hidden=\"true\"\n              className=\"d-inline d-md-none\"\n            />\n            <span className=\"d-none d-md-inline\">{t('search.searchInput.buttonSearch')}</span>\n          </Button>\n          <Form.Control.Feedback type=\"invalid\">{queryError?.msg}</Form.Control.Feedback>\n        </InputGroup>\n        <div id=\"fcs-query-filters\" className=\"mt-2 mb-3 lh-lg text-center\">\n          <Trans\n            i18nKey=\"search.searchInput.filtersSummary\"\n            components={[\n              <Dropdown\n                className=\"d-inline-block\"\n                onSelect={handleChangeQueryType}\n                aria-disabled={disabled}\n                aria-label={t('search.searchInput.dropdownQueryTypeAriaLabel')}\n              >\n                <Dropdown.Toggle\n                  size=\"sm\"\n                  variant=\"outline-dark\"\n                  className=\"mx-1 pe-2 no-arrow\"\n                  disabled={disabled}\n                  aria-disabled={disabled}\n                  style={\n                    QUERY_TYPE_MAP[queryType]\n                      ? {\n                          '--color': QUERY_TYPE_MAP[queryType].color,\n                        }\n                      : {}\n                  }\n                >\n                  {t(`queryTypes.${queryType}.nameShort`, {\n                    ns: 'common',\n                    defaultValue: QUERY_TYPE_MAP[queryType]?.searchLabel ?? queryType.toUpperCase(),\n                  })}{' '}\n                  <i dangerouslySetInnerHTML={{ __html: gearIcon }} aria-hidden=\"true\" />\n                </Dropdown.Toggle>\n                <Dropdown.Menu>\n                  {QUERY_TYPES.filter(\n                    (info) =>\n                      info.id === 'cql' ||\n                      (info.id === 'fcs' && hasResourcesForQueryFCS) ||\n                      (info.id === 'lex' && hasResourcesForQueryLex)\n                  ).map((info) => (\n                    <Dropdown.Item\n                      as=\"button\"\n                      eventKey={info.id}\n                      key={info.id}\n                      onClick={(event) => event.preventDefault()}\n                      style={{\n                        '--color': info.color,\n                        background: 'color-mix(in srgb, var(--color) 50%, transparent)',\n                      }}\n                    >\n                      {t(`queryTypes.${info.id}.nameLong`, {\n                        ns: 'common',\n                        defaultValue: info.name,\n                      })}\n                    </Dropdown.Item>\n                  ))}\n                </Dropdown.Menu>\n              </Dropdown>,\n              <Button\n                size=\"sm\"\n                variant=\"outline-dark\"\n                className=\"mx-1 pe-2\"\n                disabled={disabled}\n                aria-disabled={disabled}\n                onClick={() => {\n                  setShowResourceSelectionModalGrouping('resource')\n                  setShowResourceSelectionModal(true)\n                }}\n              >\n                {renderSelectedResourcesMsg()}{' '}\n                <i dangerouslySetInnerHTML={{ __html: gearIcon }} aria-hidden=\"true\" />\n              </Button>,\n              <Button\n                size=\"sm\"\n                variant=\"outline-dark\"\n                className=\"mx-1 pe-2\"\n                disabled={disabled}\n                aria-disabled={disabled}\n                onClick={() => {\n                  setShowResourceSelectionModalGrouping('institution')\n                  setShowResourceSelectionModal(true)\n                }}\n              >\n                {t('search.searchInput.buttonSelectedInstitutions', {\n                  count: numberOfSelectedInstitutions,\n                })}{' '}\n                <i dangerouslySetInnerHTML={{ __html: gearIcon }} aria-hidden=\"true\" />\n              </Button>,\n              <Button\n                size=\"sm\"\n                variant=\"outline-dark\"\n                className=\"mx-1 pe-2\"\n                onClick={() => setShowLanguageSelectionModal(true)}\n                disabled={disabled}\n                aria-disabled={disabled}\n              >\n                {languageCodeToName(language, languages ?? {}, {\n                  defaultAnyLanguage: t('languageCodeToName.any', { ns: 'common' }),\n                  defaultUnknownLanguage: t('languageCodeToName.unknown', { ns: 'common' }),\n                })}{' '}\n                <i dangerouslySetInnerHTML={{ __html: gearIcon }} aria-hidden=\"true\" />\n              </Button>,\n              <Form.Select\n                size=\"sm\"\n                className=\"d-inline-block w-auto mx-1\"\n                onChange={handleChangeNumberOfResults}\n                value={numberOfResults}\n                aria-label={t('search.searchInput.selectNumberOfSearchResultsAriaLabel')}\n                disabled={disabled}\n                aria-disabled={disabled}\n              >\n                {NUMBER_OF_RESULTS.map((value) => (\n                  <option value={value} key={value}>\n                    {value}\n                  </option>\n                ))}\n              </Form.Select>,\n            ]}\n          />\n        </div>\n      </Form>\n\n      {/* search input modals */}\n      {showLanguageSelectionModal && (\n        <LanguageModal\n          languages={languages}\n          resources={resources}\n          searchLanguage={language}\n          show={showLanguageSelectionModal}\n          onModalClose={handleChangeLanguageSelection}\n        />\n      )}\n      {showResourceSelectionModal && (\n        <ResourceSelectionModal\n          resources={resources}\n          languages={languages}\n          availableResources={validResourceIDs}\n          selectedResources={selectedResourceIDs ?? []}\n          show={showResourceSelectionModal}\n          showGrouping={showResourceSelectionModalGrouping}\n          onModalClose={handleChangeResourceSelection}\n        />\n      )}\n      {/* query suggestions modal */}\n      {showQuerySuggestionsModal && (\n        <QuerySuggestionsModal\n          queryTypes={[queryType]} // TODO: or show all always?\n          show={showQuerySuggestionsModal}\n          onModalClose={handleChangeQuerySuggestion}\n        />\n      )}\n      {/* query builder modal */}\n      {import.meta.env.FEATURE_QUERY_BUILDER &&\n        QUERY_TYPES_WITH_BUILDER_SUPPORT.includes(queryType as QueryTypeIDForQueryBuilder) &&\n        isLoadQueryBuilderModalTriggered && (\n          // TODO: some fallback handling\n          // NOTE: that translation rsources might also be loading ...\n          <Suspense\n            fallback={\n              <>\n                {t('loading', {\n                  ns: 'querybuilder',\n                  defaultValue: t('generic.loadingComponent', { ns: 'common' }),\n                })}\n              </>\n            }\n          >\n            {showQueryBuilderModal && (\n              <QueryBuilderModal\n                query={query}\n                queryType={queryType as QueryTypeIDForQueryBuilder}\n                resources={resources}\n                selectedResources={selectedResourceIDs}\n                show={showQueryBuilderModal}\n                onModalClose={handleChangeQueryBuilderQuery}\n              />\n            )}\n          </Suspense>\n        )}\n    </search>\n  )\n}\n\nexport default SearchInput\n","import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query'\nimport { useState } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Spinner from 'react-bootstrap/Spinner'\nimport { useTranslation } from 'react-i18next'\n\nimport type { ResourceSearchResultMetaOnly } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport {\n  getSearchResultsMetaOnlyForResource,\n  postSearchMoreResults,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport { useAxios } from '@/providers/AxiosContext'\n// import { useSearchParams } from '@/providers/SearchParamsContext'\n// import { trackSiteSearch } from '@/utils/matomo'\n\nimport threeDotsIcon from 'bootstrap-icons/icons/three-dots.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface LoadMoreResultsButtonProps {\n  searchId: string\n  resourceId: string\n  numberOfResults: number\n  pollDelay?: number\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction LoadMoreResultsButton({\n  searchId,\n  resourceId,\n  numberOfResults,\n  pollDelay = 1500,\n}: LoadMoreResultsButtonProps) {\n  const { t } = useTranslation()\n  const axios = useAxios()\n  const queryClient = useQueryClient()\n\n  const [isPolling, setIsPolling] = useState(false)\n\n  // request more results for one resource\n  const {\n    isPending: isPendingRequesting,\n    mutate,\n    reset,\n  } = useMutation({\n    mutationFn: postSearchMoreResults.bind(null, axios, searchId, { resourceId, numberOfResults }),\n    mutationKey: ['search-result-load-more', searchId, resourceId],\n    onSuccess: async (data) => {\n      // console.debug('[onSuccess]', { searchId, resourceId }, { data, variables, context })\n\n      // console.debug('request more results', { isPolling, searchId, resourceId, searchIdNewButSame: data, isPendingRequesting, isErrorRequesting })\n      if (data !== undefined && searchId !== data) {\n        console.warn('SearchIDs should be the same?!', {\n          searchId,\n          searchIdNewButSame: data,\n          resourceId,\n        })\n      }\n\n      // polling (we do here ourselves)\n      // TODO: unsure about removeQueries / resetQueries, required to completely clear state\n      await queryClient.invalidateQueries({ queryKey: ['search-results', searchId, resourceId] })\n      setIsPolling(true)\n    },\n  })\n\n  // poll for data ready\n  pollDelay ??= 1500\n  const {\n    data: dataPolling,\n    isLoading: isLoadingPolling,\n    isFetching: isFetchingPolling,\n  } = useQuery<ResourceSearchResultMetaOnly>({\n    queryKey: ['search-results', searchId, resourceId],\n    queryFn: getSearchResultsMetaOnlyForResource.bind(null, axios, searchId, resourceId),\n    enabled: isPolling,\n    refetchInterval(query) {\n      // console.debug('[refetchInterval]', { searchId, resourceId, query })\n      if (query.state.data && query.state.data.inProgress) return pollDelay\n      return false\n    },\n  })\n  // console.debug('polling for more results finished?', { dataPolling, isLoadingPolling, isErrorPolling, searchId, resourceId })\n\n  const isLoading = isPendingRequesting || isLoadingPolling || isFetchingPolling\n  const isFinished = !!dataPolling && !dataPolling.inProgress\n  const showSpinner = isLoading || isPolling\n\n  // console.debug('before render', { isPolling, isLoading, isFinished, searchId, resourceId })\n  if (isPolling && isFinished) {\n    if (isPolling) {\n      // disable polling, wait for next user interaction\n      setIsPolling(false)\n    }\n\n    // matomo tracking stuff\n    // if (import.meta.env.FEATURE_TRACKING_MATOMO) {\n    //   /* eslint-disable react-hooks/rules-of-hooks */\n    //   const { query, queryType } = useSearchParams()  // really unsure about here, maybe more on top?\n    //   const numResultsTotal = dataPolling.numberOfRecordsLoaded // TODO: will only contain current search result count\n    //   trackSiteSearch(query, queryType, numResultsTotal) // TODO: dimension with resourceID?\n    // }\n\n    // console.debug('Invalidate data for refresh ...', { searchId, resourceId, queryKey: ['search-result-details', searchId, resourceId] })\n    // details\n    queryClient.invalidateQueries({ queryKey: ['search-result-details', searchId, resourceId] })\n  }\n\n  async function handleLoadMoreClick() {\n    // console.log('[handleLoadMoreClick]', { searchId, resourceId })\n    // reset prior state, then trigger web request\n    reset()\n    mutate()\n  }\n\n  return (\n    <Button className=\"more-results-button\" disabled={showSpinner} onClick={handleLoadMoreClick}>\n      {showSpinner ? (\n        <Spinner animation=\"border\" className=\"d-block\" />\n      ) : (\n        <>\n          <i dangerouslySetInnerHTML={{ __html: threeDotsIcon }} />{' '}\n          {t('search.results.buttonLoadMore')}\n        </>\n      )}\n    </Button>\n  )\n}\n\nexport default LoadMoreResultsButton\n","import { useRef } from 'react'\nimport Badge from 'react-bootstrap/Badge'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Table from 'react-bootstrap/Table'\nimport Tooltip from 'react-bootstrap/Tooltip'\n\nimport type {\n  AdvancedLayer,\n  AvailableLayer,\n  Resource,\n  ResourceSearchResult,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport link45degIcon from 'bootstrap-icons/icons/link-45deg.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface ViewAdvancedTabularProps {\n  data: ResourceSearchResult\n  resource?: Resource\n}\n\n// --------------------------------------------------------------------------\n\nfunction computeShortLayerIds(layerIds: string[], collapePlaceholder: string = '..') {\n  // tokenize URI by \"/\"\n  const layerIdTokens = layerIds.map((l) => l.split('/'))\n\n  // match each URI's tokens to check which are same so that we can collapse them\n  const maxTokens = Math.max(...layerIdTokens.map((l) => l.length))\n  const layerIdTokensIdentity = Array.from(Array(maxTokens).keys()).map(\n    (i) => new Set(layerIdTokens.map((l) => (l.length > i ? l[i] : false))).size === 1\n  )\n\n  // mapping to build short layer id (by collapePlaceholder/\"..\" and token indices that differ between URIs)\n  const layerIdTokenPattern = layerIdTokensIdentity.reduce(\n    (acc, val, idx, _, plh = collapePlaceholder ?? '..') =>\n      val ? (acc && acc[acc.length - 1] !== plh ? acc.concat([plh]) : acc) : acc.concat([idx]),\n    [] as (string | number)[]\n  )\n\n  // mapping of layer id to short layer id\n  const layerIdShort = layerIds\n    .map((lId) => [lId, lId.split('/')])\n    .map(\n      ([lId, lParts]) =>\n        [\n          lId,\n          layerIdTokenPattern\n            .map((v) => (typeof v === 'number' ? lParts[v] : v))\n            .join('/')\n            .replace(/\\/+$/, ''),\n        ] as [string, string]\n    )\n    .reduce((map, [id, idShort]) => map.set(id, idShort), new Map<string, string>())\n\n  return layerIdShort\n}\n\nfunction filterMainLayerIds(layers: AdvancedLayer[], resourceLayers?: Map<string, AvailableLayer>) {\n  // check if spans match the text\n  // TODO: can there be issues for non-latin characters?\n  // TODO: can there be issues for inclusive vs. exclusive indexing -- inclusive\n  // TODO: can there be issues with zero-based vs. one-based indexing -- one based\n  const layersWithMatchingSpanRanges = layers.filter(\n    (layer) =>\n      // exclusive end index\n      layer.spans.every(\n        (span) => span.text && span.text.length === (span.range?.[1] ?? 0) - (span.range?.[0] ?? 0)\n      ) ||\n      // inclusive end index\n      layer.spans.every(\n        (span) =>\n          span.text && span.text.length === (span.range?.[1] ?? 0) - (span.range?.[0] ?? 0) + 1\n      )\n    // zero-based indices with exclusive end index?\n    // || layer.spans.every(\n    //   (span) =>\n    //     span.text && span.text.length === (span.range?.[1] ?? 0) - (span.range?.[0] ?? 0) - 1\n    // )\n  )\n\n  // no resource information, then everything is ok and we also can't sort\n  if (!resourceLayers) return layersWithMatchingSpanRanges\n\n  const mainLayerIds = layersWithMatchingSpanRanges\n    // first for multiple layers based on layer type\n    .filter((layer) => {\n      // no information about this layer, it might be ok?\n      const layerInfo = resourceLayers.get(layer.id)\n      if (!layerInfo) return true\n\n      // can only be one of text (word) to be valid (probably)\n      if (!['text', 'word'].includes(layerInfo.layerType.toLowerCase())) return false\n\n      return true\n    })\n    // sort based on layer infos (do they exist, has the layer no qualifier)\n    .toSorted((layerA, layerB) => {\n      const layerAInfo = resourceLayers.get(layerA.id)\n      const layerBInfo = resourceLayers.get(layerB.id)\n\n      // no information about this layer (order layers with information first)\n      if (layerAInfo === undefined || layerBInfo === undefined) {\n        if (layerAInfo === layerBInfo) return 0\n        // B is smaller/first if no information about A\n        if (layerAInfo === undefined) return 1\n        // A is smaller/first if no information about B\n        if (layerBInfo === undefined) return -1\n      }\n\n      // maybe sort \"word\" before \"text\" layer (legacy)\n      const layerAType = layerAInfo.layerType.toLowerCase()\n      const layerBType = layerBInfo.layerType.toLowerCase()\n      if (layerAType === 'word' || layerBType === 'word') {\n        if (layerAType === layerBType) return 0\n        // if A is \"word\", then smaller/first\n        if (layerAType === 'word') return -1\n        // if B is \"word\", then smaller/first\n        if (layerBType === 'word') return 1\n      }\n\n      // order layer without qualifier first\n      if (\n        (layerAInfo.qualifier !== null && layerAInfo.qualifier !== undefined) ||\n        (layerBInfo.qualifier !== null && layerBInfo.qualifier !== undefined)\n      ) {\n        // TODO: sort based on some layer qualifiers?\n        if (\n          layerAInfo.qualifier !== null &&\n          layerAInfo.qualifier !== undefined &&\n          layerBInfo.qualifier !== null &&\n          layerBInfo.qualifier !== undefined\n        )\n          return 0\n\n        // B is smaller/first if A has a qualifier\n        if (layerAInfo.qualifier !== null && layerAInfo.qualifier !== undefined) return 1\n        // A is smaller/first if B has a qualifier\n        if (layerBInfo.qualifier !== null && layerBInfo.qualifier !== undefined) return -1\n      }\n\n      return 0\n    })\n  return mainLayerIds\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ViewAdvancedTabular({ data, resource }: ViewAdvancedTabularProps) {\n  const ref = useRef(null)\n\n  // mapping of result layer id to resource layer description\n  const resourceLayers = resource?.availableLayers?.reduce(\n    (map, availLayer) => map.set(availLayer.resultId, availLayer),\n    new Map<string, AvailableLayer>()\n  )\n\n  function renderAdvancedLayers(layers: AdvancedLayer[]) {\n    // mapping of layer id to short layer id for display\n    // TODO: caching?\n    const layerIds = layers.map((layer) => layer.id)\n    const layerIdShort = computeShortLayerIds(layerIds)\n\n    const numSpans = Math.max(...layers.map((layer) => layer.spans.length))\n\n    const mainLayerIds = filterMainLayerIds(layers, resourceLayers)\n    const mainLayerId = mainLayerIds?.[0]?.id\n    // if (mainLayerId === undefined) {\n    //   console.warn('No main layer found!', { layers, resourceLayers, resourceId: resource?.id })\n    // } else if (mainLayerIds.length > 1) {\n    //   console.debug('multiple possible mainLayerIds', mainLayerIds, resourceLayers, resource?.id)\n    // }\n\n    // console.debug(\n    //   'layer span ranges',\n    //   resource?.id,\n    //   layers.map((layer) => ({\n    //     ...layer,\n    //     spans: layer.spans.map((span) => ({\n    //       ...span,\n    //       textlen: span.text?.length,\n    //       rangeDiff: (span.range?.[1] ?? 0) - (span.range?.[0] ?? 0),\n    //     })),\n    //     startIndex: layer.spans?.[0].range?.[0],\n    //     variant: layer.spans.every((span) => span.text && span.text.length === (span.range?.[1] ?? 0) - (span.range?.[0] ?? 0))\n    //       ? 'exclusive end index'\n    //       : layer.spans.every((span) => span.text && span.text.length === (span.range?.[1] ?? 0) - (span.range?.[0] ?? 0) + 1)\n    //       ? 'inclusive end index'\n    //       : layer.spans.every((span) => span.text && span.text.length === (span.range?.[1] ?? 0) - (span.range?.[0] ?? 0) - 1)\n    //       ? 'exclusive end index and ?'\n    //       : layer.spans.reduce((acc, span) => acc + (span.text?.length ?? 0), 0) == (layer.spans[layer.spans.length - 1]?.range?.[1] ?? 0) - (layer.spans?.[0].range?.[0] ?? 0)\n    //       ? 'total length matches'\n    //       : '?',\n    //   }))\n    // )\n\n    layers.sort((layerA, layerB) => {\n      if (mainLayerId === undefined) return 0\n      if (layerA.id === mainLayerId) return -1\n      if (layerB.id === mainLayerId) return 1\n\n      if (!resourceLayers) return 0\n\n      return 0\n    })\n\n    // whether to show layer type and layer identifier columns\n    const showLayerInfoColumns = layerIds.length > 1\n\n    // TODO: maybe with column hover?\n    // see: https://ianobermiller.com/blog/highlight-table-row-column-react\n\n    return (\n      <Table hover responsive className=\"mb-0 results-plain\" style={{ width: 'unset' }}>\n        <thead className=\"visually-hidden\">\n          <tr>\n            {resourceLayers !== undefined && showLayerInfoColumns && (\n              <th scope=\"col\">Layer Type</th>\n            )}\n            {showLayerInfoColumns && <th scope=\"col\">Layer Identifier</th>}\n            {Array(numSpans)\n              .fill(null)\n              .map((_, index) => (\n                <th scope=\"col\" key={index}>\n                  Token\n                </th>\n              ))}\n          </tr>\n        </thead>\n        <tbody>\n          {layers.map((layer) => (\n            <tr\n              key={layer.id}\n              className={(['text-nowrap'] as (string | null)[])\n                .concat([layer.id === mainLayerId && layers.length > 1 ? 'table-primary' : null])\n                .filter(Boolean)\n                .join(' ')}\n            >\n              {resourceLayers !== undefined && showLayerInfoColumns && (\n                <td scope=\"row\" className=\"text-uppercase\">\n                  {resourceLayers.get(layer.id)?.layerType}\n                </td>\n              )}\n              {showLayerInfoColumns && (\n                <td scope=\"row\" title={layer.id} className=\"border-end\">\n                  {layerIdShort.get(layer.id)}\n                </td>\n              )}\n              {layer.spans.map((span, index) => (\n                <td key={span.range?.join('-') ?? index}>\n                  {span.hit ? (\n                    <mark key={index}>\n                      <strong>{span.text}</strong>\n                    </mark>\n                  ) : (\n                    span.text\n                  )}\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </Table>\n    )\n  }\n\n  return (\n    <>\n      <Table responsive striped className=\"mb-0 results-plain\">\n        <thead className=\"visually-hidden\">\n          <tr>\n            <th scope=\"col\">#</th>\n            <th scope=\"col\">References</th>\n            <th scope=\"col\">Result with Annotation Layers</th>\n          </tr>\n        </thead>\n        <tbody>\n          {data.records\n            .filter((record) => record.adv !== null)\n            .map((record, index) => (\n              <tr key={`${record.pid ?? record.ref ?? data.resource.id}-${index}`}>\n                <td scope=\"row\" className=\"result-idx text-end text-muted d-none d-sm-table-cell\">\n                  {index + 1}\n                </td>\n                <td scope=\"row\" className=\"result-refs\">\n                  {record.ref && (\n                    <a href={record.ref} className=\"matomo_link\" target=\"_blank\">\n                      <i dangerouslySetInnerHTML={{ __html: link45degIcon }} />\n                    </a>\n                  )}{' '}\n                  {record.pid && (\n                    <OverlayTrigger\n                      placement=\"auto-start\"\n                      container={ref}\n                      delay={{ show: 250, hide: 400 }}\n                      overlay={<Tooltip id={`ttip-${record.pid}-${index}`}>{record.pid}</Tooltip>}\n                    >\n                      {/* TODO: maybe with on mouse-over stay? see: https://github.com/react-bootstrap/react-bootstrap/issues/1622*/}\n                      <Badge bg=\"secondary\" className=\"pid-badge\">\n                        PID\n                      </Badge>\n                    </OverlayTrigger>\n                  )}\n                </td>\n                <td>{renderAdvancedLayers(record.adv!)}</td>\n              </tr>\n            ))}\n        </tbody>\n      </Table>\n      {/* overlay mounting point to avoid flickering due to redrawing */}\n      <div ref={ref} className=\"tooltip-mounting-point\"></div>\n    </>\n  )\n}\n\nexport default ViewAdvancedTabular\n","import { useRef } from 'react'\nimport Badge from 'react-bootstrap/Badge'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Table from 'react-bootstrap/Table'\nimport Tooltip from 'react-bootstrap/Tooltip'\n\nimport type { ResourceSearchResult } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport link45degIcon from 'bootstrap-icons/icons/link-45deg.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface ViewKwicProps {\n  data: ResourceSearchResult\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ViewKwic({ data }: ViewKwicProps) {\n  const ref = useRef(null)\n\n  return (\n    <>\n      <Table hover responsive className=\"mb-0 results-kwic\">\n        <thead className=\"visually-hidden\">\n          <tr>\n            <th scope=\"col\">#</th>\n            <th scope=\"col\">References</th>\n            <th scope=\"col\">Left Context</th>\n            <th scope=\"col\">Hit</th>\n            <th scope=\"col\">Right Context</th>\n          </tr>\n        </thead>\n        <tbody>\n          {data.records.map((record, index) => (\n            <tr key={`${record.pid ?? record.ref ?? data.resource.id}-${index}`}>\n              <td scope=\"row\" className=\"result-idx text-end text-muted d-none d-sm-table-cell\">\n                {index + 1}\n              </td>\n              <td scope=\"row\" className=\"result-refs\">\n                {record.ref && (\n                  <a href={record.ref} className=\"matomo_link\" target=\"_blank\">\n                    <i dangerouslySetInnerHTML={{ __html: link45degIcon }} />\n                  </a>\n                )}{' '}\n                {record.pid && (\n                  <OverlayTrigger\n                    placement=\"auto-start\"\n                    container={ref}\n                    delay={{ show: 250, hide: 400 }}\n                    overlay={<Tooltip id={`ttip-${record.pid}-${index}`}>{record.pid}</Tooltip>}\n                  >\n                    {/* TODO: maybe with on mouse-over stay? see: https://github.com/react-bootstrap/react-bootstrap/issues/1622*/}\n                    <Badge bg=\"secondary\" className=\"pid-badge\">\n                      PID\n                    </Badge>\n                  </OverlayTrigger>\n                )}\n              </td>\n              <td>{record.hits.left}</td>\n              <td>\n                {record.hits.keyword && (\n                  <mark>\n                    <strong>{record.hits.keyword}</strong>\n                  </mark>\n                )}\n              </td>\n              <td>{record.hits.right}</td>\n            </tr>\n          ))}\n        </tbody>\n      </Table>\n      {/* overlay mounting point to avoid flickering due to redrawing */}\n      <div ref={ref} className=\"tooltip-mounting-point\"></div>\n    </>\n  )\n}\n\nexport default ViewKwic\n","import { useRef } from 'react'\nimport Badge from 'react-bootstrap/Badge'\nimport Card from 'react-bootstrap/Card'\nimport ListGroup from 'react-bootstrap/ListGroup'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Tooltip from 'react-bootstrap/Tooltip'\n\nimport type { ResourceSearchResult } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport link45degIcon from 'bootstrap-icons/icons/link-45deg.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface ViewLexProps {\n  data: ResourceSearchResult\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ViewLex({ data }: ViewLexProps) {\n  const ref = useRef(null)\n\n  return (\n    <div className=\"results-lexical-entry d-flex flex-column flex-wrap column-gap-2 row-gap-2\">\n      {data.records\n        .filter((record) => record.lex !== null)\n        .map((record, index) => (\n          <Card\n            key={`${record.pid ?? record.ref ?? data.resource.id}-${index}`}\n            className=\"flex-grow-1 w-100\"\n          >\n            <Card.Body>\n              <Card.Title>\n                {record\n                  .lex!.fields.filter((field) => field.type === 'lemma')\n                  .map((field) => field.values)\n                  .flat(1)\n                  .map((value) => (\n                    <span>{value.value}</span>\n                  ))}\n              </Card.Title>\n              <ListGroup variant=\"flush\">\n                {(record.lex!.lang || record.lex!.langUri) && (\n                  <ListGroup.Item>\n                    <strong>lang</strong>: {record.lex!.lang} {record.lex!.langUri}\n                  </ListGroup.Item>\n                )}\n                {record\n                  .lex!.fields.filter((field) => field.type !== 'lemma')\n                  .map((field) => (\n                    <ListGroup.Item key={field.type}>\n                      <strong>{field.type}</strong>:\n                      {field.values.map((value, index) => (\n                        <span key={index} className=\"ms-2 lex-value\">\n                          {value.value}\n                        </span>\n                      ))}\n                    </ListGroup.Item>\n                  ))}\n              </ListGroup>\n              <Card.Link>\n                {record.ref && (\n                  <a href={record.ref} className=\"matomo_link\" target=\"_blank\">\n                    <i dangerouslySetInnerHTML={{ __html: link45degIcon }} /> Original results ...\n                  </a>\n                )}\n              </Card.Link>\n              <Card.Link>\n                {record.pid && (\n                  <OverlayTrigger\n                    placement=\"auto-start\"\n                    container={ref}\n                    delay={{ show: 250, hide: 400 }}\n                    overlay={<Tooltip id={`ttip-${record.pid}-${index}`}>{record.pid}</Tooltip>}\n                  >\n                    {/* TODO: maybe with on mouse-over stay? see: https://github.com/react-bootstrap/react-bootstrap/issues/1622*/}\n                    <Badge bg=\"secondary\" className=\"pid-badge\">\n                      PID\n                    </Badge>\n                  </OverlayTrigger>\n                )}\n              </Card.Link>\n            </Card.Body>\n          </Card>\n        ))}\n      {/* overlay mounting point to avoid flickering due to redrawing */}\n      <div ref={ref} className=\"tooltip-mounting-point\"></div>\n    </div>\n  )\n}\n\nexport default ViewLex\n","import { useRef } from 'react'\nimport Badge from 'react-bootstrap/Badge'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Table from 'react-bootstrap/Table'\nimport Tooltip from 'react-bootstrap/Tooltip'\n\nimport type { ResourceSearchResult } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport link45degIcon from 'bootstrap-icons/icons/link-45deg.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface ViewLexPlainProps {\n  data: ResourceSearchResult\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ViewLexPlain({ data }: ViewLexPlainProps) {\n  const ref = useRef(null)\n\n  return (\n    <>\n      <Table hover responsive className=\"mb-0 results-lex-plain\">\n        <thead className=\"visually-hidden\">\n          <tr>\n            <th scope=\"col\">#</th>\n            <th scope=\"col\">References</th>\n            <th scope=\"col\">Result with Hit</th>\n          </tr>\n        </thead>\n        <tbody>\n          {data.records.map((record, index) => (\n            <tr key={`${record.pid ?? record.ref ?? data.resource.id}-${index}`}>\n              <td scope=\"row\" className=\"result-idx text-end text-muted d-none d-sm-table-cell\">\n                {index + 1}\n              </td>\n              <td scope=\"row\" className=\"result-refs\">\n                {record.ref && (\n                  <a href={record.ref} className=\"matomo_link\" target=\"_blank\">\n                    <i dangerouslySetInnerHTML={{ __html: link45degIcon }} />\n                  </a>\n                )}{' '}\n                {record.pid && (\n                  <OverlayTrigger\n                    placement=\"auto-start\"\n                    container={ref}\n                    delay={{ show: 250, hide: 400 }}\n                    overlay={<Tooltip id={`ttip-${record.pid}-${index}`}>{record.pid}</Tooltip>}\n                  >\n                    {/* TODO: maybe with on mouse-over stay? see: https://github.com/react-bootstrap/react-bootstrap/issues/1622*/}\n                    <Badge bg=\"secondary\" className=\"pid-badge\">\n                      PID\n                    </Badge>\n                  </OverlayTrigger>\n                )}\n              </td>\n              <td>\n                {record.hits.fragments.map((fragment, index) =>\n                  fragment.hit && !fragment.hitKind ? (\n                    <mark key={index}>\n                      <strong>{fragment.text}</strong>\n                    </mark>\n                  ) : fragment.hit && fragment.hitKind ? (\n                    <span\n                      key={index}\n                      className={`lex-hitkind-${fragment.hitKind}`}\n                      title={`Annotated as \"${fragment.hitKind.split('-').slice(1).join('-')}\"`}\n                    >\n                      {fragment.text}\n                    </span>\n                  ) : (\n                    <span key={index}>{fragment.text}</span>\n                  )\n                )}\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </Table>\n      {/* overlay mounting point to avoid flickering due to redrawing */}\n      <div ref={ref} className=\"tooltip-mounting-point\"></div>\n    </>\n  )\n}\n\nexport default ViewLexPlain\n","import { useRef } from 'react'\nimport Badge from 'react-bootstrap/Badge'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Table from 'react-bootstrap/Table'\nimport Tooltip from 'react-bootstrap/Tooltip'\n\nimport type { ResourceSearchResult } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport link45degIcon from 'bootstrap-icons/icons/link-45deg.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface ViewPlainProps {\n  data: ResourceSearchResult\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ViewPlain({ data }: ViewPlainProps) {\n  const ref = useRef(null)\n\n  return (\n    <>\n      <Table hover responsive className=\"mb-0 results-plain\">\n        <thead className=\"visually-hidden\">\n          <tr>\n            <th scope=\"col\">#</th>\n            <th scope=\"col\">References</th>\n            <th scope=\"col\">Result with Hit</th>\n          </tr>\n        </thead>\n        <tbody>\n          {data.records.map((record, index) => (\n            <tr key={`${record.pid ?? record.ref ?? data.resource.id}-${index}`}>\n              <td scope=\"row\" className=\"result-idx text-end text-muted d-none d-sm-table-cell\">\n                {index + 1}\n              </td>\n              <td scope=\"row\" className=\"result-refs\">\n                {record.ref && (\n                  <a href={record.ref} className=\"matomo_link\" target=\"_blank\">\n                    <i dangerouslySetInnerHTML={{ __html: link45degIcon }} />\n                  </a>\n                )}{' '}\n                {record.pid && (\n                  <OverlayTrigger\n                    placement=\"auto-start\"\n                    container={ref}\n                    delay={{ show: 250, hide: 400 }}\n                    overlay={<Tooltip id={`ttip-${record.pid}-${index}`}>{record.pid}</Tooltip>}\n                  >\n                    {/* TODO: maybe with on mouse-over stay? see: https://github.com/react-bootstrap/react-bootstrap/issues/1622*/}\n                    <Badge bg=\"secondary\" className=\"pid-badge\">\n                      PID\n                    </Badge>\n                  </OverlayTrigger>\n                )}\n              </td>\n              <td>\n                {record.hits.fragments.map((fragment, index) =>\n                  fragment.hit && !fragment.hitKind ? (\n                    <mark key={index}>\n                      <strong>{fragment.text}</strong>\n                    </mark>\n                  ) : (\n                    <span key={index}>{fragment.text}</span>\n                  )\n                )}\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </Table>\n      {/* overlay mounting point to avoid flickering due to redrawing */}\n      <div ref={ref} className=\"tooltip-mounting-point\"></div>\n    </>\n  )\n}\n\nexport default ViewPlain\n","import { useEffect, useState } from 'react'\nimport Alert from 'react-bootstrap/Alert'\nimport Button from 'react-bootstrap/Button'\nimport Col from 'react-bootstrap/Col'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport FloatingLabel from 'react-bootstrap/FloatingLabel'\nimport Form from 'react-bootstrap/Form'\nimport Modal from 'react-bootstrap/Modal'\nimport Row from 'react-bootstrap/Row'\nimport ToggleButton from 'react-bootstrap/ToggleButton'\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup'\nimport { Trans, useTranslation } from 'react-i18next'\n\nimport type {\n  Resource,\n  ResourceSearchResult,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport {\n  getSearchResultsURL,\n  getURLForDownload,\n  getURLForWeblicht,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport { useAggregatorData } from '@/providers/AggregatorDataContext'\nimport { useAxios } from '@/providers/AxiosContext'\nimport { useSearchParams } from '@/providers/SearchParamsContext'\nimport { useLocaleStore } from '@/stores/locale'\n\nimport { DOWNLOAD_FORMATS, NO_MORE_RECORDS_DIAGNOSTIC_URI } from '@/utils/constants'\nimport {\n  findResourceByFilter,\n  getBestFromMultilingualValuesTryByLanguage,\n  getLanguagesFromResourceInfo,\n} from '@/utils/resources'\nimport type { ResultsViewMode } from '@/utils/results'\nimport { languageCodeToName, MULTIPLE_LANGUAGE_CODE } from '@/utils/search'\nimport LoadMoreResultsButton from './LoadMoreResultsButton'\nimport ViewAdvancedTabular from './ViewAdvancedTabular'\nimport ViewKwic from './ViewKwic'\nimport ViewLex from './ViewLex'\nimport ViewLexPlain from './ViewLexPlain'\nimport ViewPlain from './ViewPlain'\n\nimport bankIcon from 'bootstrap-icons/icons/bank.svg?raw'\nimport downloadIcon from 'bootstrap-icons/icons/download.svg?raw'\nimport envelopeArrowUpIcon from 'bootstrap-icons/icons/envelope-arrow-up.svg?raw'\nimport fileEarmarkCodeIcon from 'bootstrap-icons/icons/file-earmark-code.svg?raw'\nimport houseDoorIcon from 'bootstrap-icons/icons/house-door.svg?raw'\nimport infoCircleIcon from 'bootstrap-icons/icons/info-circle.svg?raw'\nimport translateIcon from 'bootstrap-icons/icons/translate.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\ninterface ResourceResultsModalProps {\n  show: boolean\n  searchId: string\n  resourceId: string\n  result: ResourceSearchResult\n  viewMode: ResultsViewMode\n  showDiagnostics: boolean\n  onModalClose: () => void\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ResourceResultsModal({\n  show,\n  searchId,\n  resourceId,\n  result,\n  viewMode: viewModeProps,\n  showDiagnostics: showDiagnosticsProps,\n  onModalClose,\n}: ResourceResultsModalProps) {\n  const axios = useAxios()\n  const { t } = useTranslation()\n  const userLocale = useLocaleStore((state) => state.locale)\n  const { languages, resources, weblichtLanguages } = useAggregatorData()\n  const { numberOfResults, queryType, language, languageFilter } = useSearchParams()\n\n  const [locale, setLocale] = useState(userLocale)\n  useEffect(() => {\n    if (userLocale) setLocale(userLocale)\n  }, [userLocale])\n\n  const langNames = new Intl.DisplayNames([userLocale, 'en'], { type: 'language' })\n\n  const [showDiagnostics, setShowDiagnostics] = useState(showDiagnosticsProps)\n  useEffect(() => setShowDiagnostics(showDiagnosticsProps), [showDiagnosticsProps])\n  const [viewMode, setViewMode] = useState(viewModeProps)\n  useEffect(() => setViewMode(viewModeProps), [viewModeProps])\n\n  const languageForResource = getLanguagesFromResourceInfo(result.resource)\n\n  const hasDiagnostics =\n    result.exception ||\n    result.diagnostics?.filter((diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI)\n      .length > 0\n\n  // --------------------------------------------------------------\n  // helper\n\n  function hasMoreResults() {\n    if (!result) return false\n    if (result.nextRecordPosition === -1) return false\n    if (result.numberOfRecords === -1) return false\n    if (result.numberOfRecords === result.records.length) return true // TODO: maybe?\n    return true\n  }\n\n  let languageForWeblicht = null\n  let disableWeblicht = false\n  if (!weblichtLanguages.includes(language)) {\n    // the search language is either AnyLanguage or unsupported\n    if (language === MULTIPLE_LANGUAGE_CODE) {\n      if (result.resource.languages && result.resource.languages.length === 1) {\n        languageForWeblicht = result.resource.languages[0]\n      } else {\n        const languagesFromKwic = [\n          ...new Set(\n            result.records.map((record) => record.lang).filter((language) => language !== null)\n          ),\n        ]\n        if (languagesFromKwic.length === 1) {\n          languageForWeblicht = languagesFromKwic[0]\n        }\n      }\n    }\n    if (!languageForWeblicht) {\n      console.warn('Cannot use WebLicht: unsupported language', { language, languageFilter })\n      disableWeblicht = true\n    }\n  }\n\n  // ------------------------------------------------------------------------\n  // event handlers\n\n  function handleViewModeChange(event: React.ChangeEvent<HTMLSelectElement>) {\n    setViewMode(event.target.value as ResultsViewMode)\n  }\n\n  // ------------------------------------------------------------------------\n  // UI\n\n  function renderResults() {\n    if (!result) return null // TODO: loading spinner? but should not reach here\n\n    if (viewMode === 'annotation-layers' && result.hasAdvResults) {\n      const resource = findResourceByFilter(\n        resources,\n        (resource: Resource) => resource.id === result.id\n      )\n      return <ViewAdvancedTabular data={result} resource={resource} />\n    }\n    if (viewMode === 'kwic' && (queryType !== 'lex' || !result.isLexHits)) {\n      return <ViewKwic data={result} />\n    }\n    if (viewMode === 'lexical-entry' && result.hasLexResults) {\n      return <ViewLex data={result} />\n    }\n    if (queryType === 'lex' && result.isLexHits) {\n      return <ViewLexPlain data={result} />\n    }\n    // 'plain' (fallback)\n    return <ViewPlain data={result} />\n  }\n\n  return (\n    <Modal\n      show={show}\n      onHide={() => onModalClose()}\n      size=\"xl\"\n      fullscreen=\"lg-down\"\n      centered\n      className=\"resource-search-result-modal\"\n    >\n      <Modal.Header closeButton>\n        <Modal.Title>\n          {getBestFromMultilingualValuesTryByLanguage(result.resource.title, locale)}\n        </Modal.Title>\n      </Modal.Header>\n      <Modal.Body className=\"resource-info\">\n        <dl className=\"mb-0\" aria-label={t('search.results.resourceInfo.infoTableAriaLabel')}>\n          <dt>\n            <i dangerouslySetInnerHTML={{ __html: bankIcon }} />{' '}\n            {t('search.results.resourceInfo.labelInstitution')}\n          </dt>\n          <dd className=\"mb-0\">\n            {getBestFromMultilingualValuesTryByLanguage(result.resource.institution, locale)}\n          </dd>\n          <dt>\n            <i dangerouslySetInnerHTML={{ __html: infoCircleIcon }} />{' '}\n            {t('search.results.resourceInfo.labelDescription')}\n          </dt>\n          {getBestFromMultilingualValuesTryByLanguage(result.resource.description, locale) && (\n            <>\n              <dd className=\"mb-0\">\n                {getBestFromMultilingualValuesTryByLanguage(result.resource.description, locale)}\n              </dd>\n              <dt>\n                <i dangerouslySetInnerHTML={{ __html: translateIcon }} />{' '}\n                {t('search.results.resourceInfo.labelLanguages')}\n              </dt>\n            </>\n          )}\n          <dd className=\"mb-0\">\n            {result.resource.languages\n              .map(\n                languages\n                  ? (code) =>\n                      languageCodeToName(code, languages, {\n                        defaultAnyLanguage: t('languageCodeToName.any', { ns: 'common' }),\n                        defaultUnknownLanguage: t('languageCodeToName.unknown', { ns: 'common' }),\n                      })\n                  : (x) => x\n              )\n              .toSorted()\n              .join(', ')}\n          </dd>\n\n          {languageForResource && languageForResource.length > 1 && (\n            <ToggleButtonGroup\n              type=\"radio\"\n              name={`${result.resource.id}-result-modal-info-languages`}\n              defaultValue={locale}\n              onChange={(language) => setLocale(language)}\n              className=\"mt-2 mb-3\"\n            >\n              {languageForResource.toSorted().map((language) => (\n                <ToggleButton\n                  variant=\"outline-secondary\"\n                  size=\"sm\"\n                  key={language}\n                  id={`${result.resource.id}-result-modal-info-languages-${language}`}\n                  value={language}\n                >\n                  {langNames.of(language)} <sup>{language}</sup>\n                </ToggleButton>\n              ))}\n            </ToggleButtonGroup>\n          )}\n\n          <dt>{t('search.results.resourceInfo.labelPID')}</dt>\n          <dd>{result.resource.handle}</dd>\n        </dl>\n\n        {result.resource.landingPage && (\n          <a href={result.resource.landingPage} className=\"matomo_link\" target=\"_blank\">\n            <i dangerouslySetInnerHTML={{ __html: houseDoorIcon }} />{' '}\n            {t('search.results.resourceInfo.moreInformation')}\n          </a>\n        )}\n        <hr />\n        <Row className=\"row-gap-2\">\n          <Col lg={'auto'} md={3} sm={6}>\n            <FloatingLabel\n              label={t('search.results.displayOptions.viewModeLabel')}\n              controlId=\"results-view-mode\"\n            >\n              <Form.Select value={viewMode} onChange={handleViewModeChange}>\n                <option value=\"plain\">\n                  {t('search.results.displayOptions.viewModeOptions.plain')}\n                </option>\n                {(queryType !== 'lex' || !result.isLexHits) && (\n                  <option value=\"kwic\">\n                    {t('search.results.displayOptions.viewModeOptions.kwic')}\n                  </option>\n                )}\n                {queryType === 'fcs' && (\n                  <option value=\"annotation-layers\">\n                    {t('search.results.displayOptions.viewModeOptions.annotation-layers')}\n                  </option>\n                )}\n                {queryType === 'lex' && (\n                  <option value=\"lexical-entry\">\n                    {t('search.results.displayOptions.viewModeOptions.lexical-entry')}\n                  </option>\n                )}\n              </Form.Select>\n            </FloatingLabel>\n          </Col>\n          <Col lg={3} md={3} sm={6} className=\"align-content-center\">\n            <Form.Check\n              disabled={!hasDiagnostics}\n              checked={showDiagnostics}\n              onChange={() => setShowDiagnostics((show) => !show)}\n              id=\"results-modal-view-warnings-errors\"\n              label={t('search.results.displayOptions.optionShowWarningsErrors')}\n            />\n          </Col>\n          <Col\n            lg={'auto'}\n            md={6}\n            sm={6}\n            className=\"d-flex flex-grow-1 column-gap-3 align-items-center justify-content-end\"\n          >\n            <Dropdown>\n              <Dropdown.Toggle>\n                <i dangerouslySetInnerHTML={{ __html: downloadIcon }} />{' '}\n                {t('search.results.buttonDownload')}\n              </Dropdown.Toggle>\n              <Dropdown.Menu>\n                {DOWNLOAD_FORMATS.map(({ id: format, label }) => (\n                  <Dropdown.Item\n                    href={getURLForDownload(\n                      axios,\n                      searchId,\n                      resourceId,\n                      format,\n                      language,\n                      languageFilter\n                    )}\n                    className=\"matomo_download\"\n                    key={format}\n                  >\n                    <Trans\n                      i18nKey=\"search.results.msgButtonDownloadOption\"\n                      values={{\n                        label: t(`downloadFormats.${format}.name`, {\n                          ns: 'common',\n                          defaultValue: label,\n                        }),\n                      }}\n                    />\n                  </Dropdown.Item>\n                ))}\n              </Dropdown.Menu>\n            </Dropdown>\n            {/* TODO: show more visible message to user? */}\n            <Button\n              disabled={disableWeblicht}\n              aria-disabled={disableWeblicht}\n              href={getURLForWeblicht(\n                axios,\n                searchId,\n                resourceId,\n                languageForWeblicht ?? null,\n                language,\n                languageFilter\n              )}\n              className=\"matomo_link\"\n              target=\"_blank\"\n            >\n              <i dangerouslySetInnerHTML={{ __html: envelopeArrowUpIcon }} />{' '}\n              {t('search.results.buttonSendToWeblicht')}\n            </Button>\n            {import.meta.env.SHOW_SEARCH_RESULT_DEV_URLS && (\n              <Dropdown>\n                <Dropdown.Toggle>\n                  <i dangerouslySetInnerHTML={{ __html: fileEarmarkCodeIcon }} />{' '}\n                  {t('search.results.buttonDevelopStuff')}\n                </Dropdown.Toggle>\n                <Dropdown.Menu>\n                  {result.requestUrl && (\n                    <Dropdown.Item href={result.requestUrl} target=\"_blank\">\n                      {t('search.results.msgButtonDevelopStuffOptionSRURequestURL')}\n                    </Dropdown.Item>\n                  )}\n                  <Dropdown.Item\n                    href={getSearchResultsURL(axios, searchId, resourceId, false)}\n                    target=\"_blank\"\n                  >\n                    {t('search.results.msgButtonDevelopStuffOptionSRUResponseParsed')}\n                  </Dropdown.Item>\n                </Dropdown.Menu>\n              </Dropdown>\n            )}\n          </Col>\n        </Row>\n        <hr />\n        {/* results */}\n        <p>\n          <Trans\n            i18nKey=\"search.results.msgShowingXresults\"\n            values={{\n              count: result.records.length,\n              context: hasMoreResults() ? 'hasmore' : null,\n              total: result.numberOfRecords,\n            }}\n          />\n        </p>\n        {renderResults()}\n      </Modal.Body>\n      {/* diagnostics */}\n      {showDiagnostics && hasDiagnostics && (\n        <Modal.Body className=\"border-top\">\n          {result.exception && (\n            <Alert variant=\"danger\" aria-label={t('search.results.diagnostics.alertAriaLabel')}>\n              <Alert.Heading style={{ fontSize: '1rem' }}>\n                <span className=\"text-uppercase\">\n                  {t('search.results.diagnostics.titleException')}\n                </span>{' '}\n                <span aria-label={t('search.results.diagnostics.msgAriaLabel')}>\n                  {result.exception.message}\n                </span>\n              </Alert.Heading>\n              {result.exception.cause && (\n                <p className=\"mb-0 small\">\n                  {t('search.results.diagnostics.msgCause', { cause: result.exception.cause })}\n                </p>\n              )}\n              {result.exception.klass && (\n                <p className=\"mb-0 small\">\n                  <Trans\n                    i18nKey=\"search.results.diagnostics.msgCausedBy\"\n                    values={{ class: result.exception.klass }}\n                  />\n                </p>\n              )}\n            </Alert>\n          )}\n          {result.diagnostics\n            .filter((diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI)\n            .map((diagnostic) => (\n              <Alert\n                variant=\"warning\"\n                key={`${diagnostic.uri}-${diagnostic.message}-${diagnostic.diagnostic}`}\n              >\n                <Alert.Heading style={{ fontSize: '1rem' }}>{diagnostic.message}</Alert.Heading>\n                {diagnostic.diagnostic && (\n                  <p className=\"mb-0 small\">\n                    {t('search.results.diagnostics.msgDiagnosticDetails', {\n                      details: diagnostic.diagnostic,\n                    })}\n                  </p>\n                )}\n                <p className=\"mb-0 small\">\n                  <Trans\n                    i18nKey=\"search.results.diagnostics.msgDiagnosticType\"\n                    values={{ uri: diagnostic.uri }}\n                  />\n                  {/* add link to list? */}\n                </p>\n              </Alert>\n            ))}\n        </Modal.Body>\n      )}\n      {/* load more button */}\n      {hasMoreResults() && (\n        <Modal.Footer className=\"justify-content-center border-top py-2\">\n          {/* TODO: maybe split button to choose how many to load? */}\n          <LoadMoreResultsButton\n            searchId={searchId}\n            resourceId={resourceId}\n            numberOfResults={numberOfResults}\n          />\n        </Modal.Footer>\n      )}\n    </Modal>\n  )\n}\n\nexport default ResourceResultsModal\n","import { useQuery } from '@tanstack/react-query'\nimport { useEffect, useId, useState } from 'react'\nimport Alert from 'react-bootstrap/Alert'\nimport Badge from 'react-bootstrap/Badge'\nimport Button from 'react-bootstrap/Button'\nimport Card from 'react-bootstrap/Card'\nimport Collapse from 'react-bootstrap/Collapse'\nimport ToggleButton from 'react-bootstrap/ToggleButton'\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup'\nimport { Trans, useTranslation } from 'react-i18next'\n\nimport type {\n  Resource,\n  ResourceSearchResult,\n  ResourceSearchResultMetaOnly,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport { getSearchResultDetails } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport { useAggregatorData } from '@/providers/AggregatorDataContext'\nimport { useAxios } from '@/providers/AxiosContext'\nimport { useSearchParams } from '@/providers/SearchParamsContext'\nimport { useLocaleStore } from '@/stores/locale'\nimport { NO_MORE_RECORDS_DIAGNOSTIC_URI } from '@/utils/constants'\nimport {\n  findResourceByFilter,\n  getBestFromMultilingualValuesTryByLanguage,\n  getLanguagesFromResourceInfo,\n} from '@/utils/resources'\nimport type { ResultsViewMode } from '@/utils/results'\nimport { languageCodeToName } from '@/utils/search'\nimport ResourceResultsModal from './ResourceResultsModal'\nimport ViewAdvancedTabular from './ViewAdvancedTabular'\nimport ViewKwic from './ViewKwic'\nimport ViewLex from './ViewLex'\nimport ViewLexPlain from './ViewLexPlain'\nimport ViewPlain from './ViewPlain'\n\nimport bankIcon from 'bootstrap-icons/icons/bank.svg?raw'\nimport eyeIcon from 'bootstrap-icons/icons/eye.svg?raw'\nimport infoCircleIcon from 'bootstrap-icons/icons/info-circle.svg?raw'\nimport translateIcon from 'bootstrap-icons/icons/translate.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport interface ResourceSearchResultProps {\n  searchId: string\n  resourceId: string\n  resultInfo: ResourceSearchResultMetaOnly\n  viewMode: ResultsViewMode\n  showResourceDetails: boolean\n  showDiagnostics: boolean\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ResourceSearchResult({\n  searchId,\n  resourceId,\n  resultInfo,\n  viewMode,\n  showResourceDetails,\n  showDiagnostics,\n}: ResourceSearchResultProps) {\n  const axios = useAxios()\n  const { t } = useTranslation()\n  const userLocale = useLocaleStore((state) => state.locale)\n  const { languages, resources } = useAggregatorData()\n  const { queryType } = useSearchParams()\n\n  const [locale, setLocale] = useState(userLocale)\n  useEffect(() => {\n    if (userLocale) setLocale(userLocale)\n  }, [userLocale])\n\n  const langNames = new Intl.DisplayNames([userLocale, 'en'], { type: 'language' })\n\n  const htmlId = useId()\n  const [expanded, setExpanded] = useState(true)\n  const [showModal, setShowModal] = useState(false)\n\n  const inProgress = resultInfo.inProgress\n  const hasResults = resultInfo.numberOfRecordsLoaded > 0 // number of required default KWIC rows loaded\n  const hasDiagnostics =\n    resultInfo.exception ||\n    resultInfo.diagnostics?.filter(\n      (diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI\n    ).length > 0\n\n  const { data, isLoading, isError } = useQuery({\n    queryKey: ['search-result-details', searchId, resourceId],\n    queryFn: getSearchResultDetails.bind(null, axios, searchId, resourceId),\n    enabled: !inProgress, // && hasResults,\n  })\n  console.debug(\n    'resource results',\n    { searchId, resourceId, inProgress, hasResults, hasDiagnostics },\n    { data, isLoading, isError }\n  )\n\n  const languageForResource = data ? getLanguagesFromResourceInfo(data.resource) : []\n\n  // TODO: filter for language \"byGuess\" mode\n\n  // do not show when\n  // (a) still in progress\n  if (inProgress) return null\n  // (b) if no results, check if diags and diags should be shown\n  if (!hasResults) {\n    // if show diags but do not have diags => hide\n    if (showDiagnostics && !hasDiagnostics) return null\n    // if no results && do not want to show diags => hide\n    if (!showDiagnostics) return null\n  }\n  // (c) does not yet have data\n  if (!data) return null\n\n  // --------------------------------------------------------------\n  // event handlers\n\n  function handleViewClick() {\n    setShowModal(true)\n  }\n\n  function handleModalClose() {\n    setShowModal(false)\n  }\n\n  // ------------------------------------------------------------------------\n  // UI\n\n  function renderResultsCounter() {\n    if (!data) return null // TODO\n\n    if (data.numberOfRecords === -1) {\n      // probably at end, since endpoints respond with -1 when trying to request more than available\n      return data.records.length\n    } else if (data.numberOfRecords === data.records.length && data.nextRecordPosition === -1) {\n      // either everything or possibly more\n      return `${data.records.length} / ${data.numberOfRecords}?`\n    } else {\n      return `${data.records.length} / ${data.numberOfRecords}`\n    }\n  }\n\n  function renderResults() {\n    if (!data) return null // TODO: loading spinner? but should not reach here\n\n    if (viewMode === 'annotation-layers' && data.hasAdvResults) {\n      const resource = findResourceByFilter(\n        resources,\n        (resource: Resource) => resource.id === data.id\n      )\n      return <ViewAdvancedTabular data={data} resource={resource} />\n    }\n    if (viewMode === 'kwic' && (queryType !== 'lex' || !data.isLexHits)) {\n      return <ViewKwic data={data} />\n    }\n    if (viewMode === 'lexical-entry' && data.hasLexResults) {\n      return <ViewLex data={data} />\n    }\n    if (queryType === 'lex' && data.isLexHits) {\n      return <ViewLexPlain data={data} />\n    }\n    // 'plain' (fallback)\n    return <ViewPlain data={data} />\n  }\n\n  return (\n    <>\n      <Card\n        className=\"my-1 resource-search-result\"\n        role=\"group\"\n        aria-label={t('search.results.resultResourceAriaLabel', { title: data.resource.title })}\n      >\n        <Card.Header className=\"d-flex accordion\">\n          <button\n            type=\"button\"\n            onClick={() => setExpanded((expanded) => !expanded)}\n            aria-controls={htmlId}\n            aria-expanded={expanded}\n            className={`me-3 w-auto flex-grow-1 d-block text-start collapse-toggle-btn ${\n              expanded ? '' : 'collapsed'\n            }`}\n          >\n            <Badge\n              bg=\"\"\n              className=\"text-bg-light border me-2 user-select-text\"\n              aria-label={t('search.results.resultCountAriaLabel')}\n            >\n              {renderResultsCounter()}\n            </Badge>\n            <span\n              aria-label={t('search.results.resultResourceTitleAriaLabel')}\n              className=\"user-select-text\"\n            >\n              {getBestFromMultilingualValuesTryByLanguage(data.resource.title, locale)}\n            </span>\n            <small\n              className=\"text-muted user-select-text\"\n              aria-label={t('search.results.resultResourceInstitutionAriaLabel')}\n            >\n              {getBestFromMultilingualValuesTryByLanguage(data.resource.institution, locale)}\n            </small>\n          </button>\n          <div className=\"d-inline-block ms-auto\">\n            <Button size=\"sm\" onClick={handleViewClick}>\n              <i dangerouslySetInnerHTML={{ __html: eyeIcon }} /> View\n            </Button>\n          </div>\n        </Card.Header>\n        {/* data-bs-toggle=\"collapse\" data-bs-target=\"#collapseExample\" aria-expanded=\"false\" aria-controls=\"collapseExample\" */}\n        <Collapse in={expanded}>\n          <div id={htmlId}>\n            {/* result details */}\n            {showResourceDetails && (\n              <Card.Body className=\"border-bottom resource-info\">\n                <dl\n                  className=\"mb-0\"\n                  aria-label={t('search.results.resourceInfo.infoTableAriaLabel')}\n                >\n                  <dt>\n                    <i dangerouslySetInnerHTML={{ __html: bankIcon }} />{' '}\n                    {t('search.results.resourceInfo.labelInstitution')}\n                  </dt>\n                  <dd className=\"mb-0\">\n                    {getBestFromMultilingualValuesTryByLanguage(data.resource.institution, locale)}\n                  </dd>\n                  <dt>\n                    <i dangerouslySetInnerHTML={{ __html: infoCircleIcon }} />{' '}\n                    {t('search.results.resourceInfo.labelDescription')}\n                  </dt>\n                  {getBestFromMultilingualValuesTryByLanguage(\n                    data.resource.description,\n                    locale\n                  ) && (\n                    <>\n                      <dd className=\"mb-0\">\n                        {getBestFromMultilingualValuesTryByLanguage(\n                          data.resource.description,\n                          locale\n                        )}\n                      </dd>\n                      <dt>\n                        <i dangerouslySetInnerHTML={{ __html: translateIcon }} />{' '}\n                        {t('search.results.resourceInfo.labelLanguages')}\n                      </dt>\n                    </>\n                  )}\n                  <dd className=\"mb-0\">\n                    {data.resource.languages\n                      .map(\n                        languages\n                          ? (code) =>\n                              languageCodeToName(code, languages, {\n                                defaultAnyLanguage: t('languageCodeToName.any', { ns: 'common' }),\n                                defaultUnknownLanguage: t('languageCodeToName.unknown', {\n                                  ns: 'common',\n                                }),\n                              })\n                          : (x) => x\n                      )\n                      .toSorted()\n                      .join(', ')}\n                  </dd>\n                </dl>\n\n                {languageForResource && languageForResource.length > 1 && (\n                  <ToggleButtonGroup\n                    type=\"radio\"\n                    name={`${data.resource.id}-result-info-languages`}\n                    defaultValue={locale}\n                    onChange={(language) => setLocale(language)}\n                    className=\"mt-2\"\n                  >\n                    {languageForResource.toSorted().map((language) => (\n                      <ToggleButton\n                        variant=\"outline-secondary\"\n                        size=\"sm\"\n                        key={language}\n                        id={`${data.resource.id}-result-info-languages-${language}`}\n                        value={language}\n                      >\n                        {langNames.of(language)} <sup>{language}</sup>\n                      </ToggleButton>\n                    ))}\n                  </ToggleButtonGroup>\n                )}\n              </Card.Body>\n            )}\n            {/* results */}\n            {hasResults && <Card.Body>{renderResults()}</Card.Body>}\n            {/* diagnostics */}\n            {showDiagnostics && hasDiagnostics && (\n              <Card.Body className={hasResults ? 'border-top' : ''}>\n                {/* TODO: aria invisible heading, adjust levels */}\n                {data.exception && (\n                  <Alert\n                    variant=\"danger\"\n                    aria-label={t('search.results.diagnostics.alertAriaLabel')}\n                  >\n                    <Alert.Heading style={{ fontSize: '1rem' }}>\n                      <span className=\"text-uppercase\">\n                        {t('search.results.diagnostics.titleException')}\n                      </span>{' '}\n                      <span aria-label={t('search.results.diagnostics.msgAriaLabel')}>\n                        {data.exception.message}\n                      </span>\n                    </Alert.Heading>\n                    {data.exception.cause && (\n                      <p className=\"mb-0 small\">\n                        {t('search.results.diagnostics.msgCause', { cause: data.exception.cause })}\n                      </p>\n                    )}\n                    {data.exception.klass && (\n                      <p className=\"mb-0 small\">\n                        <Trans\n                          i18nKey=\"search.results.diagnostics.msgCausedBy\"\n                          values={{ class: data.exception.klass }}\n                        />\n                      </p>\n                    )}\n                  </Alert>\n                )}\n                {data.diagnostics\n                  .filter((diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI)\n                  .map((diagnostic) => (\n                    <Alert\n                      variant=\"warning\"\n                      key={`${diagnostic.uri}-${diagnostic.message}-${diagnostic.diagnostic}`}\n                    >\n                      <Alert.Heading style={{ fontSize: '1rem' }}>\n                        {diagnostic.message}\n                      </Alert.Heading>\n                      {diagnostic.diagnostic && (\n                        <p className=\"mb-0 small\">\n                          {t('search.results.diagnostics.msgDiagnosticDetails', {\n                            details: diagnostic.diagnostic,\n                          })}\n                        </p>\n                      )}\n                      <p className=\"mb-0 small\">\n                        <Trans\n                          i18nKey=\"search.results.diagnostics.msgDiagnosticType\"\n                          values={{ uri: diagnostic.uri }}\n                        />\n                        {/* add link to list? */}\n                      </p>\n                    </Alert>\n                  ))}\n              </Card.Body>\n            )}\n          </div>\n        </Collapse>\n      </Card>\n      {showModal && (\n        <ResourceResultsModal\n          show={showModal}\n          searchId={searchId}\n          resourceId={resourceId}\n          result={data}\n          viewMode={viewMode}\n          showDiagnostics={showDiagnostics}\n          onModalClose={handleModalClose}\n        />\n      )}\n    </>\n  )\n}\n\nexport default ResourceSearchResult\n","import type { ResourceSearchResultMetaOnly } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport LocaleStore from '@/stores/locale'\nimport type { Resource } from './api'\nimport { getBestFromMultilingualValuesTryByLanguage } from './resources'\n\nexport type ResultsViewMode = 'plain' | 'kwic' | 'annotation-layers' | 'lexical-entry'\nexport type ResultsSorting =\n  | 'default'\n  | 'title-up'\n  | 'title-down'\n  | 'result-count-total-up'\n  | 'result-count-total-down'\n\n// --------------------------------------------------------------------------\n\nexport const DEFAULT_VIEW_MODE: ResultsViewMode = 'plain'\nexport const DEFAULT_VIEW_MODE_WHEN_LEX: ResultsViewMode = 'lexical-entry'\nexport const DEFAULT_VIEW_MODE_WHEN_FCS: ResultsViewMode = 'plain' // TODO: 'annotation-layers' might be quite UI expensive for unrestricted searches\nexport const DEFAULT_SORTING: ResultsSorting = 'default'\n\n// --------------------------------------------------------------------------\n\nexport const SORT_FNS: {\n  [key in ResultsSorting]: (\n    lookup: Map<string, Resource>\n  ) => (a: ResourceSearchResultMetaOnly, b: ResourceSearchResultMetaOnly) => number\n} = {\n  default: () => () => 0,\n  'title-up': (lookup) => (a, b) => {\n    const locale = LocaleStore.getState().locale\n\n    const titleA =\n      getBestFromMultilingualValuesTryByLanguage(lookup.get(a.id)?.title ?? null, locale) ?? ''\n    const titleB =\n      getBestFromMultilingualValuesTryByLanguage(lookup.get(b.id)?.title ?? null, locale) ?? ''\n\n    return titleA.localeCompare(titleB)\n  },\n  'title-down': (lookup) => (a, b) => {\n    const locale = LocaleStore.getState().locale\n\n    const titleA =\n      getBestFromMultilingualValuesTryByLanguage(lookup.get(a.id)?.title ?? null, locale) ?? ''\n    const titleB =\n      getBestFromMultilingualValuesTryByLanguage(lookup.get(b.id)?.title ?? null, locale) ?? ''\n\n    return -titleA.localeCompare(titleB)\n  },\n  'result-count-total-up': () => (a, b) => {\n    const countA = a.numberOfRecords !== -1 ? a.numberOfRecords : a.numberOfRecordsLoaded\n    const countB = b.numberOfRecords !== -1 ? b.numberOfRecords : b.numberOfRecordsLoaded\n    return countA - countB\n  },\n  'result-count-total-down': () => (a, b) => {\n    const countA = a.numberOfRecords !== -1 ? a.numberOfRecords : a.numberOfRecordsLoaded\n    const countB = b.numberOfRecords !== -1 ? b.numberOfRecords : b.numberOfRecordsLoaded\n    return countB - countA\n  },\n}\n","import { useQuery } from '@tanstack/react-query'\nimport { useEffect, useMemo, useState } from 'react'\nimport Card from 'react-bootstrap/Card'\nimport Col from 'react-bootstrap/Col'\nimport FloatingLabel from 'react-bootstrap/FloatingLabel'\nimport Form from 'react-bootstrap/Form'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Popover from 'react-bootstrap/Popover'\nimport ProgressBar from 'react-bootstrap/ProgressBar'\nimport Row from 'react-bootstrap/Row'\nimport { Trans, useTranslation } from 'react-i18next'\n\nimport type { SearchResultsMetaOnly } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport { getSearchResultsMetaOnly } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport DebouncedFuzzySearchInput from '@/components/DebouncedFuzzySearchInput'\nimport ResourceSearchResult from '@/components/ResourceSearchResult'\nimport { useAggregatorData } from '@/providers/AggregatorDataContext'\nimport { useAxios } from '@/providers/AxiosContext'\nimport { useSearchParams } from '@/providers/SearchParamsContext'\nimport { NO_MORE_RECORDS_DIAGNOSTIC_URI } from '@/utils/constants'\nimport { trackSiteSearch } from '@/utils/matomo'\nimport type { ResultsSorting, ResultsViewMode } from '@/utils/results'\nimport {\n  DEFAULT_SORTING,\n  DEFAULT_VIEW_MODE,\n  DEFAULT_VIEW_MODE_WHEN_FCS,\n  DEFAULT_VIEW_MODE_WHEN_LEX,\n  SORT_FNS,\n} from '@/utils/results'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\nexport const DEFAULT_POLL_DELAY = 1500\n\nexport interface SearchResultsProps {\n  searchId: string\n  pollDelay?: number\n}\n\n// --------------------------------------------------------------------------\n// component\n\n// TODO: make it (search?) cancelable! (useEffect?)\nfunction SearchResults({ searchId, pollDelay = DEFAULT_POLL_DELAY }: SearchResultsProps) {\n  const { t } = useTranslation()\n  const axios = useAxios()\n  const { resources } = useAggregatorData()\n  const { query, queryType, resourceIDs } = useSearchParams()\n\n  // TODO: useTransition for changes?\n\n  const [viewMode, setViewMode] = useState<ResultsViewMode>(\n    queryType === 'lex'\n      ? DEFAULT_VIEW_MODE_WHEN_LEX\n      : queryType === 'fcs'\n      ? DEFAULT_VIEW_MODE_WHEN_FCS\n      : DEFAULT_VIEW_MODE\n  )\n  const [sorting, setSorting] = useState<ResultsSorting>(DEFAULT_SORTING)\n  const [filter, setFilter] = useState('')\n  const [showResourceDetails, setShowResourceDetails] = useState(false)\n  const [showDiagnostics, setShowDiagnostics] = useState(false)\n\n  const sortFn = useMemo(() => {\n    const lookup = new Map()\n    resources?.forEach((resource) => {\n      lookup.set(resource.id, resource)\n    })\n    return SORT_FNS[sorting](lookup)\n  }, [sorting, resources])\n\n  // polling of meta results, dependant on searchId\n  pollDelay ??= DEFAULT_POLL_DELAY\n  const {\n    data,\n    // isLoading: isLoadingSearchResults,\n    // isError: isErrorSearchResults,\n  } = useQuery<SearchResultsMetaOnly>({\n    queryKey: ['search-results', searchId],\n    queryFn: getSearchResultsMetaOnly.bind(null, axios, searchId ?? ''),\n    enabled: !!searchId,\n    refetchInterval(query) {\n      // console.debug('[refetchInterval]', query, query.state.data)\n      if (query.state.data && query.state.data.inProgress > 0) return pollDelay\n      return false\n    },\n  })\n  // console.debug('search-results', data, isLoadingSearchResults, isErrorSearchResults)\n\n  const sortedResults = useMemo(() => data?.results.toSorted(sortFn) || [], [data, sortFn])\n\n  // all successful results use the LexHITS data view, and have Hits with hitKind attributes\n  const isAllLexHITS =\n    queryType === 'lex' &&\n    data?.results.every((result) => result.numberOfRecords <= 0 || result.isLexHits === true)\n\n  const numRequested = resourceIDs.length\n  const numInProgress = data?.inProgress ?? numRequested\n  const numWithResults = useMemo(\n    () =>\n      data?.results.filter(\n        (result) =>\n          (result.numberOfRecords !== -1 ? result.numberOfRecords : result.numberOfRecordsLoaded) >\n          0\n      ).length ?? 0,\n    [data]\n  )\n  const numWithResultsWithWarnings = useMemo(\n    () =>\n      data?.results.filter(\n        (result) =>\n          !result.inProgress &&\n          (result.numberOfRecords !== -1 ? result.numberOfRecords : result.numberOfRecordsLoaded) >\n            0 &&\n          result.diagnostics.filter(\n            (diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI\n          ).length > 0\n      ).length ?? 0,\n    [data]\n  )\n  const numNoResults = useMemo(\n    () =>\n      data?.results.filter(\n        (result) =>\n          !result.inProgress &&\n          (result.numberOfRecords !== -1 ? result.numberOfRecords : result.numberOfRecordsLoaded) <=\n            0 &&\n          result.diagnostics.filter(\n            (diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI\n          ).length === 0 &&\n          result.exception === null\n      ).length ?? 0,\n    [data]\n  )\n  const numNoResultsWithIssues = useMemo(\n    () =>\n      data?.results.filter(\n        (result) =>\n          !result.inProgress &&\n          (result.numberOfRecords !== -1 ? result.numberOfRecords : result.numberOfRecordsLoaded) <=\n            0 &&\n          (result.diagnostics.filter(\n            (diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI\n          ).length > 0 ||\n            result.exception !== null)\n      ).length ?? 0,\n    [data]\n  )\n  const numNoResultsWithExceptions = useMemo(\n    () =>\n      data?.results.filter(\n        (result) => !result.inProgress && result.numberOfRecords <= 0 && result.exception !== null\n      ).length ?? 0,\n    [data]\n  )\n  const numNoResultsWithWarnings = useMemo(\n    () =>\n      data?.results.filter(\n        (result) =>\n          !result.inProgress &&\n          (result.numberOfRecords !== -1 ? result.numberOfRecords : result.numberOfRecordsLoaded) <=\n            0 &&\n          result.diagnostics.filter(\n            (diagnostic) => diagnostic.uri !== NO_MORE_RECORDS_DIAGNOSTIC_URI\n          ).length > 0 &&\n          result.exception === null\n      ).length ?? 0,\n    [data]\n  )\n\n  // TODO: this might not yet be completely correct?\n  const numResultsTotalAvailable = useMemo(\n    () =>\n      data?.results\n        .map((result) =>\n          result.numberOfRecords !== -1 ? result.numberOfRecords : result.numberOfRecordsLoaded\n        )\n        .reduce((acc, cur) => acc + cur, 0) ?? 0,\n    [data]\n  )\n  const numResultsTotalLoaded = useMemo(\n    () =>\n      data?.results\n        .map((result) => result.numberOfRecordsLoaded)\n        .reduce((acc, cur) => acc + cur, 0) ?? 0,\n    [data]\n  )\n\n  // TODO: add total result counter?\n\n  // --------------------------------------------------------------\n\n  if (import.meta.env.FEATURE_TRACKING_MATOMO) {\n    /* eslint-disable react-hooks/rules-of-hooks */\n    const [sent, setSent] = useState(false)\n    useEffect(() => {\n      if (data && numInProgress === 0) {\n        if (!sent) {\n          setSent(true)\n\n          // TODO: sum total (not yet requested) or only loaded by user\n          trackSiteSearch(query, queryType, numResultsTotalLoaded)\n        }\n      }\n    }, [data, numInProgress, query, queryType, searchId, sent, numResultsTotalLoaded])\n  }\n\n  // --------------------------------------------------------------\n  // event handlers\n\n  function handleViewModeChange(event: React.ChangeEvent<HTMLSelectElement>) {\n    // console.debug('viewmode#onchange', viewMode, '=>', event.target.value)\n    setViewMode(event.target.value as ResultsViewMode)\n  }\n\n  function handleSortingChange(event: React.ChangeEvent<HTMLSelectElement>) {\n    // console.debug('sorting#onchange', sorting, '=>', event.target.value)\n    setSorting(event.target.value as ResultsSorting)\n  }\n\n  // --------------------------------------------------------------\n  // rendering\n\n  // TODO: add filter for exact vs. fuzzy/normalised search results\n\n  return (\n    <div id=\"search-results\" className=\"mt-2 mb-4\">\n      {/* TODO: add visually-hidden title for semantic site structure */}\n      {/* TODO: add tooltip with easier to read information */}\n      {/* TODO: mobile design: hide labels and maybe add below? */}\n      <OverlayTrigger\n        placement=\"auto\"\n        overlay={\n          <Popover id=\"search-progress-information-popover\">\n            <Popover.Header>{t('search.results.progressPopover.title')}</Popover.Header>\n            <Popover.Body style={{ textIndent: '2rem hanging' }}>\n              {/* XXX.toString().padStart(4, '\\u00A0'), */}\n              <div>\n                <Trans\n                  i18nKey=\"search.results.progressPopover.numResourcesRequested\"\n                  count={numRequested}\n                />\n              </div>\n              {numInProgress > 0 && (\n                <div>\n                  <Trans\n                    i18nKey=\"search.results.progressPopover.numResourcesRequestedPending\"\n                    count={numInProgress}\n                  />\n                </div>\n              )}\n              <hr className=\"mt-2 mb-1\" />\n              <div>\n                <Trans\n                  i18nKey=\"search.results.progressPopover.numResourcesWithoutResults\"\n                  count={numNoResults + numNoResultsWithIssues}\n                />\n              </div>\n              <div>\n                <Trans\n                  i18nKey=\"search.results.progressPopover.numResourcesWithoutResultsOK\"\n                  count={numNoResults}\n                />\n              </div>\n              {/*\n              <div>\n                <Trans\n                  i18nKey=\"search.results.progressPopover.numResourcesWithoutResultsErrorsWarnings\"\n                  count={numNoResultsWithIssues}\n                />\n              </div>\n              */}\n              {numNoResultsWithWarnings > 0 && (\n                <div>\n                  <Trans\n                    i18nKey=\"search.results.progressPopover.numResourcesWithoutResultsWarnings\"\n                    count={numNoResultsWithWarnings}\n                  />\n                </div>\n              )}\n              {numNoResultsWithExceptions > 0 && (\n                <div>\n                  <Trans\n                    i18nKey=\"search.results.progressPopover.numResourcesWithoutResultsErrors\"\n                    count={numNoResultsWithExceptions}\n                  />\n                </div>\n              )}\n              <hr className=\"mt-2 mb-1\" />\n              <div>\n                <Trans\n                  i18nKey=\"search.results.progressPopover.numResourcesWithResults\"\n                  count={numWithResults}\n                />\n              </div>\n              {numWithResultsWithWarnings > 0 && (\n                <div>\n                  <Trans\n                    i18nKey=\"search.results.progressPopover.numResourcesWithResultsWarnings\"\n                    count={numWithResultsWithWarnings}\n                  />\n                </div>\n              )}\n              <hr className=\"mt-2 mb-0\" />\n              <hr className=\"mt-1 mb-1\" />\n              <div>\n                <Trans\n                  i18nKey=\"search.results.progressPopover.numResourcesWithResultsTotal\"\n                  count={numResultsTotalLoaded}\n                  values={{ available: numResultsTotalAvailable }}\n                />\n              </div>\n            </Popover.Body>\n          </Popover>\n        }\n      >\n        <ProgressBar className=\"mb-3\">\n          <ProgressBar\n            variant=\"success\"\n            now={numWithResults}\n            max={numRequested}\n            label={\n              <span>\n                {t('search.results.progressBar.numWithResults', { count: numWithResults })}\n              </span>\n            }\n            aria-label={t('search.results.progressBar.numWithResultsAriaLabel')}\n          />\n          <ProgressBar\n            variant=\"secondary\"\n            now={numNoResults + numNoResultsWithIssues}\n            max={numRequested}\n            label={\n              <span>\n                {t('search.results.progressBar.numWithoutResults', {\n                  count: numNoResults + numNoResultsWithIssues,\n                })}\n              </span>\n            }\n            aria-label={t('search.results.progressBar.numWithoutResultsAriaLabel')}\n          />\n          <ProgressBar\n            striped\n            animated\n            now={numInProgress}\n            max={numRequested}\n            label={\n              <span>\n                {t('search.results.progressBar.numResultsPending', { count: numInProgress })}\n              </span>\n            }\n            aria-label={t('search.results.progressBar.numResultsPendingAriaLabel')}\n          />\n        </ProgressBar>\n      </OverlayTrigger>\n\n      <Card\n        className=\"mb-2\"\n        role=\"group\"\n        aria-label={t('search.results.displayOptions.cardAriaLabel')}\n      >\n        <Card.Body>\n          <Row className=\"row-gap-2\">\n            <Col lg={'auto'} md={6} sm={6}>\n              <FloatingLabel\n                label={t('search.results.displayOptions.viewModeLabel')}\n                controlId=\"results-view-mode\"\n              >\n                <Form.Select value={viewMode} onChange={handleViewModeChange}>\n                  <option value=\"plain\">\n                    {t('search.results.displayOptions.viewModeOptions.plain')}\n                  </option>\n                  {/* maybe allow kwic for LexCQL if not a LexHITS data view */}\n                  {(queryType !== 'lex' || !isAllLexHITS) && (\n                    <option value=\"kwic\">\n                      {t('search.results.displayOptions.viewModeOptions.kwic')}\n                    </option>\n                  )}\n                  {queryType === 'fcs' && (\n                    <option value=\"annotation-layers\">\n                      {t('search.results.displayOptions.viewModeOptions.annotation-layers')}\n                    </option>\n                  )}\n                  {queryType === 'lex' && (\n                    <option value=\"lexical-entry\">\n                      {t('search.results.displayOptions.viewModeOptions.lexical-entry')}\n                    </option>\n                  )}\n                </Form.Select>\n              </FloatingLabel>\n            </Col>\n            <Col lg={'auto'} md={6} sm={6}>\n              <FloatingLabel\n                label={t('search.results.displayOptions.sortingLabel')}\n                controlId=\"results-sorting\"\n              >\n                <Form.Select value={sorting} onChange={handleSortingChange}>\n                  <option value=\"default\">\n                    {t('search.results.displayOptions.sortingOptions.default')}\n                  </option>\n                  <option value=\"title-up\">\n                    {t('search.results.displayOptions.sortingOptions.title-up')}\n                  </option>\n                  <option value=\"title-down\">\n                    {t('search.results.displayOptions.sortingOptions.title-down')}\n                  </option>\n                  <option value=\"result-count-total-up\">\n                    {t('search.results.displayOptions.sortingOptions.result-count-total-up')}\n                  </option>\n                  <option value=\"result-count-total-down\">\n                    {t('search.results.displayOptions.sortingOptions.result-count-total-down')}\n                  </option>\n                </Form.Select>\n              </FloatingLabel>\n            </Col>\n            <Col lg={'auto'} md={12} sm={6} className=\"flex-fill order-xl-4\">\n              <FloatingLabel\n                label={t('search.results.displayOptions.resultFilterQueryLabel')}\n                controlId=\"result-filter\"\n              >\n                <DebouncedFuzzySearchInput\n                  disabled={sorting !== 'default' || true} // TODO: implement\n                  value={filter}\n                  onChange={(value) => setFilter(value)}\n                />\n              </FloatingLabel>\n            </Col>\n            <Col lg={'auto'} md={12} sm={12} className=\"align-content-center order-xl-3\">\n              <Form.Check\n                checked={showResourceDetails}\n                onChange={() => setShowResourceDetails((show) => !show)}\n                id=\"results-view-resource-details\"\n                label={t('search.results.displayOptions.optionShowResultDetails')}\n              />\n              <Form.Check\n                checked={showDiagnostics}\n                onChange={() => setShowDiagnostics((show) => !show)}\n                id=\"results-view-warnings-errors\"\n                label={t('search.results.displayOptions.optionShowWarningsErrors')}\n              />\n            </Col>\n          </Row>\n        </Card.Body>\n      </Card>\n\n      {searchId &&\n        data &&\n        sortedResults.map((result) => (\n          <ResourceSearchResult\n            searchId={searchId}\n            resourceId={result.id}\n            resultInfo={result}\n            viewMode={viewMode}\n            showResourceDetails={showResourceDetails}\n            showDiagnostics={showDiagnostics}\n            key={`${searchId}-${result.id}`}\n          />\n        ))}\n    </div>\n  )\n}\n\nexport default SearchResults\n","export default \"__VITE_ASSET__Dc8hwzzm__\"","export default \"__VITE_ASSET__CWrEyLdA__\"","import { useMutation, useQuery } from '@tanstack/react-query'\nimport { useEffect, useState } from 'react'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport Spinner from 'react-bootstrap/Spinner'\nimport Toast from 'react-bootstrap/Toast'\nimport ToastContainer from 'react-bootstrap/ToastContainer'\nimport { Helmet } from 'react-helmet-async'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { useSearchParams } from 'react-router'\n\nimport type { ExtraScopingParams } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport {\n  getInitData,\n  postSearch,\n  REQ_PARAM_CONSORTIA,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport { AggregatorDataProvider } from '@/providers/AggregatorDataContext'\nimport { useAxios } from '@/providers/AxiosContext'\nimport { SearchParamsProvider } from '@/providers/SearchParamsContext'\nimport AppStore from '@/stores/app'\nimport type { Resource } from '@/utils/api'\nimport { trackSiteSearch } from '@/utils/matomo'\nimport {\n  evaluateAggregationContext,\n  fromApi,\n  getResourceIDs,\n  getResourceIDsBySplit,\n} from '@/utils/resources'\nimport type { LanguageCode2NameMap } from '@/utils/search'\nimport type { SearchData } from './SearchInput'\nimport SearchInput from './SearchInput'\nimport SearchResults from './SearchResults'\nimport type { ToastMessage } from './utils'\n\nimport fcsLogoDarkModeUrl from '@images/logo-fcs-dark.png'\nimport fcsLogoUrl from '@images/logo-fcs.png'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// component\n\nfunction Search() {\n  const axios = useAxios()\n  const { t } = useTranslation()\n\n  const [urlSearchParams, setUrlSearchParams] = useSearchParams()\n\n  // REST API state\n  const [resources, setResources] = useState<Resource[]>([])\n  const [languages, setLanguages] = useState<LanguageCode2NameMap>({})\n  const [weblichtLanguages, setWeblichtLanguages] = useState<string[]>([])\n\n  const [searchResourceIDs, setSearchResourceIDs] = useState<string[] | null>(null)\n\n  const [hasSearch, setHasSearch] = useState(false)\n  const [searchParams, setSearchParams] = useState<SearchData | null>(null)\n\n  const [toasts, setToasts] = useState<ToastMessage[]>([])\n\n  const appTitleHead = AppStore.getState().appTitleHead\n  const authEnabled = AppStore.getState().authEnabled\n  const isAuthenticated = AppStore.getState().isAuthenticated\n\n  // ------------------------------------------------------------------------\n  // initialization\n\n  const extraParams = {\n    consortia: urlSearchParams.get(REQ_PARAM_CONSORTIA),\n  } satisfies ExtraScopingParams\n  const { data, isLoading, isError } = useQuery({\n    queryKey: ['init'],\n    queryFn: getInitData.bind(null, axios, extraParams),\n  })\n\n  useEffect(() => {\n    if (!data) return\n\n    // do some initialization (based on `data`)\n    const newResources = fromApi(data.resources)\n\n    // set state\n    setLanguages(data.languages)\n    setWeblichtLanguages(data.weblichtLanguages)\n    setResources(newResources)\n\n    // initialization (hack) to select all resources\n    if (import.meta.env.FEATURE_AUTHENTICATION && authEnabled) {\n      // filter resources by authentication, free === true, false otherwise\n      const resourcesByAuth = getResourceIDsBySplit(newResources, (resource: Resource) =>\n        resource.availabilityRestriction === 'NONE' ? true : false\n      )\n      console.log('resourcesByAuth', resourcesByAuth)\n      const numberOfAuthOnlyRessources = (resourcesByAuth.get(false) ?? []).length\n      if (!isAuthenticated && numberOfAuthOnlyRessources > 0) {\n        console.log(\n          'Not authenticated, dropping resources from default selection',\n          resourcesByAuth.get(false)\n        )\n        const authFreeResources = resourcesByAuth.get(true)!\n        setSearchResourceIDs(authFreeResources)\n\n        setToasts((toasts) => [\n          ...toasts,\n          {\n            title: t('search.toasts.resourceSelection.title'),\n            body: (\n              <>\n                <Trans\n                  i18nKey=\"search.toasts.resourceSelection.msgAuthOnlyResourcesNotSelected\"\n                  count={numberOfAuthOnlyRessources}\n                />\n                <br />\n                <ul className=\"ps-3\">\n                  {(resourcesByAuth.get(false) ?? []).map((rid) => (\n                    <li key={rid} style={{ wordBreak: 'break-all', fontSize: '0.7rem' }}>\n                      {rid}\n                    </li>\n                  ))}\n                </ul>\n              </>\n            ),\n            variant: 'success',\n          },\n        ])\n      } else {\n        setSearchResourceIDs(getResourceIDs(newResources))\n      }\n    } else {\n      setSearchResourceIDs(getResourceIDs(newResources))\n    }\n  }, [data, authEnabled, isAuthenticated, t])\n\n  useEffect(() => {\n    console.debug('searchParams', urlSearchParams)\n    if (!resources || resources.length === 0) return\n\n    const aggregationContext = urlSearchParams.get('x-aggregation-context')\n    if (aggregationContext) {\n      try {\n        const endpoints2handles = JSON.parse(aggregationContext)\n\n        // TODO: evaluate if correct and what format\n        // TODO: support easier resource IDs list format\n\n        const { selected, unavailable } = evaluateAggregationContext(resources, endpoints2handles)\n        console.debug('aggregationContext', {\n          aggregationContext,\n          resources,\n          endpoints2handles,\n          evaluated: { selected, unavailable },\n        })\n\n        // TODO: check if selected resources require auth and user is unauthenticated?\n\n        if (selected.length > 0) {\n          setSearchResourceIDs(selected)\n\n          setToasts((toasts) => [\n            ...toasts,\n            {\n              title: t('search.toasts.resourceSelection.title'),\n              body: (\n                <>\n                  <Trans\n                    i18nKey=\"search.toasts.resourceSelection.msgPreselectedResources\"\n                    count={selected.length}\n                  />\n                  <br />\n                  <ul className=\"ps-3\">\n                    {selected.map((rid) => (\n                      <li style={{ wordBreak: 'break-all', fontSize: '0.7rem' }}>{rid}</li>\n                    ))}\n                  </ul>\n                </>\n              ),\n              variant: 'success',\n            },\n          ])\n        }\n        if (unavailable.length > 0) {\n          setToasts((toasts) => [\n            ...toasts,\n            {\n              title: t('search.toasts.resourceSelection.title'),\n              body: (\n                <>\n                  <Trans\n                    i18nKey=\"search.toasts.resourceSelection.msgUnableToSelectResources\"\n                    count={unavailable.length}\n                  />\n                  <br />\n                  <ul className=\"ps-3\">\n                    {unavailable.map((rid) => (\n                      <li style={{ wordBreak: 'break-all', fontSize: '0.7rem' }}>{rid}</li>\n                    ))}\n                  </ul>\n                </>\n              ),\n              variant: 'warning',\n            },\n          ])\n        }\n      } catch (error) {\n        console.error(\n          'Error trying to parse \"x-aggregation-context\" search parameter!',\n          {\n            aggregationContext,\n          },\n          error\n        )\n        if (error instanceof Error) {\n          setToasts((toasts) => [\n            ...toasts,\n            {\n              title: t('search.toasts.resourceSelection.title'),\n              body: (\n                <>\n                  {t('search.toasts.resourceSelection.msgErrorUnableToSelectResources', {\n                    error: error.name,\n                  })}\n                  <br />\n                  <small>{error.message}</small>\n                </>\n              ),\n              variant: 'error',\n            },\n          ])\n        }\n      }\n      // remove after use, will trigger next evaluation of URLSearchParams ...\n      // setUrlSearchParams((params) => (params.delete('x-aggregation-context'), params))\n      urlSearchParams.delete('x-aggregation-context')\n      setUrlSearchParams(urlSearchParams)\n    }\n  }, [resources, urlSearchParams, setUrlSearchParams, t])\n\n  // ------------------------------------------------------------------------\n\n  // on state update, this component is re-evaluated which re-evaluates the expressions below, too\n  const isInputDisabled = isLoading || isError\n  // console.debug('isInputDisabled', isInputDisabled, 'isLoading', isLoading, 'isError', isError)\n\n  // ------------------------------------------------------------------------\n  // search request\n\n  // the actual search\n  const {\n    mutate: mutateSearch,\n    data: searchId,\n    error: searchError,\n    isPending: isSearchPending,\n    isError: isSearchError,\n  } = useMutation({\n    mutationKey: ['search'],\n    mutationFn: ({ query, queryType, language, numberOfResults, resourceIDs }: SearchData) =>\n      postSearch(axios, {\n        query,\n        queryType,\n        language,\n        numberOfResults: numberOfResults.toString(),\n        resourceIds: resourceIDs,\n      }),\n  })\n  console.debug('searchId', { searchId, searchError, isSearchPending, isSearchError })\n\n  // ------------------------------------------------------------------------\n  // event handlers\n\n  function handleSearch(searchData: SearchData) {\n    console.debug('start search:', searchData)\n\n    setSearchResourceIDs(searchData.resourceIDs)\n\n    setSearchParams(searchData)\n    setHasSearch(true)\n\n    if (import.meta.env.FEATURE_TRACKING_MATOMO) {\n      trackSiteSearch(searchData.query, searchData.queryType)\n    }\n\n    mutateSearch(searchData)\n  }\n\n  function handleShowToast(toast: ToastMessage) {\n    setToasts((toasts) => [...toasts, toast])\n  }\n\n  // ------------------------------------------------------------------------\n  // utilities\n\n  // ------------------------------------------------------------------------\n  // UI\n\n  return (\n    <>\n      <Helmet>\n        <title>{appTitleHead}</title>\n      </Helmet>\n      <Container id=\"search\">\n        {/* toasters */}\n        <div aria-live=\"polite\" aria-atomic=\"true\" className=\"bg-dark position-relative\">\n          {/* TODO: animate? */}\n          <ToastContainer position=\"top-end\" className=\"mt-2\" style={{ zIndex: 100 }}>\n            {toasts.map((toast, index) => (\n              <Toast\n                bg={toast.variant}\n                key={index}\n                // show={toasts.find((oldToast) => oldToast === toast) !== undefined}\n                onClose={() =>\n                  setToasts((toasts) => toasts.filter((oldToast) => oldToast !== toast))\n                }\n                delay={toast.delay ?? 5000}\n                autohide\n              >\n                <Toast.Header closeButton={true}>\n                  <strong className=\"me-auto\">{toast.title}</strong>\n                </Toast.Header>\n                <Toast.Body>{toast.body}</Toast.Body>\n              </Toast>\n            ))}\n          </ToastContainer>\n        </div>\n\n        {/* logo image */}\n        {!hasSearch && (\n          <Row>\n            <Col className=\"text-center\">\n              <picture>\n                <source srcSet={fcsLogoUrl} media=\"(prefers-color-scheme: light)\" />\n                <source srcSet={fcsLogoDarkModeUrl} media=\"(prefers-color-scheme: dark)\" />\n                <img src={fcsLogoUrl} className=\"logo\" alt=\"FCS logo\" />\n              </picture>\n            </Col>\n          </Row>\n        )}\n\n        {/* search input */}\n        <Row className=\"mt-3\">\n          <Col>\n            <SearchInput\n              resources={resources}\n              languages={languages}\n              availableResources={null}\n              selectedResources={searchResourceIDs}\n              onSearch={handleSearch}\n              onShowToast={handleShowToast}\n              hasSearch={hasSearch}\n              disabled={isInputDisabled}\n            />\n          </Col>\n        </Row>\n\n        {/* short intro text on initial visit/site load */}\n        {!hasSearch && (\n          <Row className=\"mt-3\">\n            <Col>\n              <p>\n                <Trans i18nKey=\"search.intro.textGeneral\" />\n              </p>\n              <p>\n                <Trans\n                  i18nKey=\"search.intro.textLearnMore\"\n                  components={[\n                    <a href={t('search.intro.url')}>\n                      page <em>Content Search</em> at CLARIN.eu\n                    </a>,\n                  ]}\n                />\n              </p>\n            </Col>\n          </Row>\n        )}\n\n        {hasSearch && isSearchPending && (\n          <Row>\n            <Col className=\"text-center my-5\">\n              <Spinner animation=\"border\" />\n            </Col>\n          </Row>\n        )}\n        {searchParams && searchId && (\n          <AggregatorDataProvider\n            resources={resources}\n            languages={languages}\n            weblichtLanguages={weblichtLanguages}\n          >\n            <SearchParamsProvider {...searchParams}>\n              <SearchResults searchId={searchId} />\n            </SearchParamsProvider>\n          </AggregatorDataProvider>\n        )}\n      </Container>\n    </>\n  )\n}\n\nexport default Search\n","import { useCallback } from 'react'\nimport type { NavigateOptions } from 'react-router'\nimport { generatePath, useNavigate as useReactRouterNavigate } from 'react-router'\n\nimport useKeepSearchParams from './useKeepSearchParams'\n\n// --------------------------------------------------------------------------\n\n/**\n * Returns a `navigate` method to update the browser `location` using a route template path and optional params.\n *\n * @see {@link generatePath}\n * @see {@link navigate} returned hook method to perform navigation (update `location`)\n * @see {@link useReactRouterNavigate|useNavigate} `react-router`'s navigation hook\n * @see {@link useKeepSearchParams} used to persist certain search parameters after navigation\n * @category Hooks\n */\nexport default function useNavigate() {\n  const routerNavigate = useReactRouterNavigate()\n  const [search] = useKeepSearchParams()\n\n  /**\n   * Do a `location` update using a path and parameters.\n   *\n   * NOTE: will keep stable search parameters using {@link useKeepSearchParams}!\n   *\n   * @param originalPath template path\n   * @param params parameters for path interpolation\n   * @param options options for `react-router`'s {@link useReactRouterNavigate|useNavigate}\n   *\n   * @see {@link generatePath}\n   */\n  const navigate = useCallback(\n    (\n      originalPath: string,\n      params?: {\n        [key: string]: string | null\n      },\n      options?: NavigateOptions\n      // TODO: add option to ignore stable search params?\n    ) => {\n      const newPath = generatePath(originalPath, params)\n      console.debug('navigate', { newPath, originalPath, params, search, options })\n      routerNavigate({ pathname: newPath, search: search }, options)\n    },\n    [routerNavigate, search]\n  )\n\n  return navigate\n}\n","import { useContext } from 'react'\nimport { matchRoutes, UNSAFE_RouteContext, useLocation } from 'react-router'\n\n// --------------------------------------------------------------------------\n\n/**\n * Returns the `react-router` route match or `null` if no matching routes.\n *\n * NOTE: uses the {@link UNSAFE_RouteContext} interface to access defined routes!\n *\n * @see {@link useLocation}\n * @see {@link matchRoutes}\n * @category Hooks\n */\nexport default function useRouteMatch() {\n  const routeContext = useContext(UNSAFE_RouteContext)\n  const location = useLocation()\n\n  const routes = routeContext.matches.map((m) => m.route)\n  const routeMatch = matchRoutes(routes, location)\n\n  if (routeMatch !== null && routeMatch.length > 0) {\n    return routeMatch[0]\n  }\n  return null\n}\n","import { useEffect, useRef } from 'react'\n\n// credit: https://stackoverflow.com/a/57706747/9360161\n// TODO: look into https://stackoverflow.com/a/59307806/9360161\n\nexport default function usePrevious<T>(value: T): T | undefined {\n  const ref = useRef<T>()\n  useEffect(() => {\n    ref.current = value\n  })\n  return ref.current\n}\n","export const REQ_PARAM_RESOURCE_ID = 'resource'\n","import { useAxios } from '@/providers/AxiosContext'\nimport { useQuery, useQueryClient } from '@tanstack/react-query'\nimport { useEffect, useState } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Card from 'react-bootstrap/Card'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Form from 'react-bootstrap/Form'\nimport Row from 'react-bootstrap/Row'\nimport Table from 'react-bootstrap/Table'\nimport { useTranslation } from 'react-i18next'\nimport { Link, useSearchParams } from 'react-router'\n\nimport type {\n  AvailabilityRestriction,\n  Capability,\n  Consortium,\n  ExtraScopingParams,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport {\n  getLanguages,\n  getResources,\n  REQ_PARAM_CONSORTIA,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport LanguageModal from '@/components/LanguageModal'\nimport useKeepSearchParams from '@/hooks/useKeepSearchParams'\nimport usePrevious from '@/hooks/usePrevious'\nimport { useLocaleStore } from '@/stores/locale'\nimport type { Resource } from '@/utils/api'\nimport {\n  flattenResources,\n  fromApi,\n  getBestFromMultilingualValuesTryByLanguage,\n} from '@/utils/resources'\nimport type { LanguageCode2NameMap } from '@/utils/search'\nimport { REQ_PARAM_RESOURCE_ID } from './utils'\n\nimport eyeIcon from 'bootstrap-icons/icons/eye-fill.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n\ntype ResourceInstitutionVariantOptions = 'institution' | 'hoster'\ntype URLVariantOptions = 'url' | 'domain' | 'tld'\n\nconst DEFAULT_RESOURCE_INSTITUTION_VARIANT: ResourceInstitutionVariantOptions = 'institution'\nconst DEFAULT_URL_VARIANT: URLVariantOptions = 'url'\n\n// --------------------------------------------------------------------------\n\nfunction extractTLD(url: string): string {\n  // TODO: best effort TLD extraction\n  const domain = new URL(url).hostname\n  const parts = domain.split('.')\n\n  // this should not be possible\n  if (parts.length <= 1) return domain\n\n  const lastTLDPart = parts.at(-1)!\n\n  // if only two parts, the last is the TLD\n  if (parts.length === 2) return lastTLDPart\n\n  const preLastTLDPart = parts.at(-2)!\n\n  // NOTE: heuristic to check if parts are too short...\n  if (\n    (lastTLDPart.length === 2 && preLastTLDPart.length === 2) ||\n    (lastTLDPart.length === 3 && preLastTLDPart.length === 2)\n  ) {\n    return `${preLastTLDPart}.${lastTLDPart}`\n  }\n\n  return lastTLDPart\n}\n\nfunction extractMainDomain(url: string): string {\n  const tld = extractTLD(url)\n\n  const parsed = new URL(url)\n  const domain = parsed.hostname\n  const domainWithoutTLD = domain.slice(0, -(tld.length + 1))\n\n  const parts = domainWithoutTLD.split('.')\n  const mainDomainPart = parts.slice(-1)\n\n  const shortDomain = `${mainDomainPart}.${tld}`\n\n  if (parsed.port) {\n    return `${shortDomain}:${parsed.port}`\n  }\n  return shortDomain\n}\n\nfunction getSURT(url: string): string[] {\n  const parsed = new URL(url)\n  const domain = parsed.hostname\n  const domainSURT = domain.split('.').toReversed()\n  const restOfURL = url.substring(\n    url.indexOf('/', parsed.protocol.length + 2 + parsed.hostname.length)\n  )\n  // ignore protocol\n  return [...domainSURT, parsed.port, restOfURL]\n}\n\nfunction sortBySURT(urlA: string, urlB: string) {\n  const surtA = getSURT(urlA)\n  const surtB = getSURT(urlB)\n  const len = Math.min(surtA.length, surtB.length)\n  for (let i = 0; i < len; i++) {\n    const fragmentA = surtA[i]\n    const fragmentB = surtB[i]\n    const res = fragmentA.localeCompare(fragmentB)\n    if (res !== 0) return res\n  }\n  return 0\n}\n\nconst searchCapabilityPriority: Map<Capability, number> = new Map([\n  ['BASIC_SEARCH', 0],\n  ['ADVANCED_SEARCH', 1],\n  ['LEX_SEARCH', 2],\n  ['AUTHENTICATED_SEARCH', 3],\n])\n\nfunction compareSearchCapability(capabilityA: Capability, capabilityB: Capability) {\n  const priorityA = searchCapabilityPriority.get(capabilityA)\n  const priorityB = searchCapabilityPriority.get(capabilityB)\n  // any unknown value is moved to end\n  if (priorityA === undefined) return +1\n  if (priorityB === undefined) return -1\n  // default sort (with lookup searchCapabilityPriority)\n  return priorityA - priorityB\n}\n\n// --------------------------------------------------------------------------\n// component\n\nfunction FCSStatistics() {\n  const axios = useAxios()\n  const queryClient = useQueryClient()\n  const { t } = useTranslation()\n\n  const userLocale = useLocaleStore((state) => state.locale)\n  // const [locale, setLocale] = useState(userLocale)\n  // const langNames = new Intl.DisplayNames([userLocale, 'en'], { type: 'language' })\n\n  const [, getLinkSearch] = useKeepSearchParams()\n  const [urlSearchParams, setUrlSearchParams] = useSearchParams()\n\n  const [resources, setResources] = useState<Resource[]>([])\n  const [resourcesAll, setResourcesAll] = useState<Resource[]>([])\n  const [languages, setLanguages] = useState<LanguageCode2NameMap>({})\n\n  const [selectedResourceInstitutionVariantOption, setSelectedResourceInstitutionVariantOption] =\n    useState<ResourceInstitutionVariantOptions>(DEFAULT_RESOURCE_INSTITUTION_VARIANT)\n  const [selectedEndpointURLVariantOption, setSelectedEndpointURLVariantOption] =\n    useState<URLVariantOptions>(DEFAULT_URL_VARIANT)\n  const [showLanguageSelectionModal, setShowLanguageSelectionModal] = useState(false)\n\n  // ------------------------------------------------------------------------\n  // initialization\n\n  const consortia = urlSearchParams.get(REQ_PARAM_CONSORTIA)?.split(',') ?? []\n\n  const extraParams = {\n    consortia: urlSearchParams.get(REQ_PARAM_CONSORTIA),\n  } satisfies ExtraScopingParams\n  const {\n    data: dataResources,\n    isPending: isPendingResources,\n    isError: isErrorResources,\n    error: errorResources,\n  } = useQuery({\n    queryKey: ['resources'],\n    queryFn: getResources.bind(null, axios, extraParams),\n  })\n  const {\n    data: dataLanguages,\n    isPending: isPendingLanguages,\n    isError: isErrorLanguages,\n    error: errorLanguages,\n  } = useQuery({\n    queryKey: ['languages'],\n    queryFn: getLanguages.bind(null, axios, extraParams),\n  })\n\n  // conditional data\n  const {\n    data: dataResourcesAll,\n    isPending: isPendingResourcesAll,\n    isError: isErrorResourcesAll,\n    error: errorResourcesAll,\n  } = useQuery({\n    queryKey: ['resources-all'],\n    queryFn: import.meta.env.SHOW_CONSORTIA_INFO\n      ? getResources.bind(null, axios, undefined)\n      : () => [],\n  })\n\n  useEffect(() => {\n    if (!dataResources) return\n    // do some initialization (based on `dataResources`)\n    const newResources = fromApi(dataResources)\n    // set state\n    setResources(newResources)\n  }, [dataResources])\n  useEffect(() => {\n    if (!dataLanguages) return\n    setLanguages(dataLanguages)\n  }, [dataLanguages])\n\n  if (import.meta.env.SHOW_CONSORTIA_INFO) {\n    // NOTE: intential for conditional build (either it exists or not)\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    useEffect(() => {\n      if (!dataResourcesAll) return\n      setResourcesAll(fromApi(dataResourcesAll))\n    }, [dataResourcesAll])\n\n    // invalidate every query to refresh data\n    // BUT only run if consortia query param changed\n    // NOTE: needs to be delayed as API requests and URL change race each other...\n    const consortia = urlSearchParams.get(REQ_PARAM_CONSORTIA)\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const prevConsortia = usePrevious(consortia)\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    useEffect(() => {\n      const newConsortia = urlSearchParams.get(REQ_PARAM_CONSORTIA)\n      if (prevConsortia !== newConsortia) queryClient.invalidateQueries()\n    }, [prevConsortia, queryClient, urlSearchParams])\n  }\n\n  // ------------------------------------------------------------------------\n\n  const flatResources = flattenResources(resources)\n\n  const endpointURLsWithResources = flatResources.reduce((map, resource) => {\n    const url = resource.endpoint.url\n    if (!map.has(url)) map.set(url, [])\n    map.get(url)!.push(resource)\n    return map\n  }, new Map<string, Resource[]>())\n  const endpointDomainsWithURLs = Array.from(endpointURLsWithResources.keys()).reduce(\n    (map, url) => {\n      const domain = extractMainDomain(url)\n      if (!map.has(domain)) map.set(domain, [])\n      map.get(domain)!.push(url)\n      return map\n    },\n    new Map<string, string[]>()\n  )\n  const endpointTLDsWithURLs = Array.from(endpointURLsWithResources.keys()).reduce((map, url) => {\n    const tld = extractTLD(url)\n    if (!map.has(tld)) map.set(tld, [])\n    map.get(tld)!.push(url)\n    return map\n  }, new Map<string, string[]>())\n  const endpointURLsWithSearchCapabilities = flatResources.reduce((map, resource) => {\n    const url = resource.endpoint.url\n    if (!map.has(url)) map.set(url, new Set())\n    const searchCapabilities = map.get(url)!\n    resource.endpoint.searchCapabilities.forEach((capability) => searchCapabilities.add(capability))\n    return map\n  }, new Map<string, Set<Capability>>())\n\n  const institutionsWithResources = flatResources.reduce((map, resource) => {\n    const institution =\n      getBestFromMultilingualValuesTryByLanguage(resource.institution, userLocale) ??\n      resource.endpointInstitution.name\n    if (!map.has(institution)) map.set(institution, [])\n    map.get(institution)!.push(resource)\n    return map\n  }, new Map<string, Resource[]>())\n  const endpointInstitutionsWithResources = flatResources.reduce((map, resource) => {\n    const institution = resource.endpointInstitution.name\n    if (!map.has(institution)) map.set(institution, [])\n    map.get(institution)!.push(resource)\n    return map\n  }, new Map<string, Resource[]>())\n\n  const searchCapabilitiesWithResources = flatResources.reduce((map, resource) => {\n    const capabilities = resource.searchCapabilitiesResolved\n    for (const capability of capabilities) {\n      if (!map.has(capability)) map.set(capability, [])\n      map.get(capability)!.push(resource)\n    }\n    return map\n  }, new Map<Capability, Resource[]>())\n  const availabilityRestrictionsWithResources = flatResources.reduce((map, resource) => {\n    const restriction = resource.availabilityRestriction\n    if (!map.has(restriction)) map.set(restriction, [])\n    map.get(restriction)!.push(resource)\n    return map\n  }, new Map<AvailabilityRestriction, Resource[]>())\n\n  const consortiaWithResources = import.meta.env.SHOW_CONSORTIA_INFO\n    ? flattenResources(resourcesAll).reduce((map, resource) => {\n        const consortium = resource.endpointInstitution.consortium ?? null\n        if (!map.has(consortium)) {\n          map.set(consortium, { resources: [], endpoints: new Set<string>() })\n        }\n        const consortiumData = map.get(consortium)!\n        consortiumData.resources.push(resource)\n        consortiumData.endpoints.add(resource.endpoint.url)\n        return map\n      }, new Map<Consortium | null, { resources: Resource[]; endpoints: Set<string> }>())\n    : new Map<Consortium | null, { resources: Resource[]; endpoints: Set<string> }>()\n\n  const hasResources = resources && resources.length > 0\n  const hasLanguages = languages && Object.getOwnPropertyNames(languages).length > 0\n  const enableResourceLanguageSelectionModal = hasResources && hasLanguages\n\n  const hasResourcesWithAvailabilityRestriction =\n    Array.from(availabilityRestrictionsWithResources.keys()).filter(\n      (restriction) => restriction !== 'NONE'\n    ).length > 0\n\n  // ------------------------------------------------------------------------\n  // event handlers\n\n  function toggleConsortium(consortium: string) {\n    // compute the new list of consortia\n    const consortia = urlSearchParams.get(REQ_PARAM_CONSORTIA)?.split(',').filter(Boolean) ?? []\n    console.debug('Toggle consortia', { consortia, consortium })\n    const newConsortia = consortia.includes(consortium)\n      ? consortia.filter((c) => c !== consortium)\n      : consortia.concat([consortium])\n\n    // update our persistent query param\n    if (newConsortia.length === 0) {\n      urlSearchParams.delete(REQ_PARAM_CONSORTIA)\n    } else {\n      urlSearchParams.set(REQ_PARAM_CONSORTIA, newConsortia.join(','))\n    }\n    setUrlSearchParams(urlSearchParams)\n\n    // query invalidation happens above with usePrevious hook/state machine\n  }\n\n  // ------------------------------------------------------------------------\n  // rendering\n\n  function shortCapabilitiesForUrls(urls: string[]) {\n    return (\n      Array.from(\n        urls\n          .map((url) => endpointURLsWithSearchCapabilities.get(url))\n          .filter((caps) => caps !== undefined)\n          .reduce((set, caps) => {\n            caps.forEach((cap) => set.add(cap))\n            return set\n          }, new Set<Capability>())\n      )\n        // .filter((cap) => cap !== 'BASIC_SEARCH')\n        .toSorted(compareSearchCapability)\n        .map((cap) => (cap.endsWith('_SEARCH') ? cap.substring(0, cap.indexOf('_SEARCH')) : cap))\n    )\n  }\n\n  function renderInstitutionsTable() {\n    return (\n      <Table hover responsive className=\"mt-2\">\n        <thead>\n          <tr>\n            <th scope=\"col\">{t('statistics.fcs.thInstitutionName')}</th>\n            <th scope=\"col\">{t('statistics.fcs.thCountResources')}</th>\n            <th scope=\"col\">{t('statistics.fcs.thSearchCapabilities')}</th>\n            {import.meta.env.SHOW_CONSORTIA_INFO && (\n              <th scope=\"col\">{t('statistics.fcs.thConsortia')}</th>\n            )}\n          </tr>\n        </thead>\n        <tbody>\n          {Array.from(\n            (selectedResourceInstitutionVariantOption === 'hoster'\n              ? endpointInstitutionsWithResources\n              : institutionsWithResources\n            ).entries()\n          )\n            .toSorted()\n            .map(([institution, resources]) => {\n              const urls = Array.from(\n                resources\n                  .map((resource) => resource.endpoint.url)\n                  .reduce((set, url) => set.add(url), new Set<string>())\n              )\n              const capabilities = shortCapabilitiesForUrls(urls)\n              const consortia = import.meta.env.SHOW_CONSORTIA_INFO\n                ? Array.from(\n                    resources\n                      .map((resource) => resource.endpointInstitution.consortium)\n                      .filter((consortium) => consortium !== undefined)\n                      .reduce((set, consortium) => set.add(consortium), new Set<string>())\n                  )\n                : []\n\n              return (\n                <tr key={institution}>\n                  <td>{institution}</td>\n                  <td>{resources.length}</td>\n                  <td>{capabilities.join(', ')}</td>\n                  {import.meta.env.SHOW_CONSORTIA_INFO && <td>{consortia.join(', ')}</td>}\n                </tr>\n              )\n            })}\n        </tbody>\n      </Table>\n    )\n  }\n\n  function renderEndpointURLTable() {\n    if (selectedEndpointURLVariantOption === 'tld') {\n      return (\n        <Table hover responsive className=\"mt-2\">\n          <thead>\n            <tr>\n              <th scope=\"col\">{t('statistics.fcs.thEndpointDomain')}</th>\n              <th scope=\"col\">{t('statistics.fcs.thCountURLsForDomain')}</th>\n              <th scope=\"col\">{t('statistics.fcs.thCountResources')}</th>\n              <th scope=\"col\">{t('statistics.fcs.thSearchCapabilities')}</th>\n              {import.meta.env.SHOW_CONSORTIA_INFO && (\n                <th scope=\"col\">{t('statistics.fcs.thConsortia')}</th>\n              )}\n            </tr>\n          </thead>\n          <tbody>\n            {Array.from(endpointTLDsWithURLs.entries())\n              .toSorted(([tldA], [tldB]) => sortBySURT(`http://${tldA}`, `http://${tldB}`))\n              .map(([domain, urls]) => {\n                const resources = urls\n                  .map((url) => endpointURLsWithResources.get(url))\n                  .filter((list) => list !== undefined)\n                  .flat()\n                const capabilities = shortCapabilitiesForUrls(urls)\n                const consortia = import.meta.env.SHOW_CONSORTIA_INFO\n                  ? Array.from(\n                      resources\n                        .map((resource) => resource.endpointInstitution.consortium)\n                        .filter((consortium) => consortium !== undefined)\n                        .reduce((set, consortium) => set.add(consortium), new Set<string>())\n                    )\n                  : []\n\n                return (\n                  <tr key={domain}>\n                    <td>{domain}</td>\n                    <td>{urls.length}</td>\n                    <td>{resources.length}</td>\n                    <td>{capabilities.join(', ')}</td>\n                    {import.meta.env.SHOW_CONSORTIA_INFO && <td>{consortia.join(', ')}</td>}\n                  </tr>\n                )\n              })}\n          </tbody>\n        </Table>\n      )\n    }\n\n    if (selectedEndpointURLVariantOption === 'domain') {\n      return (\n        <Table hover responsive className=\"mt-2\">\n          <thead>\n            <tr>\n              <th scope=\"col\">{t('statistics.fcs.thEndpointDomain')}</th>\n              <th scope=\"col\">{t('statistics.fcs.thCountURLsForDomain')}</th>\n              <th scope=\"col\">{t('statistics.fcs.thCountResources')}</th>\n              <th scope=\"col\">{t('statistics.fcs.thSearchCapabilities')}</th>\n              {import.meta.env.SHOW_CONSORTIA_INFO && (\n                <th scope=\"col\">{t('statistics.fcs.thConsortia')}</th>\n              )}\n            </tr>\n          </thead>\n          <tbody>\n            {Array.from(endpointDomainsWithURLs.entries())\n              .toSorted(([urlA], [urlB]) => sortBySURT(`http://${urlA}`, `http://${urlB}`))\n              .map(([domain, urls]) => {\n                const resources = urls\n                  .map((url) => endpointURLsWithResources.get(url))\n                  .filter((list) => list !== undefined)\n                  .flat()\n                const capabilities = shortCapabilitiesForUrls(urls)\n                const consortia = import.meta.env.SHOW_CONSORTIA_INFO\n                  ? Array.from(\n                      resources\n                        .map((resource) => resource.endpointInstitution.consortium)\n                        .filter((consortium) => consortium !== undefined)\n                        .reduce((set, consortium) => set.add(consortium), new Set<string>())\n                    )\n                  : []\n\n                return (\n                  <tr key={domain}>\n                    <td>{domain}</td>\n                    <td>{urls.length}</td>\n                    <td>{resources.length}</td>\n                    <td>{capabilities.join(', ')}</td>\n                    {import.meta.env.SHOW_CONSORTIA_INFO && <td>{consortia.join(', ')}</td>}\n                  </tr>\n                )\n              })}\n          </tbody>\n        </Table>\n      )\n    }\n\n    return (\n      <Table hover responsive className=\"mt-2\">\n        <thead>\n          <tr>\n            <th scope=\"col\">{t('statistics.fcs.thEndpointUrl')}</th>\n            <th scope=\"col\">{t('statistics.fcs.thCountResources')}</th>\n            <th scope=\"col\">{t('statistics.fcs.thSearchCapabilities')}</th>\n            {import.meta.env.SHOW_CONSORTIA_INFO && (\n              <th scope=\"col\">{t('statistics.fcs.thConsortium')}</th>\n            )}\n          </tr>\n        </thead>\n        <tbody>\n          {Array.from(endpointURLsWithResources.entries())\n            .toSorted(([urlA], [urlB]) => sortBySURT(urlA, urlB))\n            .map(([url, resources]) => {\n              const capabilities = shortCapabilitiesForUrls([url])\n              const consortia = import.meta.env.SHOW_CONSORTIA_INFO\n                ? Array.from(\n                    resources\n                      .map((resource) => resource.endpointInstitution.consortium)\n                      .filter((consortium) => consortium !== undefined)\n                      .reduce((set, consortium) => set.add(consortium), new Set<string>())\n                  )\n                : []\n\n              return (\n                <tr key={url}>\n                  <td>{url}</td>\n                  <td>{resources.length}</td>\n                  <td>{capabilities.join(', ')}</td>\n                  {import.meta.env.SHOW_CONSORTIA_INFO && <td>{consortia.join(', ')}</td>}\n                </tr>\n              )\n            })}\n        </tbody>\n      </Table>\n    )\n  }\n\n  // ------------------------------------------------------------------------\n\n  return (\n    <Container className=\"d-grid gap-2 mt-3\">\n      {/* error / loading indicators */}\n      {(isPendingResources || isErrorResources) && (\n        <Row>\n          <Col>\n            {isPendingResources\n              ? t('statistics.loading', { context: 'what', what: 'resources' })\n              : null}\n            <br />\n            {isErrorResources ? errorResources.message : null}\n          </Col>\n        </Row>\n      )}\n      {(isPendingLanguages || isErrorLanguages) && (\n        <Row>\n          <Col>\n            {isPendingLanguages\n              ? t('statistics.loading', { context: 'what', what: 'languages' })\n              : null}\n            <br />\n            {isErrorLanguages ? errorLanguages.message : null}\n          </Col>\n        </Row>\n      )}\n      {import.meta.env.SHOW_CONSORTIA_INFO && (\n        <>\n          {(isPendingResourcesAll || isErrorResourcesAll) && (\n            <Row>\n              <Col>\n                {isPendingResourcesAll\n                  ? t('statistics.loading', { context: 'what', what: 'resources-all' })\n                  : null}\n                <br />\n                {isErrorResourcesAll ? errorResourcesAll.message : null}\n              </Col>\n            </Row>\n          )}\n        </>\n      )}\n\n      <Card className=\"p-3\">\n        <h3 className=\"h4 pb-1 mb-3 border-bottom\">{t('statistics.fcs.title')}</h3>\n\n        <h4 className=\"h5 pb-1 mb-3 border-bottom\" id=\"overview\">\n          {t('statistics.fcs.titleOverall')}\n        </h4>\n\n        <Table hover responsive>\n          <thead className=\"visually-hidden\">\n            <tr>\n              <th scope=\"col\">{t('statistics.fcs.thStatsKey')}</th>\n              <th scope=\"col\">{t('statistics.fcs.thStatsValue')}</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td scope=\"row\">{t('statistics.fcs.tdLabelResourceCount')}</td>\n              <td>{flatResources.length}</td>\n            </tr>\n            <tr>\n              <td scope=\"row\">{t('statistics.fcs.tdLabelEndpointCount')}</td>\n              <td>{endpointURLsWithResources.size}</td>\n            </tr>\n            <tr>\n              <td scope=\"row\">{t('statistics.fcs.tdLabelInstitutionCount')}</td>\n              <td>{endpointInstitutionsWithResources.size}</td>\n            </tr>\n            {import.meta.env.SHOW_CONSORTIA_INFO && consortiaWithResources.size > 1 && (\n              <tr>\n                <td scope=\"row\">{t('statistics.fcs.tdLabelConsortiaCount')}</td>\n                <td>{consortiaWithResources.size}</td>\n              </tr>\n            )}\n          </tbody>\n        </Table>\n\n        {import.meta.env.SHOW_CONSORTIA_INFO && consortiaWithResources.size > 1 && (\n          <>\n            <h4 className=\"h5 pb-1 mb-3 border-bottom\" id=\"consortia\">\n              {t('statistics.fcs.titleConsortia')}\n            </h4>\n\n            <Card className=\"my-2\">\n              <Card.Header>{t('statistics.fcs.cardHeaderConsortia')}</Card.Header>\n              <Card.Body>\n                <Table hover responsive className=\"mt-2\">\n                  <thead>\n                    <tr>\n                      <th scope=\"col\">{t('statistics.fcs.thConsortium')}</th>\n                      <th scope=\"col\">{t('statistics.fcs.thCountEndpoints')}</th>\n                      <th scope=\"col\">{t('statistics.fcs.thCountResources')}</th>\n                      <th scope=\"col\">{t('statistics.fcs.thSearchCapabilities')}</th>\n                      <th scope=\"col\">{t('statistics.fcs.thActions')}</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {Array.from(consortiaWithResources.entries()).map(\n                      ([consortium, { resources, endpoints }]) => {\n                        const urls = Array.from(endpoints)\n                        const capabilities = shortCapabilitiesForUrls(urls)\n\n                        return (\n                          <tr\n                            key={consortium}\n                            className={\n                              consortium && consortia.includes(consortium)\n                                ? 'table-primary'\n                                : undefined\n                            }\n                          >\n                            <td>{consortium ?? t('statistics.fcs.tdNoConsortium')}</td>\n                            <td>{endpoints.size}</td>\n                            <td>{resources.length}</td>\n                            <td>{capabilities.join(', ')}</td>\n                            <td className={consortium === null ? '' : 'py-0 align-middle'}>\n                              {consortium === null ? (\n                                ''\n                              ) : (\n                                <Button size=\"sm\" onClick={() => toggleConsortium(consortium)}>\n                                  {t('statistics.fcs.btnToggleConsortium', {\n                                    context: consortia.includes(consortium) ? 'remove' : 'add',\n                                  })}\n                                </Button>\n                              )}\n                            </td>\n                          </tr>\n                        )\n                      }\n                    )}\n                  </tbody>\n                </Table>\n              </Card.Body>\n            </Card>\n          </>\n        )}\n\n        <h4 className=\"h5 pb-1 mb-3 border-bottom\" id=\"institutions\">\n          {t('statistics.fcs.titleInstitutions')}\n        </h4>\n\n        <Card className=\"my-2\">\n          <Card.Header>{t('statistics.fcs.cardHeaderInstitutionStats')}</Card.Header>\n          <Card.Body>\n            <dl className=\"mb-0\">\n              <dt>{t('statistics.fcs.tdLabelInstitutionCount')}</dt>\n              <dd>{institutionsWithResources.size}</dd>\n              <dt>{t('statistics.fcs.tdLabelInstitutionHosterCount')}</dt>\n              <dd>{endpointInstitutionsWithResources.size}</dd>\n            </dl>\n          </Card.Body>\n        </Card>\n\n        <Card className=\"my-2\">\n          <Card.Header>{t('statistics.fcs.cardHeaderInstitutions')}</Card.Header>\n          <Card.Body>\n            <Form onSubmit={(event) => event.preventDefault()}>\n              <Col className=\"filter-checkboxes\" lg={12} md={12}>\n                <Form.Text className=\"me-2\">\n                  {t('statistics.fcs.labelForResourceInstitutionVariants')}\n                </Form.Text>\n                {(['institution', 'hoster'] as ResourceInstitutionVariantOptions[]).map((type) => (\n                  <Form.Check\n                    key={type}\n                    type=\"radio\"\n                    name=\"resourceInstitutionVariant\"\n                    value={type}\n                    id={`resourceInstitutionVariant-${type}`}\n                    checked={selectedResourceInstitutionVariantOption === type}\n                    onChange={() => setSelectedResourceInstitutionVariantOption(type)}\n                    label={t(`statistics.fcs.resourceInstitutionVariant${type}`)}\n                  />\n                ))}\n              </Col>\n            </Form>\n\n            {renderInstitutionsTable()}\n          </Card.Body>\n        </Card>\n\n        <h4 className=\"h5 pb-1 mt-4 mb-3 border-bottom\" id=\"endpoints\">\n          {t('statistics.fcs.titleEndpoints')}\n        </h4>\n\n        <Card className=\"my-2\">\n          <Card.Header>{t('statistics.fcs.cardHeaderEndpointStats')}</Card.Header>\n          <Card.Body>\n            <dl className=\"mb-0\">\n              <dt>{t('statistics.fcs.tdLabelEndpointCount')}</dt>\n              <dd>{endpointURLsWithResources.size}</dd>\n              <dt>{t('statistics.fcs.tdLabelEndpointDomainCount')}</dt>\n              <dd>{endpointDomainsWithURLs.size}</dd>\n            </dl>\n          </Card.Body>\n        </Card>\n\n        <Card className=\"my-2\">\n          <Card.Header>{t('statistics.fcs.cardHeaderEndpoints')}</Card.Header>\n          <Card.Body>\n            <Form onSubmit={(event) => event.preventDefault()}>\n              <Col className=\"filter-checkboxes\" lg={12} md={12}>\n                <Form.Text className=\"me-2\">\n                  {t('statistics.fcs.labelForResourceInstitutionVariants')}\n                </Form.Text>\n                {(['url', 'domain', 'tld'] as URLVariantOptions[]).map((type) => (\n                  <Form.Check\n                    key={type}\n                    type=\"radio\"\n                    name=\"endpointURLVariant\"\n                    value={type}\n                    id={`endpointURLVariant-${type}`}\n                    checked={selectedEndpointURLVariantOption === type}\n                    onChange={() => setSelectedEndpointURLVariantOption(type)}\n                    label={t(`statistics.fcs.endpointURLVariant${type}`)}\n                  />\n                ))}\n              </Col>\n            </Form>\n\n            {renderEndpointURLTable()}\n          </Card.Body>\n        </Card>\n\n        <h4 className=\"h5 pb-1 mb-3 border-bottom\" id=\"resources\">\n          {t('statistics.fcs.titleResources')}\n        </h4>\n\n        <Card className=\"my-2\">\n          <Card.Header>{t('statistics.fcs.cardHeaderResourceStats')}</Card.Header>\n          <Card.Body>\n            <dl className=\"mb-0\">\n              <dt>{t('statistics.fcs.tdLabelResourceCount')}</dt>\n              <dd>{flatResources.length}</dd>\n              <dt>{t('statistics.fcs.tdLabelRootResourceCount')}</dt>\n              <dd>{resources.length}</dd>\n              <dt>{t('statistics.fcs.tdLabelResourceWithAvailabilityRestrictionCount')}</dt>\n              <dd>\n                {\n                  Array.from(availabilityRestrictionsWithResources.entries())\n                    .filter(([restriction]) => restriction !== 'NONE')\n                    .map(([, resources]) => resources)\n                    .flat().length\n                }\n              </dd>\n            </dl>\n          </Card.Body>\n          {enableResourceLanguageSelectionModal && (\n            <Card.Footer className=\"d-flex gap-2\">\n              <Button variant=\"primary\" onClick={() => setShowLanguageSelectionModal(true)}>\n                {t('statistics.fcs.btnOpenResourceLanguageSelectionModal')}\n              </Button>\n            </Card.Footer>\n          )}\n        </Card>\n\n        <Card className=\"my-2\">\n          <Card.Header>{t('statistics.fcs.cardHeaderSearchCapabilities')}</Card.Header>\n          <Card.Body>\n            <Table hover responsive className=\"mt-2\">\n              <thead>\n                <tr>\n                  <th scope=\"col\">{t('statistics.fcs.thSearchCapability')}</th>\n                  <th scope=\"col\">{t('statistics.fcs.thCountResources')}</th>\n                </tr>\n              </thead>\n              <tbody>\n                {Array.from(searchCapabilitiesWithResources.entries()).map(\n                  ([capability, resources]) => (\n                    <tr key={capability}>\n                      <td>{capability}</td>\n                      <td>{resources.length}</td>\n                    </tr>\n                  )\n                )}\n              </tbody>\n            </Table>\n          </Card.Body>\n        </Card>\n\n        {hasResourcesWithAvailabilityRestriction && (\n          <Card className=\"my-2\">\n            <Card.Header>\n              {t('statistics.fcs.cardHeaderResourcesWithAvailabilityRestrictions')}\n            </Card.Header>\n            <Card.Body>\n              <Table hover responsive className=\"mt-2\">\n                <caption>{t('statistics.fcs.tblAvailabilityRestrictionCaption')}</caption>\n                <thead>\n                  <tr>\n                    <th scope=\"col\">{t('statistics.fcs.thAvailabilityRestriction')}</th>\n                    <th scope=\"col\">{t('statistics.fcs.thResourceTitle')}</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {Array.from(availabilityRestrictionsWithResources.entries())\n                    .filter(([restriction]) => restriction !== 'NONE')\n                    .map(([restriction, resources]) =>\n                      resources.map((resource) => (\n                        <tr key={resource.id}>\n                          <td>{restriction}</td>\n                          <td>\n                            {getBestFromMultilingualValuesTryByLanguage(resource.title, userLocale)}{' '}\n                            <Link\n                              to={{\n                                pathname: '/stats/resources',\n                                search: getLinkSearch({ [REQ_PARAM_RESOURCE_ID]: resource.id }),\n                              }}\n                            >\n                              <i\n                                dangerouslySetInnerHTML={{ __html: eyeIcon }}\n                                className=\"align-baseline ms-2\"\n                              />\n                            </Link>\n                          </td>\n                        </tr>\n                      ))\n                    )}\n                </tbody>\n              </Table>\n            </Card.Body>\n          </Card>\n        )}\n      </Card>\n\n      {showLanguageSelectionModal && (\n        <LanguageModal\n          languages={languages}\n          resources={resources}\n          showResourceCounts={true}\n          showLanguageFilterOptions={false}\n          show={showLanguageSelectionModal}\n          onModalClose={() => setShowLanguageSelectionModal(false)}\n        />\n      )}\n    </Container>\n  )\n}\n\nexport default FCSStatistics\n","import { Highlight } from '@nozbe/microfuzz/react'\nimport { useQuery } from '@tanstack/react-query'\nimport { Fragment, useEffect, useState } from 'react'\nimport Badge from 'react-bootstrap/Badge'\nimport Card from 'react-bootstrap/Card'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport Form from 'react-bootstrap/Form'\nimport ListGroup from 'react-bootstrap/ListGroup'\nimport Row from 'react-bootstrap/Row'\nimport Table from 'react-bootstrap/Table'\nimport ToggleButton from 'react-bootstrap/ToggleButton'\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup'\nimport { useTranslation } from 'react-i18next'\nimport { Link, useSearchParams } from 'react-router'\n\nimport type { ExtraScopingParams } from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport {\n  getLanguages,\n  getResources,\n  REQ_PARAM_CONSORTIA,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport type { FuzzyMatchesByField } from '@/hooks/useFuzzySearchListWithHierarchy'\nimport useFuzzySearchListWithHierarchy from '@/hooks/useFuzzySearchListWithHierarchy'\nimport useKeepSearchParams from '@/hooks/useKeepSearchParams'\nimport { useAxios } from '@/providers/AxiosContext'\nimport { useLocaleStore } from '@/stores/locale'\nimport type { Resource } from '@/utils/api'\nimport {\n  findResourceByFilter,\n  fromApi,\n  getBestFromMultilingualValuesTryByLanguage,\n  getBestLanguageFromMultilingualValuesTryByLanguage,\n  getLanguagesFromResourceInfo,\n  SORT_FNS,\n} from '@/utils/resources'\nimport { REQ_PARAM_RESOURCE_ID } from './utils'\n\nimport eyeIcon from 'bootstrap-icons/icons/eye-fill.svg?raw'\nimport houseDoorIcon from 'bootstrap-icons/icons/house-door.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// component\n\nfunction ResourcesDetails({ validatorUrl }: { validatorUrl: string | null }) {\n  const axios = useAxios()\n  const { t } = useTranslation()\n\n  const userLocale = useLocaleStore((state) => state.locale)\n  const [locale, setLocale] = useState(userLocale)\n\n  const langNames = new Intl.DisplayNames([userLocale, 'en'], { type: 'language' })\n\n  const [, getLinkSearch] = useKeepSearchParams()\n  const [urlSearchParams, setUrlSearchParams] = useSearchParams()\n\n  const [resources, setResources] = useState<Resource[]>([])\n  const [filter, setFilter] = useState('')\n  const [selectedResourceId, setSelectedResourceId] = useState<string | null>(\n    urlSearchParams.get(REQ_PARAM_RESOURCE_ID)\n  )\n\n  // iff resourceId is a resourceHandle\n  // redirect to full endpointUrl#resourceHandle == resourceId format\n  const resourceFoundById = findResourceByFilter(\n    resources,\n    (resource: Resource) => resource.id === selectedResourceId\n  )\n  if (resourceFoundById === undefined) {\n    const resourceFoundByHandle = findResourceByFilter(\n      resources,\n      (resource: Resource) => resource.handle === selectedResourceId\n    )\n    if (resourceFoundByHandle !== undefined) {\n      const newResourceId = resourceFoundByHandle.id\n      if (newResourceId !== selectedResourceId) {\n        setSelectedResourceId(newResourceId)\n        urlSearchParams.set(REQ_PARAM_RESOURCE_ID, newResourceId)\n        setUrlSearchParams(urlSearchParams)\n      }\n    }\n  }\n\n  const selectedResource = selectedResourceId ? resourceFoundById : undefined\n\n  // ------------------------------------------------------------------------\n  // initialization\n\n  const extraParams = {\n    consortia: urlSearchParams.get(REQ_PARAM_CONSORTIA),\n  } satisfies ExtraScopingParams\n  const { data, isPending, isError, error } = useQuery({\n    queryKey: ['resources'],\n    queryFn: getResources.bind(null, axios, extraParams),\n  })\n  const { data: languagesNames } = useQuery({\n    queryKey: ['languages'],\n    queryFn: getLanguages.bind(null, axios, extraParams),\n  })\n\n  useEffect(() => {\n    if (!data) return\n    // do some initialization (based on `data`)\n    const newResources = fromApi(data)\n    // set state\n    setResources(newResources)\n  }, [data])\n\n  useEffect(() => {\n    const newResourceId = urlSearchParams.get(REQ_PARAM_RESOURCE_ID)\n    if (!newResourceId) return\n    if (newResourceId === selectedResourceId) return\n    // TODO: check if resource id exists?\n    console.debug('Set selected resource from URLSearchParams', newResourceId)\n    setSelectedResourceId(newResourceId)\n  }, [urlSearchParams, selectedResourceId])\n\n  // languages for resource infos (title/description/institution)\n  const resourceInfoLanguages = resources\n    .map((resource) => getLanguagesFromResourceInfo(resource))\n    .flat()\n  const resourceInfoLanguagesGrouped = resourceInfoLanguages.reduce(\n    (acc, cur) => acc.set(cur, (acc.get(cur) ?? 0) + 1),\n    new Map()\n  )\n\n  // sort resources\n  const sortedResources = resources.toSorted(SORT_FNS['title-up'])\n  // filter resources (dropdown)\n  const { resources: filteredResources, matches: filteredResourcesHighlights } =\n    useFuzzySearchListWithHierarchy(filter, sortedResources, locale, ['title', 'institution'])\n\n  // ------------------------------------------------------------------------\n  // event handlers\n\n  function handleChangeResource(eventKey: string | null) {\n    if (!eventKey) return\n\n    const newResourceId = eventKey\n    // set selection\n    setSelectedResourceId(newResourceId)\n    // update url search parameter\n    urlSearchParams.set(REQ_PARAM_RESOURCE_ID, newResourceId)\n    setUrlSearchParams(urlSearchParams)\n  }\n\n  // ------------------------------------------------------------------------\n  // rendering\n\n  function renderResourceDropdownItem(\n    resource: Resource,\n    highlightings?: Map<string, FuzzyMatchesByField>,\n    nestLevel: number = 0\n  ): JSX.Element {\n    const highlighting = highlightings?.get(resource.id) ?? new Map()\n\n    const item = (\n      <Dropdown.Item\n        key={resource.id}\n        eventKey={resource.id}\n        style={{ paddingInlineStart: `${1 + nestLevel * 1}em` }}\n        // as=\"button\"\n        // onClick={(event) => event.preventDefault()}\n      >\n        <Highlight\n          text={getBestFromMultilingualValuesTryByLanguage(resource.title, locale) ?? ''}\n          ranges={highlighting.get('title') ?? null}\n        />\n      </Dropdown.Item>\n    )\n\n    if (resource.subResources && resource.subResources.length > 0) {\n      return (\n        <Fragment key={resource.id}>\n          {item}\n          {resource.subResources.map((subResource) =>\n            renderResourceDropdownItem(subResource, filteredResourcesHighlights, nestLevel + 1)\n          )}\n        </Fragment>\n      )\n    }\n\n    return item\n  }\n\n  function renderResourceMetadataField(\n    fieldType: string,\n    fieldValues: string | { [language: string]: string } | null,\n    fallbackEmptyValue: string = ''\n  ) {\n    if (fieldValues === null) return null\n\n    const selectedLanguage = getBestLanguageFromMultilingualValuesTryByLanguage(\n      fieldValues,\n      userLocale\n    )\n\n    return (\n      <Card className=\"my-2\">\n        <Card.Header>\n          {t(`statistics.resources.cardHeader${fieldType[0].toUpperCase()}${fieldType.slice(1)}`)}\n        </Card.Header>\n        {typeof fieldValues === 'string' ? (\n          <Card.Body>{fieldValues || fallbackEmptyValue}</Card.Body>\n        ) : (\n          <ListGroup className=\"list-group-flush\">\n            {Object.entries(fieldValues).map(([language, value]) => (\n              <ListGroup.Item key={language}>\n                <Badge\n                  bg={selectedLanguage === language ? 'primary' : 'secondary'}\n                  className=\"me-2\"\n                >\n                  {langNames.of(language)} <sup>{language}</sup>\n                </Badge>{' '}\n                {value || fallbackEmptyValue}\n              </ListGroup.Item>\n            ))}\n          </ListGroup>\n        )}\n      </Card>\n    )\n  }\n\n  function renderResourceHierarchy(resource: Resource) {\n    if (!resources) return null\n    if (!resource) return null\n\n    const rootResource =\n      resource.rootResourceId === null\n        ? resource\n        : findResourceByFilter(resources, (r: Resource) => r.id === resource.rootResourceId)\n    if (!rootResource) return null\n\n    function renderRecursiveResourceHierarchy(resourceInHierarchy: Resource) {\n      return (\n        <li key={resourceInHierarchy.id}>\n          {resourceInHierarchy.id === resource.id ? (\n            <strong>{resourceInHierarchy.handle}</strong>\n          ) : (\n            <>\n              {resourceInHierarchy.handle}\n              <Link\n                to={{ search: getLinkSearch({ [REQ_PARAM_RESOURCE_ID]: resourceInHierarchy.id }) }}\n                onClick={(event) => {\n                  event.preventDefault()\n                  handleChangeResource(resourceInHierarchy.id)\n                }}\n              >\n                <i\n                  dangerouslySetInnerHTML={{ __html: eyeIcon }}\n                  className=\"align-baseline ms-2 me-1\"\n                />\n              </Link>\n            </>\n          )}{' '}\n           {getBestFromMultilingualValuesTryByLanguage(resourceInHierarchy.title, userLocale)}\n          {resourceInHierarchy.subResources.length > 0 && (\n            <ul>\n              {resourceInHierarchy.subResources.map((subResource) =>\n                renderRecursiveResourceHierarchy(subResource)\n              )}\n            </ul>\n          )}\n        </li>\n      )\n    }\n\n    return <ul>{renderRecursiveResourceHierarchy(rootResource)}</ul>\n  }\n\n  // ------------------------------------------------------------------------\n\n  const showLexDVInfo =\n    selectedResource &&\n    (selectedResource.availableDataViews?.find(\n      (dv) => dv.mimeType === 'application/x-clarin-fcs-lex+xml'\n    ) ||\n      (selectedResource.availableLexFields && selectedResource.availableLexFields.length > 0))\n\n  const showAdvDVInfo =\n    selectedResource &&\n    (selectedResource.availableDataViews?.find(\n      (dv) => dv.mimeType === 'application/x-clarin-fcs-adv+xml'\n    ) ||\n      (selectedResource.availableLayers && selectedResource.availableLayers.length > 0))\n\n  return (\n    <Container className=\"d-grid gap-2 mt-3\">\n      {(isPending || isError) && (\n        <Row>\n          <Col>\n            {isPending ? t('statistics.loading') : null}\n            <br />\n            {isError ? error.message : null}\n          </Col>\n        </Row>\n      )}\n\n      <Form onSubmit={(event) => event.preventDefault()}>\n        <Dropdown onSelect={handleChangeResource}>\n          <Dropdown.Toggle className=\"resource-selector\" variant=\"outline-dark\">\n            {t('statistics.resources.dropdownLabel', { count: resources.length })}{' '}\n          </Dropdown.Toggle>\n          <Dropdown.Menu>\n            <Dropdown.ItemText>\n              <Form.Control value={filter} onChange={(event) => setFilter(event.target.value)} />\n\n              {resourceInfoLanguagesGrouped.size > 1 && (\n                <Form.Group as={Row} controlId=\"resource-info-language\" className=\"mt-2\">\n                  <Form.Label column sm=\"auto\" style={{ fontSize: '0.875rem' }}>\n                    {t('search.resourcesModal.labelChangeResourceInfoLanguage')}\n                  </Form.Label>\n                  <Col sm=\"auto\">\n                    <ToggleButtonGroup\n                      type=\"radio\"\n                      name=\"resource-info-languages\"\n                      defaultValue={locale}\n                      onChange={(language) => setLocale(language)}\n                    >\n                      {Array.from(resourceInfoLanguagesGrouped.entries())\n                        .toSorted()\n                        .map(([language, amount]) => (\n                          <ToggleButton\n                            size=\"sm\"\n                            key={language}\n                            id={`resource-info-languages-${language}`}\n                            value={language}\n                            variant=\"secondary\"\n                            title={t(\n                              'search.resourcesModal.buttonChangeResourceInfoLanguageTitle',\n                              {\n                                count: amount,\n                                language,\n                                languageName: langNames.of(language),\n                              }\n                            )}\n                          >\n                            {langNames.of(language)} <sup>{language}</sup>\n                          </ToggleButton>\n                        ))}\n                    </ToggleButtonGroup>\n                  </Col>\n                </Form.Group>\n              )}\n            </Dropdown.ItemText>\n\n            <Dropdown.Divider />\n            {filteredResources.map((resource) =>\n              renderResourceDropdownItem(resource, filteredResourcesHighlights)\n            )}\n          </Dropdown.Menu>\n        </Dropdown>\n      </Form>\n\n      {selectedResource && (\n        <Card className=\"p-3 mt-3\">\n          <h3 className=\"h4 pb-1 mb-3 border-bottom\">\n            {getBestFromMultilingualValuesTryByLanguage(selectedResource.title, userLocale)}\n          </h3>\n\n          <h4 className=\"h5 pb-1 mb-3 border-bottom\">\n            {t('statistics.resources.titleBasicMetadata')}\n          </h4>\n\n          {renderResourceMetadataField('title', selectedResource.title)}\n          {renderResourceMetadataField('description', selectedResource.description)}\n          {renderResourceMetadataField('institution', selectedResource.institution)}\n          {selectedResource.landingPage && (\n            <Card className=\"my-2\">\n              <Card.Header>{t('statistics.resources.cardHeaderLandingPage')}</Card.Header>\n              <Card.Body>\n                <a href={selectedResource.landingPage} className=\"matomo_link\" target=\"_blank\">\n                  {selectedResource.landingPage}\n                </a>\n              </Card.Body>\n            </Card>\n          )}\n          <Card className=\"my-2\">\n            <Card.Header>{t('statistics.resources.cardHeaderLanguages')}</Card.Header>\n            <Card.Body>\n              <ul className=\"mb-0\">\n                {selectedResource.languages.toSorted().map((language) => (\n                  <li key={language}>\n                    <strong>{language}</strong>\n                    {languagesNames && language in languagesNames && (\n                      <>: {languagesNames[language]}</>\n                    )}\n                  </li>\n                ))}\n              </ul>\n            </Card.Body>\n          </Card>\n\n          <h4 className=\"h5 pb-1 mt-4 mb-3 border-bottom\">\n            {t('statistics.resources.titleTechnicalMetadata')}\n          </h4>\n\n          <Card className=\"my-2\">\n            <Card.Header>{t('statistics.resources.cardHeaderResource')}</Card.Header>\n            <Card.Body>\n              <dl className=\"mb-0\">\n                <dt>{t('statistics.labels.resourcePid')}</dt>\n                <dd>{selectedResource.handle}</dd>\n                <dt>{t('statistics.labels.resourceHierarchy')}</dt>\n                <dd>{renderResourceHierarchy(selectedResource)}</dd>\n                <dt>{t('statistics.labels.searchCapabilitiesOfResource')}</dt>\n                <dd>{selectedResource.searchCapabilitiesResolved.join(', ')}</dd>\n                <dt>{t('statistics.labels.availabilityRestriction')}</dt>\n                <dd>{selectedResource.availabilityRestriction}</dd>\n              </dl>\n            </Card.Body>\n          </Card>\n\n          <Card className=\"my-2\">\n            <Card.Header>{t('statistics.resources.cardHeaderEndpoint')}</Card.Header>\n            <Card.Body>\n              <dl className=\"mb-0\">\n                <dt>{t('statistics.labels.endpointUrl')}</dt>\n                <dd>\n                  {selectedResource.endpoint.url}{' '}\n                  {validatorUrl && (\n                    <>\n                      {' '}\n                      <a\n                        href={`${validatorUrl}?url=${encodeURIComponent(\n                          selectedResource.endpoint.url\n                        )}`}\n                        className=\"matomo_link\"\n                        target=\"_blank\"\n                      >\n                        <i\n                          dangerouslySetInnerHTML={{ __html: eyeIcon }}\n                          className=\"align-baseline ms-2\"\n                        />\n                      </a>\n                    </>\n                  )}\n                </dd>\n                {/* TODO: add sideloaded status? */}\n                <dt>{t('statistics.labels.fcsVersion')}</dt>\n                <dd>{selectedResource.endpoint.protocol}</dd>\n                <dt>{t('statistics.labels.searchCapabilitiesOfEndpoint')}</dt>\n                <dd>{selectedResource.endpoint.searchCapabilities.join(', ')}</dd>\n                <dt>{t('statistics.labels.endpointInstitution')}</dt>\n                <dd>\n                  {selectedResource.endpointInstitution.name}\n                  {selectedResource.endpointInstitution.link && (\n                    <>\n                      {'  '}\n                      <a\n                        href={selectedResource.endpointInstitution.link}\n                        className=\"matomo_link\"\n                        target=\"_blank\"\n                      >\n                        {t('statistics.labels.moreInformation')}{' '}\n                        <i dangerouslySetInnerHTML={{ __html: houseDoorIcon }} />\n                      </a>\n                    </>\n                  )}\n                </dd>\n              </dl>\n            </Card.Body>\n          </Card>\n\n          <h4 className=\"h5 pb-1 mt-4 mb-3 border-bottom\">\n            {t('statistics.resources.titleSeachInformation')}\n          </h4>\n\n          <Card className=\"my-2\">\n            <Card.Header>{t('statistics.resources.cardHeaderDataViews')}</Card.Header>\n            <Card.Body>\n              {selectedResource.availableDataViews && (\n                <Table hover responsive>\n                  <thead>\n                    <tr>\n                      <th scope=\"col\">{t('statistics.resources.thDataViewIdentifier')}</th>\n                      <th scope=\"col\">{t('statistics.resources.thDataViewMimeType')}</th>\n                      <th scope=\"col\">{t('statistics.resources.thDataViewDeliveryPolicy')}</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {selectedResource.availableDataViews.map((dv) => (\n                      <tr key={dv.identifier}>\n                        <td>{dv.identifier}</td>\n                        <td>{dv.mimeType}</td>\n                        <td>{dv.deliveryPolicy}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </Table>\n              )}\n            </Card.Body>\n          </Card>\n\n          {showAdvDVInfo && (\n            <Card className=\"my-2\">\n              <Card.Header>{t('statistics.resources.cardHeaderAdvancedDataView')}</Card.Header>\n              <Card.Body>\n                {selectedResource.availableLayers && (\n                  <Table hover responsive>\n                    <thead>\n                      <tr>\n                        <th scope=\"col\">{t('statistics.resources.thLayerType')}</th>\n                        <th scope=\"col\">{t('statistics.resources.thQualifier')}</th>\n                        <th scope=\"col\">{t('statistics.resources.thResultId')}</th>\n                        <th scope=\"col\">{t('statistics.resources.thIdentifier')}</th>\n                        <th scope=\"col\">{t('statistics.resources.thEncoding')}</th>\n                        <th scope=\"col\">{t('statistics.resources.thAltValueInfo')}</th>\n                        <th scope=\"col\">{t('statistics.resources.thAltValueInfoURI')}</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {selectedResource.availableLayers.map((layer) => (\n                        <tr key={layer.identifier}>\n                          <td>{layer.layerType}</td>\n                          <td>{layer.qualifier}</td>\n                          <td>{layer.resultId}</td>\n                          <td>{layer.identifier}</td>\n                          <td>{layer.encoding}</td>\n                          <td>{layer.altValueInfo}</td>\n                          <td>{layer.altValueInfoURI}</td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </Table>\n                )}\n              </Card.Body>\n            </Card>\n          )}\n\n          {showLexDVInfo && (\n            <Card className=\"my-2\">\n              <Card.Header>{t('statistics.resources.cardHeaderLexDataView')}</Card.Header>\n              <Card.Body>\n                {selectedResource.availableLexFields && (\n                  <Table hover responsive>\n                    <thead>\n                      <tr>\n                        <th scope=\"col\">{t('statistics.resources.thLexFieldType')}</th>\n                        <th scope=\"col\">{t('statistics.resources.thLexIdentifier')}</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {selectedResource.availableLexFields.map((field) => (\n                        <tr key={field.id}>\n                          <td>{field.type}</td>\n                          <td>{field.id}</td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </Table>\n                )}\n              </Card.Body>\n            </Card>\n          )}\n        </Card>\n      )}\n    </Container>\n  )\n}\n\nexport default ResourcesDetails\n","import type { HighlightRanges } from '@nozbe/microfuzz'\nimport { Highlight } from '@nozbe/microfuzz/react'\nimport Alert from 'react-bootstrap/Alert'\nimport Badge from 'react-bootstrap/Badge'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Tooltip from 'react-bootstrap/Tooltip'\nimport { useTranslation } from 'react-i18next'\nimport { Link } from 'react-router'\nimport slugify from 'react-slugify'\nimport { Fragment } from 'react/jsx-runtime'\n\nimport type {\n  InstitutionEndpointInfo,\n  StatisticsResourceInfo,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport useKeepSearchParams from '@/hooks/useKeepSearchParams'\nimport { REQ_PARAM_RESOURCE_ID } from './utils'\n\nimport exclamationTriangleIcon from 'bootstrap-icons/icons/exclamation-triangle.svg?raw'\nimport eyeIcon from 'bootstrap-icons/icons/eye-fill.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// component\n\nfunction EndpointStatistics({\n  url,\n  statistics,\n  validatorUrl,\n  isScan,\n}: {\n  url: string\n  statistics: InstitutionEndpointInfo & {\n    matchEndpoint: HighlightRanges | null\n    matchResources: (HighlightRanges | null)[]\n  }\n  validatorUrl: string | null\n  isScan: boolean\n}) {\n  const { t, i18n } = useTranslation()\n  const [, getLinkSearch] = useKeepSearchParams()\n\n  const secondsFormatter = new Intl.NumberFormat(i18n.language, {\n    style: 'unit',\n    unit: 'second',\n    unitDisplay: 'short',\n  })\n\n  function renderResourceWithInfos(resInfo: StatisticsResourceInfo, idx: number) {\n    const resourceInner = (\n      <Highlight text={resInfo.title} ranges={statistics.matchResources?.[idx] ?? null} />\n    )\n    const linkToResourceInfo = (\n      <Link\n        to={{\n          pathname: '/stats/resources',\n          search: getLinkSearch({ [REQ_PARAM_RESOURCE_ID]: resInfo.handle }),\n        }}\n      >\n        <i dangerouslySetInnerHTML={{ __html: eyeIcon }} className=\"align-baseline ms-2\" />\n      </Link>\n    )\n\n    if (resInfo.valid && resInfo.notes.length === 0) {\n      return (\n        <>\n          {resourceInner} {linkToResourceInfo}\n        </>\n      )\n    }\n\n    return (\n      <OverlayTrigger\n        placement=\"auto-start\"\n        delay={{ show: 250, hide: 400 }}\n        overlay={\n          <Tooltip id={`resource-info-warning-${resInfo.handle}`}>\n            {!resInfo.valid && t('statistics.errors.notAvailableInAggregator')}\n            {!resInfo.valid && resInfo.notes.length >= 1 && <hr className=\"mt-2 mb-1\" />}\n            {resInfo.notes.length === 1 ? (\n              resInfo.notes[0]\n            ) : resInfo.notes.length >= 1 ? (\n              <ul className=\"text-start m-0 my-1 ps-3\">\n                {resInfo.notes.map((note, idx) => (\n                  <li key={idx}>{note}</li>\n                ))}\n              </ul>\n            ) : null}\n          </Tooltip>\n        }\n      >\n        <span>\n          <i\n            dangerouslySetInnerHTML={{ __html: exclamationTriangleIcon }}\n            className=\"align-baseline me-2\"\n          />\n          {!resInfo.valid ? <s>{resourceInner}</s> : resourceInner} {linkToResourceInfo}\n        </span>\n      </OverlayTrigger>\n    )\n  }\n\n  return (\n    <div className=\"ps-sm-4 mt-sm-0 mt-2 pt-sm-0 pt-1\" key={url}>\n      <h4 className=\"h5\" id={`${slugify(url)}-${isScan ? 'scan' : 'search'}`}>\n        <Highlight text={url} ranges={statistics.matchEndpoint} />\n        {validatorUrl && (\n          <>\n            {' '}\n            <a href={`${validatorUrl}?url=${encodeURIComponent(url)}`}>\n              <i dangerouslySetInnerHTML={{ __html: eyeIcon }} className=\"align-baseline ms-2\" />\n            </a>\n          </>\n        )}\n      </h4>\n      <dl className=\"ps-sm-4\">\n        <dt>{t('statistics.labels.fcsVersion')}</dt>\n        <dd>{statistics.version}</dd>\n        <dt>{t('statistics.labels.searchCapabilities')}</dt>\n        <dd>{statistics.searchCapabilities.join(', ')}</dd>\n        <dt>{t('statistics.labels.maxConcurrentScanRequests')}</dt>\n        <dd>{statistics.maxConcurrentRequests}</dd>\n        <dt>{t('statistics.labels.requestStatistics')}</dt>\n        <dd className=\"mb-0\">\n          {t('statistics.labels.numberOfRequests', { count: statistics.numberOfRequests })}\n        </dd>\n        {statistics.avgQueueTime !== 0 && (\n          <dd className=\"mb-0\">\n            {t('statistics.labels.queueTime', {\n              avg: secondsFormatter.format(statistics.avgQueueTime),\n              max: secondsFormatter.format(statistics.maxQueueTime),\n            })}\n          </dd>\n        )}\n        <dd>\n          {t('statistics.labels.executionTime', {\n            avg: secondsFormatter.format(statistics.avgExecutionTime),\n            max: secondsFormatter.format(statistics.maxExecutionTime),\n          })}\n        </dd>\n        {statistics.rootResources?.length > 0 && (\n          <>\n            <dt>{t('statistics.labels.resources')}</dt>\n            <dd>\n              {t('statistics.labels.numberOfRootResources', {\n                count: statistics.rootResources.length,\n              })}\n            </dd>\n            <dd>\n              <ul>\n                {statistics.rootResources.map((nameOrResInfo, idx) =>\n                  typeof nameOrResInfo === 'string' ? (\n                    <li key={nameOrResInfo}>\n                      <Highlight\n                        text={nameOrResInfo}\n                        ranges={statistics.matchResources?.[idx] ?? null}\n                      />\n                    </li>\n                  ) : (\n                    <li key={nameOrResInfo.handle}>\n                      {renderResourceWithInfos(nameOrResInfo, idx)}\n                    </li>\n                  )\n                )}\n              </ul>\n            </dd>\n          </>\n        )}\n        <Fragment>\n          {Object.entries(statistics.diagnostics || {}).map(([reason, info]) => (\n            <Alert variant=\"warning\" key={reason} style={{ fontSize: '0.85rem' }}>\n              <Alert.Heading style={{ fontSize: '1rem' }}>\n                <Badge bg=\"warning\">{info.counter}x</Badge>{' '}\n                <span className=\"text-uppercase\">{t('statistics.diagnostic.diagnostic')}</span>{' '}\n                {info.diagnostic.message}\n                {info.diagnostic.diagnostic && (\n                  <>\n                    {' - '}\n                    <small>{info.diagnostic.diagnostic}</small>\n                  </>\n                )}\n              </Alert.Heading>\n              <p className=\"mb-0\">\n                {t('statistics.diagnostic.context')} <a href={info.context}>{info.context}</a>\n              </p>\n            </Alert>\n          ))}\n          {Object.entries(statistics.errors || {}).map(([reason, info]) => (\n            <Alert variant=\"danger\" key={reason} style={{ fontSize: '0.85rem' }}>\n              <Alert.Heading style={{ fontSize: '1rem' }}>\n                <Badge bg=\"danger\">{info.counter}x</Badge>{' '}\n                <span className=\"text-uppercase\">{t('statistics.diagnostic.exception')}</span>{' '}\n                {info.exception.message}\n              </Alert.Heading>\n              <p className=\"mb-0\">\n                {t('statistics.diagnostic.context')} <a href={info.context}>{info.context}</a>\n              </p>\n              {info.exception.cause && (\n                <p className=\"mb-0\">\n                  {t('statistics.diagnostic.causedBy')} {info.exception.cause}\n                </p>\n              )}\n            </Alert>\n          ))}\n        </Fragment>\n      </dl>\n    </div>\n  )\n}\n\nexport default EndpointStatistics\n","import type { HighlightRanges } from '@nozbe/microfuzz'\nimport { Highlight, useFuzzySearchList } from '@nozbe/microfuzz/react'\nimport { useMemo, useState } from 'react'\nimport Alert from 'react-bootstrap/Alert'\nimport Card from 'react-bootstrap/Card'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Form from 'react-bootstrap/Form'\nimport Row from 'react-bootstrap/Row'\nimport { useTranslation } from 'react-i18next'\nimport slugify from 'react-slugify'\n\nimport type {\n  InstitutionEndpointInfo,\n  StatisticsSection,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport EndpointStatistics from './EndpointStatistics'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\ntype FilterField = 'institution' | 'endpoint' | 'resources'\n\n// --------------------------------------------------------------------------\n// component\n\nfunction SectionStatistics({\n  data,\n  validatorUrl,\n}: {\n  data: StatisticsSection\n  validatorUrl: string | null\n}) {\n  const { t, i18n } = useTranslation()\n\n  const [filter, setFilter] = useState('')\n  const [filterFields, setFilterFields] = useState<FilterField[]>([\n    'institution',\n    'endpoint',\n    'resources',\n  ])\n  const [showIssuesOnly, setShowIssuesOnly] = useState(false)\n\n  const idSuffix = `-${data.isScan ? 'scan' : 'search'}`\n\n  // make it flat\n  const flatData = useMemo(\n    () =>\n      Object.entries(data.institutions)\n        .toSorted()\n        .map(([institutionName, institutionEndpoints]) =>\n          Object.entries(institutionEndpoints)\n            .toSorted()\n            .map(([endpointUrl, endpointInfo]) => ({\n              institutionName,\n              endpointUrl,\n              endpointInfo: {\n                ...endpointInfo,\n                rootResources: endpointInfo.rootResources.toSorted(),\n              },\n            }))\n        )\n        .flat(1)\n        .filter(\n          showIssuesOnly\n            ? (item) =>\n                Object.keys(item.endpointInfo.diagnostics).length > 0 ||\n                Object.keys(item.endpointInfo.errors).length > 0\n            : () => true\n        ),\n    [data, showIssuesOnly]\n  )\n  const endpointsWithIssues = flatData.filter(\n    (item) =>\n      Object.keys(item.endpointInfo.diagnostics).length > 0 ||\n      Object.keys(item.endpointInfo.errors).length > 0\n  )\n\n  // filter by user query\n  const filteredData = useFuzzySearchList({\n    list: flatData,\n    queryText: filter,\n    // search on institution name, endpoint url and on each (root) resource name\n    getText: (item) => {\n      const strings = []\n      if (filterFields.length === 0) {\n        strings.push(\n          ...[\n            item.institutionName,\n            item.endpointUrl,\n            ...item.endpointInfo.rootResources.map((strOrObj) =>\n              typeof strOrObj === 'string' ? strOrObj : strOrObj.title\n            ),\n          ]\n        )\n      } else {\n        if (filterFields.includes('institution')) strings.push(item.institutionName)\n        if (filterFields.includes('endpoint')) strings.push(item.endpointUrl)\n        if (filterFields.includes('resources'))\n          strings.push(\n            ...item.endpointInfo.rootResources.map((strOrObj) =>\n              typeof strOrObj === 'string' ? strOrObj : strOrObj.title\n            )\n          )\n      }\n      return strings\n    },\n    mapResultItem: ({ item, score, matches }) => ({ item, matches, score }),\n    // strategy: 'off'\n  })\n\n  // rebuild nested structure, group by first occuring institution name\n  // add highlight information\n  const institutionData = filteredData.reduce(\n    (acc, cur) => {\n      const { institutionName, endpointUrl, endpointInfo } = cur.item\n\n      // check if we have not yet seen this institution name, then add it\n      if (!Object.getOwnPropertyNames(acc).includes(institutionName)) {\n        acc[institutionName] = {\n          match:\n            filterFields.length === 0 || filterFields.includes('institution')\n              ? cur.matches[0]\n              : null, // TODO: this is repeated for each endpoint that matches, so not sure what highlighting will work best here (hopefully the first)\n          endpoints: {},\n        }\n      }\n      // add endpoint info with highlight info\n      acc[institutionName].endpoints[endpointUrl] = {\n        ...endpointInfo,\n        matchEndpoint:\n          filterFields.length === 0 || filterFields.includes('endpoint')\n            ? cur.matches[filterFields.length === 0 || filterFields.includes('institution') ? 1 : 0]\n            : null,\n        matchResources:\n          filterFields.length === 0 || filterFields.includes('resources')\n            ? cur.matches.slice(\n                0 +\n                  (filterFields.length === 0 || filterFields.includes('institution') ? 1 : 0) +\n                  (filterFields.length === 0 || filterFields.includes('endpoint') ? 1 : 0)\n              )\n            : [],\n      }\n      return acc\n    },\n    {} as {\n      // map with key institution name\n      [institutionName: string]: {\n        // to institution name highlight match\n        match: HighlightRanges | null\n        endpoints: {\n          // and a map with endpoint url as key\n          [endpointUrl: string]: InstitutionEndpointInfo & {\n            // information augmented with highlight match information for endpoint url and each (root) resource\n            matchEndpoint: HighlightRanges | null\n            matchResources: (HighlightRanges | null)[]\n          }\n        }\n      }\n    }\n  )\n\n  // --------------------------------------------------------------\n\n  function handleFilterOptionToggleChange(field: FilterField) {\n    if (filterFields.includes(field)) {\n      setFilterFields(filterFields.filter((f) => f !== field))\n    } else {\n      setFilterFields([...filterFields, field])\n    }\n  }\n\n  // --------------------------------------------------------------\n\n  return (\n    <Container className=\"d-grid gap-2 mt-3\">\n      <Alert variant=\"info\" className=\"mb-0\">\n        <dl className=\"mb-0\">\n          <dt>{t('statistics.labels.startDate')}</dt>\n          <dd className=\"mb-0\">{new Date(data.date).toLocaleString(i18n.language)}</dd>\n          <dt>{t('statistics.labels.timeout')}</dt>\n          <dd className=\"mb-0\">\n            {new Intl.NumberFormat(i18n.language, {\n              style: 'unit',\n              unit: 'second',\n              unitDisplay: 'short',\n            }).format(data.timeout)}\n          </dd>\n        </dl>\n      </Alert>\n      <Form onSubmit={(event) => event.preventDefault()}>\n        <Row className=\"gy-2\">\n          <Col lg={6} md={12}>\n            <Form.Control\n              placeholder={t('statistics.filter.inputPlaceholder')}\n              value={filter}\n              onChange={(event) => setFilter(event.target.value)}\n            />\n          </Col>\n          <Col className=\"filter-checkboxes\" lg={6} md={12}>\n            <Form.Text className=\"me-2\">{t('statistics.filter.labelForCheckboxes')}</Form.Text>\n            <Form.Check\n              type=\"checkbox\"\n              checked={filterFields.includes('institution')}\n              onChange={() => handleFilterOptionToggleChange('institution')}\n              id={`filter-institution-name${idSuffix}`}\n              label={t('statistics.filter.checkboxInstitution')}\n            />\n            <Form.Check\n              type=\"checkbox\"\n              checked={filterFields.includes('endpoint')}\n              onChange={() => handleFilterOptionToggleChange('endpoint')}\n              id={`filter-endpoint-url${idSuffix}`}\n              label={t('statistics.filter.checkboxEndpoint')}\n            />\n            <Form.Check\n              type=\"checkbox\"\n              checked={filterFields.includes('resources')}\n              onChange={() => handleFilterOptionToggleChange('resources')}\n              id={`filter-resource-names${idSuffix}`}\n              label={t('statistics.filter.checkboxResources')}\n            />\n          </Col>\n        </Row>\n      </Form>\n      <Row>\n        <Col>\n          <Form.Check\n            type=\"checkbox\"\n            checked={showIssuesOnly}\n            onChange={() => setShowIssuesOnly(!showIssuesOnly)}\n            id={`filter-show-issues-only${idSuffix}`}\n            label={t('statistics.filter.checkboxShowWithIssues', {\n              count: endpointsWithIssues.length,\n            })}\n          />\n        </Col>\n      </Row>\n      {Object.entries(institutionData).map(\n        ([institutionName, { match: institutionMatch, endpoints: institutionEndpoints }]) => (\n          <Card className=\"p-2\" key={institutionName}>\n            <h3 className=\"h4 pb-1 border-bottom\" id={`${slugify(institutionName)}${idSuffix}`}>\n              <Highlight text={institutionName} ranges={institutionMatch} />\n            </h3>\n            {Object.entries(institutionEndpoints)\n              .toSorted()\n              .map(([endpointUrl, endpointInfo]) => (\n                <EndpointStatistics\n                  url={endpointUrl}\n                  statistics={endpointInfo}\n                  validatorUrl={validatorUrl}\n                  key={endpointUrl}\n                  isScan={data.isScan}\n                />\n              ))}\n          </Card>\n        )\n      )}\n    </Container>\n  )\n}\n\nexport default SectionStatistics\n","import { useQuery, useQueryClient } from '@tanstack/react-query'\nimport { useState } from 'react'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Nav from 'react-bootstrap/Nav'\nimport Row from 'react-bootstrap/Row'\nimport Tab from 'react-bootstrap/Tab'\nimport { Helmet } from 'react-helmet-async'\nimport { useTranslation } from 'react-i18next'\nimport { useParams, useSearchParams } from 'react-router'\n\nimport type {\n  ExtraScopingParams,\n  StatisticsSection,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\nimport {\n  getStatisticsData,\n  REQ_PARAM_CONSORTIA,\n} from '@clarin-eric/fcs-sru-aggregator-api-adapter-typescript'\n\nimport useNavigate from '@/hooks/useNavigate'\nimport useRouteMatch from '@/hooks/useRouteMatch'\nimport { useAxios } from '@/providers/AxiosContext'\nimport AppStore from '@/stores/app'\nimport FCSStatistics from './FCSStatistics'\nimport ResourcesDetails from './ResourcesDetails'\nimport SectionStatistics from './SectionStatistics'\n\nimport arrowClockwiseIcon from 'bootstrap-icons/icons/arrow-clockwise.svg?raw'\n\nimport './styles.css'\n\n// --------------------------------------------------------------------------\n// types\n\n// --------------------------------------------------------------------------\n// constants\n\nconst CATEGORY_LABELS = [\n  { id: 'last-scan', label: 'Last Scan' },\n  { id: 'recent-searches', label: 'Recent Searches' },\n] as const\nconst CATEGORY_LABELS_MAP = Object.fromEntries(CATEGORY_LABELS.map((item) => [item.id, item]))\n\nconst OTHER_TABS = ['resources', 'fcs']\n\n// --------------------------------------------------------------------------\n// component\n\nfunction Statistics() {\n  const axios = useAxios()\n  const queryClient = useQueryClient()\n  const [urlSearchParams] = useSearchParams()\n  const { t } = useTranslation()\n\n  const { categoryId } = useParams()\n  const routeMatch = useRouteMatch()\n  const navigate = useNavigate()\n  console.debug('route', { routeMatch, categoryId })\n\n  const extraParams = {\n    consortia: urlSearchParams.get(REQ_PARAM_CONSORTIA),\n  } satisfies ExtraScopingParams\n  const { isPending, isError, data, error } = useQuery({\n    queryKey: ['statistics'],\n    queryFn: getStatisticsData.bind(null, axios, extraParams),\n  })\n\n  const [validatorUrl, setValidatorUrl] = useState(AppStore.getState().validatorURL)\n  AppStore.subscribe((state) => setValidatorUrl(state.validatorURL))\n\n  const appTitleHead = AppStore.getState().appTitleHead\n\n  const categoryKeys = [...(data !== undefined ? Object.keys(data).toSorted() : []), ...OTHER_TABS]\n  // check if path param of to-be-selected statistics category exists and is valid otherwise default\n  const defaultCategoryTab =\n    categoryId != undefined && categoryKeys.includes(categoryId)\n      ? categoryId\n      : categoryKeys.length > 0\n      ? categoryKeys[0]\n      : undefined\n\n  // --------------------------------------------------------------\n\n  function refreshData() {\n    console.debug('Invalidate data and refresh ...')\n    queryClient.invalidateQueries({ queryKey: ['statistics'] })\n    queryClient.invalidateQueries({ queryKey: ['resources'] })\n    queryClient.invalidateQueries({ queryKey: ['languages'] })\n\n    if (import.meta.env.SHOW_CONSORTIA_INFO) {\n      queryClient.invalidateQueries({ queryKey: ['resources-all'] })\n      queryClient.invalidateQueries({ queryKey: ['consortia'] })\n    }\n  }\n\n  function handleTabChange(eventKey: string | null) {\n    console.debug('[handleTabChange]', {\n      eventKey,\n      routeMatch,\n      categoryId: routeMatch?.params.categoryId,\n    })\n    if (routeMatch) {\n      if (routeMatch.params.categoryId !== eventKey) {\n        if (routeMatch.route.path) {\n          navigate(routeMatch.route.path, { categoryId: eventKey })\n        }\n      }\n    }\n  }\n\n  // --------------------------------------------------------------\n\n  return (\n    <>\n      <Helmet>\n        <title>{appTitleHead}  Statistics</title>\n      </Helmet>\n      <Container id=\"statistics\" className=\"my-4\">\n        <h1 className=\"h1\">{t('statistics.title')}</h1>\n        {(isPending || isError) && (\n          <Row>\n            <Col>\n              {isPending ? t('statistics.loading') : null}\n              <br />\n              {isError ? error.message : null}\n            </Col>\n          </Row>\n        )}\n        {/* TODO: add some fuzzy search on title/endpoint/resource names */}\n        {data && (\n          <Tab.Container\n            activeKey={\n              categoryId && categoryKeys.includes(categoryId) ? categoryId : defaultCategoryTab\n            }\n            onSelect={handleTabChange}\n          >\n            <Nav className=\"nav-tabs\" as=\"ul\">\n              {Object.keys(data).map((section: string) => (\n                <Nav.Item as=\"li\" role=\"presentation\" key={section}>\n                  <Nav.Link as=\"button\" eventKey={section}>\n                    {t(`statistics.tabs.${section}`, {\n                      defaultValue: CATEGORY_LABELS_MAP[section]?.label ?? section,\n                    })}\n                  </Nav.Link>\n                </Nav.Item>\n              ))}\n              <Nav.Item as=\"li\" role=\"presentation\" key=\"resources\">\n                <Nav.Link as=\"button\" eventKey=\"resources\">\n                  {t('statistics.tabs.resources')}\n                </Nav.Link>\n              </Nav.Item>\n              <Nav.Item as=\"li\" role=\"presentation\" key=\"fcs\">\n                <Nav.Link as=\"button\" eventKey=\"fcs\">\n                  {t('statistics.tabs.fcs')}\n                </Nav.Link>\n              </Nav.Item>\n              {/* custom right aligned \"refresh\" tab button */}\n              <Nav.Item as=\"li\" role=\"presentation\" className=\"ms-auto\">\n                <Nav.Link as=\"button\" onClick={refreshData}>\n                  <i dangerouslySetInnerHTML={{ __html: arrowClockwiseIcon }} />{' '}\n                  {t('statistics.tabs.btnRefresh')}\n                </Nav.Link>\n              </Nav.Item>\n            </Nav>\n            <Tab.Content>\n              {Object.entries(data).map(([section, contents]: [string, StatisticsSection]) => (\n                <Tab.Pane eventKey={section} key={section}>\n                  <SectionStatistics data={contents} validatorUrl={validatorUrl} />\n                </Tab.Pane>\n              ))}\n              <Tab.Pane eventKey=\"resources\" key=\"resources\">\n                <ResourcesDetails validatorUrl={validatorUrl} />\n              </Tab.Pane>\n              <Tab.Pane eventKey=\"fcs\" key=\"fcs\">\n                <FCSStatistics />\n              </Tab.Pane>\n            </Tab.Content>\n          </Tab.Container>\n        )}\n      </Container>\n    </>\n  )\n}\n\nexport default Statistics\n","import { useEffect, useState } from 'react'\nimport { Helmet } from 'react-helmet-async'\nimport { Route, Routes, useLocation } from 'react-router'\n\nimport Footer from '@/components/Footer'\nimport Header from '@/components/Header'\nimport useColorMode from '@/hooks/useColorMode'\nimport { i18n } from '@/i18n'\nimport About from '@/pages/About'\nimport Help from '@/pages/Help'\nimport Search from '@/pages/Search'\nimport Statistics from '@/pages/Statistics'\nimport AppStore from '@/stores/app'\nimport { useLocaleStore } from '@/stores/locale'\nimport { trackPageView } from '@/utils/matomo'\n\n// --------------------------------------------------------------------------\n\nfunction App() {\n  const appTitleHead = AppStore.getState().appTitleHead\n\n  // initial setup\n  useColorMode() // TODO: or move to index.tsx?\n\n  // locale changes\n  const locale = useLocaleStore((state) => state.locale)\n  useEffect(() => {\n    if (i18n.language !== locale) i18n.changeLanguage(locale)\n  }, [locale])\n\n  if (import.meta.env.FEATURE_TRACKING_MATOMO) {\n    /* eslint-disable react-hooks/rules-of-hooks */\n    // https://react.dev/reference/rules/rules-of-hooks\n    // NOTE: intentional, will be tree-shaken if not enabled on build\n\n    const location = useLocation() // current state\n    const [pathname, setPathname] = useState(location.pathname) // previous state\n    useEffect(() => {\n      const newPathname = location.pathname\n      if (newPathname !== pathname) {\n        // switched page\n        setPathname(newPathname + location.search)\n        // console.debug('location', pathname, '=>', newPathname, location)\n        trackPageView(newPathname, document.title, pathname) // TODO: maybe referrer pathname should be absolute?\n      }\n    }, [location, pathname])\n  }\n\n  return (\n    <>\n      <Helmet>\n        {/* fallback/reset when not overridden in children (pages) */}\n        {/* NOTE: will not \"fire\" before matomo tracking update, so better to override ourselves explicitely */}\n        <title>{appTitleHead}</title>\n\n        {/* TODO: socials ? --> static index.html might be better */}\n      </Helmet>\n      <Header />\n      <main>\n        <Routes>\n          <Route index element={<Search />} />\n          <Route path=\"/about\" element={<About />} />\n          <Route path=\"/help\" element={<Help />} />\n          <Route path=\"/stats/:categoryId?\" element={<Statistics />} />\n        </Routes>\n      </main>\n      <Footer />\n    </>\n  )\n}\n\nexport default App\n","import AppStore from '@/stores/app'\nimport LocaleStore from '@/stores/locale'\nimport { SetupAndInstallScriptParams as MatomoSetupParams } from './utils/matomo'\n\n// --------------------------------------------------------------------------\n\ntype MyAggregatorConfiguration = {\n  DEPLOY_PATH: string\n  API_URL: string\n  VALIDATOR_URL: string | null\n  SHOW_SEARCH_RESULT_LINK: boolean\n  APP_TITLE: string\n  APP_TITLE_HEAD: string\n  MATOMO_TRACKING_PARAMS: string | MatomoSetupParams | null\n  AUTH_ENABLED: boolean\n  AUTH_USERNAME: string | null\n}\n\ndeclare const window: Window &\n  typeof globalThis & {\n    MyAggregator: Partial<MyAggregatorConfiguration> & { [key: string]: unknown }\n    _paq: unknown[] | { push: (params: unknown[]) => void }\n  }\n\n// declare const navigator: Navigator &\n//   NavigatorLanguage & {\n//     userLanguage?: string\n//   }\n\n// --------------------------------------------------------------------------\n\n// set global defaults\nwindow.MyAggregator = window['MyAggregator'] || {}\nwindow._paq = window['_paq'] || []\n\n// --------------------------------------------------------------------------\n\nexport const CONFIG_NAMES_ONLY_ON_INITIALIZATION = [\n  'DEPLOY_PATH',\n  'API_URL',\n  'APP_TITLE',\n  'APP_TITLE_HEAD',\n  'MATOMO_TRACKING_PARAMS',\n]\n\n/**\n * Configure AppStore with `MyAggregatorConfiguration`.\n * Must be called only once and should be run before the React App rendering happens.\n */\nexport function configure() {\n  if (window.MyAggregator.DEPLOY_PATH !== undefined) {\n    AppStore.getState().setDeployPath(window.MyAggregator.DEPLOY_PATH)\n  }\n  if (window.MyAggregator.API_URL !== undefined) {\n    AppStore.getState().setApiURL(window.MyAggregator.API_URL)\n  }\n  if (window.MyAggregator.VALIDATOR_URL !== undefined) {\n    AppStore.getState().setValidatorURL(window.MyAggregator.VALIDATOR_URL)\n  }\n  if (window.MyAggregator.SHOW_SEARCH_RESULT_LINK !== undefined) {\n    AppStore.getState().setShowSearchResultLink(window.MyAggregator.SHOW_SEARCH_RESULT_LINK)\n  }\n  if (window.MyAggregator.APP_TITLE !== undefined) {\n    AppStore.getState().setAppTitle(window.MyAggregator.APP_TITLE)\n  }\n  if (window.MyAggregator.APP_TITLE_HEAD !== undefined) {\n    AppStore.getState().setAppTitleHead(window.MyAggregator.APP_TITLE_HEAD)\n  }\n  if (import.meta.env.FEATURE_TRACKING_MATOMO) {\n    if (window.MyAggregator.MATOMO_TRACKING_PARAMS !== undefined) {\n      AppStore.getState().setMatomoTrackingParams(window.MyAggregator.MATOMO_TRACKING_PARAMS)\n    }\n  }\n  if (import.meta.env.FEATURE_AUTHENTICATION) {\n    if (window.MyAggregator.AUTH_ENABLED !== undefined) {\n      AppStore.getState().setAuthEnabled(window.MyAggregator.AUTH_ENABLED)\n    }\n    if (window.MyAggregator.AUTH_USERNAME !== undefined) {\n      AppStore.getState().setAuthUsername(window.MyAggregator.AUTH_USERNAME)\n    }\n  }\n\n  // observe and notify about invalid configuration changes\n  window.MyAggregator = new Proxy(window.MyAggregator, {\n    get(target, prop: string) {\n      return target[prop]\n    },\n    set(target, prop: string, val: unknown) {\n      if (CONFIG_NAMES_ONLY_ON_INITIALIZATION.includes(prop)) {\n        console.error(`Configuration ${prop} can only be set on initialization!`)\n        return false\n      }\n\n      if (prop === 'VALIDATOR_URL') {\n        if (val === null || typeof val === 'string') {\n          console.log('Updating VALIDATOR_URL ...')\n          AppStore.getState().setValidatorURL(val)\n          return true\n        }\n        return false\n      }\n      if (prop === 'SHOW_SEARCH_RESULT_LINK') {\n        if (typeof val === 'boolean') {\n          console.log('Updating SHOW_SEARCH_RESULT_LINK ...')\n          AppStore.getState().setShowSearchResultLink(val)\n          return true\n        }\n        return false\n      }\n\n      if (import.meta.env.FEATURE_AUTHENTICATION) {\n        if (prop === 'AUTH_USERNAME') {\n          if (val === null || typeof val === 'string') {\n            console.log('Updating AUTH_USERNAME ...')\n            AppStore.getState().setAuthUsername(val)\n            return true\n          }\n          return false\n        }\n        if (prop === 'AUTH_ENABLED') {\n          if (typeof val === 'boolean') {\n            console.log('Updating AUTH_ENABLED ...')\n            AppStore.getState().setAuthEnabled(val)\n            return true\n          }\n          return false\n        }\n      }\n\n      target[prop] = val\n      return true\n    },\n  })\n\n  // TODO: for debugging\n  Object.assign(window.MyAggregator, {\n    getAppStore: () => AppStore,\n  })\n}\n\nexport function updateLocale() {\n  // update locale stuff\n  // - get browser languages\n  // - check against available languages\n  // - use match or fall back to default\n  const localeStore = LocaleStore.getState()\n  const userLanguages: string[] = [\n    // ...((navigator.language || navigator.userLanguage) ? [navigator.language || navigator.userLanguage!] : []),\n    navigator.language,\n    ...navigator.languages,\n  ]\n  let foundLocale = false\n  for (const userLanguage of userLanguages) {\n    // match, ok\n    if (userLanguage === localeStore.locale) {\n      // TODO: notify if not first match?\n      console.debug('User locale matches default locale:', userLanguage)\n      foundLocale = true\n      break\n    }\n    // check if found in alternatives\n    if (localeStore.locales.includes(userLanguage)) {\n      console.log('Switching locale to:', userLanguage)\n      localeStore.setLocale(userLanguage)\n      foundLocale = true\n      break\n    }\n  }\n  if (!foundLocale) {\n    console.warn(\n      'User locale',\n      userLanguages,\n      'was not found in available languages',\n      localeStore.locales\n    )\n  }\n\n  // TODO: for debugging\n  Object.assign(window.MyAggregator, {\n    getLocaleStore: () => LocaleStore,\n  })\n}\n","import { QueryClient, QueryClientProvider } from '@tanstack/react-query'\nimport axios from 'axios'\nimport { StrictMode } from 'react'\nimport { createRoot } from 'react-dom/client'\nimport { HelmetProvider } from 'react-helmet-async'\nimport { BrowserRouter } from 'react-router'\n\nimport 'bootstrap/dist/css/bootstrap.min.css'\nimport './index.css'\nimport './utils.css'\n\nimport App from '@/App.tsx'\nimport { i18n } from '@/i18n'\nimport { AxiosProvider } from '@/providers/AxiosContext'\nimport { configure, updateLocale } from '@/public'\nimport AppStore from '@/stores/app'\nimport LocaleStore from '@/stores/locale'\nimport { setupAndInstallFromConfigString } from '@/utils/matomo'\n\n// --------------------------------------------------------------------------\n\n// configure AppStore and fetch runtime configuration to override build configuration\n// will guard against invalid/unexpected changes and notify about valid ones\nconfigure()\n// update locale languages based on browser/navigator and available languages\nupdateLocale()\n\nconsole.debug('AppStore.getState()', AppStore.getInitialState(), AppStore.getState())\nconsole.debug('LocaleStore.getState()', LocaleStore.getInitialState(), LocaleStore.getState())\n\n// BrowserRouter#basename for subpath deployment\nconst basename = AppStore.getState().deployPath\nconst apiURL = AppStore.getState().apiURL\n\nconst language = LocaleStore.getState().locale\ni18n.changeLanguage(language)\n\n// --------------------------------------------------------------------------\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      // TODO: disable for cleaner debugging and/or for production?\n      // refetchOnWindowFocus: false\n    },\n  },\n})\nconst axiosClient = axios.create({\n  baseURL: apiURL,\n  timeout: 5000,\n  // throw if response is not JSON\n  // - https://stackoverflow.com/a/75785157/9360161\n  responseType: 'json',\n  transitional: {\n    silentJSONParsing: false,\n  },\n})\n\n// --------------------------------------------------------------------------\n\nif (import.meta.env.FEATURE_TRACKING_MATOMO) {\n  const matomoParams = AppStore.getState().matomoTrackingParams\n  const successful = setupAndInstallFromConfigString(matomoParams)\n  if (!successful) console.warn('Unable to setup tracking ...')\n}\n\n// --------------------------------------------------------------------------\n\n// App mount point\nconst rootId = 'root'\nconst domRoot = document.getElementById(rootId)\nconst root = createRoot(domRoot!)\n\nroot.render(\n  <StrictMode>\n    <AxiosProvider axios={axiosClient}>\n      <QueryClientProvider client={queryClient}>\n        <HelmetProvider>\n          <BrowserRouter basename={basename}>\n            <App />\n          </BrowserRouter>\n        </HelmetProvider>\n      </QueryClientProvider>\n    </AxiosProvider>\n  </StrictMode>\n)\n"],"file":"fcs-sru-aggregator-ui.js"}